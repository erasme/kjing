Ui.LBox.extend("KJing.RatioBox",{ratio:1,constructor:function(a){},setRatio:function(a){this.ratio!==a&&(this.ratio=a,this.invalidateMeasure())}},{measureCore:function(a,b){var c,d;this.ratio>a/b?(c=a,d=c/this.ratio):(d=b,c=d*this.ratio);return KJing.RatioBox.base.measureCore.call(this,c,d)},arrangeCore:function(a,b){var c,d,e,f;this.ratio>a/b?(c=a,d=c/this.ratio,e=0,f=(b-d)/2):(d=b,c=d*this.ratio,f=0,e=(a-c)/2);var g=this.getPaddingLeft(),h=this.getPaddingRight(),k=this.getPaddingTop(),l=this.getPaddingBottom();
c-=g+h;d-=k+l;for(h=0;h<this.getChildren().length;h++)this.getChildren()[h].arrange(g+e,k+f,c,d)}});Ui.CanvasElement.extend("KJing.RoundItemGraphic",{image:void 0,constructor:function(){this.image=new Ui.Image;this.appendChild(this.image);this.connect(this.image,"ready",this.invalidateDraw)},setImageSrc:function(a){this.image.setSrc(a)}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b,c),e=d/2;if(this.image.getIsReady()){var f=this.image.getNaturalWidth(),g=this.image.getNaturalHeight(),h=Math.min(f,g),f=(f-h)/2,g=(g-h)/2,k=(b-d)/2,l=(c-d)/2;a.save();
a.beginPath();a.arc(b/2,c/2,e-2,0,2*Math.PI,!0);a.closePath();a.clip();a.drawImage(this.image.getDrawing(),f,g,h,h,k,l,d,d);a.restore();a.beginPath();a.arc(b/2,c/2,e-1.5,0,2*Math.PI,!0);a.closePath();a.strokeStyle="#444444";a.lineWidth=2;a.stroke();a.beginPath();a.arc(b/2,c/2,e-3,0,2*Math.PI,!0);a.closePath();a.strokeStyle="#ffffff";a.lineWidth=2;a.stroke()}}});Core.Object.extend("KJing.Resource",{ready:!1,deleted:!1,id:void 0,data:void 0,request:void 0,children:void 0,shares:void 0,socket:void 0,monitorCount:0,retryTask:void 0,constructor:function(a){this.addEvents("ready","change","delete","error");this.children=[];this.shares=[];"data"in a?(this.id=a.data.id,this.updateData(a.data),delete a.data):"id"in a&&(this.id=a.id,delete a.id,this.data={id:this.id},this.update())},getIsDeleted:function(){return this.deleted},getIsReady:function(){return this.ready},
getId:function(){return this.id},getType:function(){return this.data.type},changeData:function(a){(new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id,content:JSON.stringify(a)})).send()},getData:function(){return this.data},getName:function(){return this.data.name},getRights:function(){return this.data.rights},addRights:function(a){a=new Core.HttpRequest({method:"POST",url:"/cloud/resource/"+this.id+"/rights",content:JSON.stringify(a)});this.connect(a,"done",function(){this.update()});
a.send()},suppress:function(){var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/resource/"+this.id});this.connect(a,"done",function(){this.deleted=!0;this.fireEvent("delete",this)});a.send()},update:function(){if(void 0==this.request){var a=Ui.App.current.getUser(),b="/cloud/resource/"+this.id+"?depth=1";void 0!==a&&(b+="&seenBy="+a.getId());this.request=new Core.HttpRequest({url:b});this.connect(this.request,"done",this.onGetDataDone);this.connect(this.request,"error",this.onGetDataError);
this.request.send()}},updateData:function(a){if(void 0===this.data||JSON.stringify(this.data)!==JSON.stringify(a)){this.data=a;if("children"in this.data){var b=[];for(a=0;a<this.data.children.length;a++){for(var c=void 0,d=0;void 0===c&&d<this.children.length;d++)this.children[d].getId()===this.data.children[a].id&&(c=this.children[d]);void 0!==c?(c.updateData(this.data.children[a]),b.push(c)):b.push(KJing.Resource.create(this.data.children[a]))}this.children=b}if("shares"in this.data){b=[];for(a=
0;a<this.data.shares.length;a++){c=void 0;for(d=0;void 0===c&&d<this.shares.length;d++)this.shares[d].getId()===this.data.shares[a].id&&(c=this.shares[d]);void 0!==c?(c.updateData(this.data.shares[a]),b.push(c)):b.push(KJing.Resource.create(this.data.shares[a]))}this.shares=b}this.updateDataCore();this.ready||(this.ready=!0,this.fireEvent("ready",this));this.fireEvent("change",this)}},updateDataCore:function(){},canWrite:function(){return void 0!==this.data&&void 0!==this.data.ownRights?this.data.ownRights.write:
!1},canAdmin:function(){return void 0!==this.data&&void 0!==this.data.ownRights?this.data.ownRights.admin:!1},loadChildren:function(){"children"in this.data||this.update()},getIsChildrenReady:function(){return"children"in this.data},getChildren:function(){return this.children},getShares:function(){return this.shares},setParent:function(a){"string"===typeof a?this.changeData({parent:a}):KJing.Resource.hasInstance(a)&&this.changeData({parent:a.getId()})},sendClientMessage:function(a,b){void 0!==this.socket&&
this.socket.send(JSON.stringify({type:"clientmessage",destination:a,message:b}))},monitor:function(){this.retryTask=void 0;this.monitorCount++;void 0===this.socket&&(this.socket=new Core.Socket({service:"/cloud/resource/"+this.id+"?seenBy="+Ui.App.current.getUser().getId()}),this.connect(this.socket,"message",this.onMessageReceived),this.connect(this.socket,"error",this.onSocketError),this.connect(this.socket,"close",this.onSocketClose))},unmonitor:function(){0<this.monitorCount?0>=--this.monitorCount&&
void 0!==this.socket&&(this.socket.close(),this.socket=void 0):void 0!==this.retryTask&&(this.retryTask.abort(),this.retryTask=void 0)},onGetDataError:function(a){404==a.getStatus()?this.fireEvent("delete",this):this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0},onMessageReceived:function(){this.update()},onSocketError:function(){this.socket.close()},onSocketClose:function(){this.socket=void 0;0<this.monitorCount&&
(this.retryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.monitor}))}},{},{create:function(a){if("string"===typeof a)return 0===a.indexOf("user:")?new KJing.User({id:a}):0===a.indexOf("group:")?new KJing.Group({id:a}):0===a.indexOf("map:")?new KJing.Map({id:a}):0===a.indexOf("device:")?new KJing.Device({id:a}):0===a.indexOf("folder:")?new KJing.Folder({id:a}):0===a.indexOf("share:")?new KJing.Share({id:a}):0===a.indexOf("file:")?KJing.File.create(a):new KJing.Resource({id:a});if("object"===
typeof a){if(KJing.Resource.hasInstance(a)||KJing.File.hasInstance(a))return a;if("id"in a)return 0===a.id.indexOf("user:")?new KJing.User({data:a}):0===a.id.indexOf("group:")?new KJing.Group({data:a}):0===a.id.indexOf("map:")?new KJing.Map({data:a}):0===a.id.indexOf("device:")?new KJing.Device({data:a}):0===a.id.indexOf("folder:")?new KJing.Folder({data:a}):0===a.id.indexOf("share:")?new KJing.Share({data:a}):0===a.id.indexOf("file:")?KJing.File.create(a):new KJing.Resource({data:a})}}});KJing.Resource.extend("KJing.User",{groups:void 0,constructor:function(a){this.groups=[]},getFaceUrl:function(){return this.getIsReady()&&-1!==this.getData().face_rev?"/cloud/user/"+this.getId()+"/face?rev="+this.getData().face_rev:"img/default.png"},getGroups:function(){return this.groups},isAdmin:function(){return this.getData().admin}},{getName:function(){return this.getIsReady()?null===this.getData().firstname&&null===this.getData().lastname&&null===this.getData().login?"":null===this.getData().firstname&&
null===this.getData().lastname?this.getData().login:null===this.getData().firstname?this.getData().lastname:null===this.getData().lastname?this.getData().firstname:this.getData().firstname+" "+this.getData().lastname:""},updateDataCore:function(){if("groups"in this.data){for(var a=[],b=0;b<this.data.groups.length;b++){for(var c=void 0,d=0;void 0===c&&d<this.groups.length;d++)this.groups[d].getId()===this.data.groups[b].id&&(c=this.groups[d]);void 0!==c?a.push(c):a.push(KJing.Resource.create(this.data.groups[b]))}this.groups=
a}}});KJing.Resource.extend("KJing.Group",{constructor:function(a){},getUsers:function(){return this.getData().users},addUser:function(a){this.addUsers([a])},addUsers:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId()});a=new Core.HttpRequest({method:"POST",url:"/cloud/group/"+this.getId()+"/users",content:JSON.stringify(b)});a.send();this.connect(a,"done",function(){this.update()})},removeUser:function(a){this.removeUsers([a])},removeUsers:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId()});
(new Core.HttpRequest({method:"DELETE",url:"/cloud/group/"+this.getId()+"/users",content:JSON.stringify(b)})).send()}});KJing.Resource.extend("KJing.Map",{devices:void 0,constructor:function(a){console.log("KJing.Map new");void 0===this.devices&&(this.devices=[]);this.loadChildren()},getDevices:function(){return this.devices},attachDevice:function(a,b,c){a=new Core.HttpRequest({method:"POST",url:"/cloud/map/"+this.getId()+"/devices",content:JSON.stringify([{id:a.getId(),x:b,y:c}])});a.send();return a},moveDevice:function(a,b,c){a=new Core.HttpRequest({method:"PUT",url:"/cloud/map/"+this.getId()+"/devices/"+a.getId(),
content:JSON.stringify({x:b,y:c})});a.send();return a},detachDevice:function(a){a=new Core.HttpRequest({method:"DELETE",url:"/cloud/map/"+this.getId()+"/devices/"+a.getId()});a.send();return a},isAttachedDevice:function(a){for(var b=0;b<this.devices.length;b++)if(this.devices[b].device.getId()===a.getId())return!0;return!1},getMapImageUrl:function(){return"/cloud/map/"+this.getId()+"/image"},setMapImage:function(a){a=new Core.FilePostUploader({file:a,service:"/cloud/map/"+this.getId()+"/image"});
this.connect(a,"complete",this.onImageUploadComplete);a.send();return a},onImageUploadComplete:function(){}},{updateDataCore:function(){void 0===this.devices&&(this.devices=[]);if("devices"in this.data){for(var a=[],b=0;b<this.data.devices.length;b++){for(var c=void 0,d=0;void 0===c&&d<this.devices.length;d++)this.devices[d].device.getId()===this.data.devices[b].device&&(c=this.devices[d].device);if(void 0===c){for(var c=void 0,e=this.getChildren(),d=0;d<e.length;d++)if(e[d].getId()===this.data.devices[b].device){c=
e[d];break}void 0===c&&(c=KJing.Resource.create(this.data.devices[b].device))}a.push({device:c,x:this.data.devices[b].x,y:this.data.devices[b].y})}this.devices=a}}});KJing.Resource.extend("KJing.Device",{deviceMessageRev:0,constructor:function(a){},getPath:function(){return this.getData().path},setPath:function(a){this.changeData({path:a})},getDeviceData:function(){for(var a=this.getData().clients,b=0;b<a.length;b++)if(a[b].user==this.getId())return a[b]},getIsConnected:function(){return void 0!==this.getDeviceData()},sendDeviceMessage:function(a){this.deviceMessageRev++;var b=this.getDeviceData();void 0!==b&&this.sendClientMessage(b.id,a)},setDevicePath:function(a){this.sendDeviceMessage({path:a})},
getDevicePath:function(){var a=this.getDeviceData();return void 0===a||void 0===a.data||null===a.data||void 0===a.data.state||void 0===a.data.state.path?this.getPath():a.data.state.path},getDevicePosition:function(){var a=this.getDeviceData();return void 0===a||void 0===a.data||null===a.data||void 0===a.data.state||void 0===a.data.state.position?0:a.data.state.position},getDeviceTransform:function(){var a=this.getDeviceData();return void 0===a||void 0===a.data||null===a.data||void 0===a.data.state||
void 0===a.data.state.transform?{x:0,y:0,scale:1,angle:0}:a.data.state.transform},getDeviceRatio:function(){var a=this.getDeviceData();return void 0===a||void 0===a.data||null===a.data||void 0===a.data.capabilities?4/3:a.data.capabilities.width/a.data.capabilities.height}});KJing.Resource.extend("KJing.Folder",{});KJing.Resource.extend("KJing.Share",{});Core.Object.extend("KJing.File",{resourceParent:void 0,id:void 0,file:void 0,storage:void 0,share:void 0,ready:!1,deleted:!1,data:void 0,request:void 0,children:void 0,socket:void 0,monitorCount:0,retryTask:void 0,constructor:function(a){this.addEvents("ready","change","delete","error");this.children=[];this.share=a.share;delete a.share;this.share.getIsReady()||this.connect(this.share,"ready",this.onShareReady);if("id"in a){this.id=a.id;delete a.id;var b=this.id.lastIndexOf(":");this.storage=this.share.getId();
this.file=this.id.substring(b+1);this.data={id:this.id};this.update()}else"data"in a?(this.id="file:"+this.share.getId()+":"+a.data.id,b=this.id.lastIndexOf(":"),this.storage=this.share.getId(),this.file=this.id.substring(b+1),this.updateData(a.data),delete a.data):(this.id="file:"+this.share.getId()+":0",this.storage=this.share.getId(),this.file=0,this.data={id:this.id},this.update())},setResourceParent:function(a){this.resourceParent=a},getResourceParent:function(){return this.resourceParent},getType:function(){return"file"},
getIsDeleted:function(){return this.deleted},getIsReady:function(){return this.ready&&this.share.getIsReady()},getId:function(){return this.id},canWrite:function(){return this.share.canWrite()},canRead:function(){return this.share.canRead()},canAdmin:function(){return this.share.canAdmin()},getRev:function(){return this.getIsReady()?this.data.rev:0},changeData:function(a){(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file,content:JSON.stringify(a)})).send()},getShare:function(){return this.share},
getData:function(){return this.data},getName:function(){return this.data.name},suppress:function(){var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file});this.connect(a,"done",function(){this.deleted=!0;this.fireEvent("delete",this);void 0!==this.resourceParent&&this.resourceParent.update()});a.send()},update:function(){void 0==this.request&&(this.request=new Core.HttpRequest({url:"/cloud/storage/"+this.storage+"/"+this.file+"?depth=1"}),this.connect(this.request,
"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},updateData:function(a){if(void 0===this.data||JSON.stringify(this.data)!==JSON.stringify(a)){this.data=a;if("children"in this.data){a=[];for(var b=0;b<this.data.children.length;b++){for(var c=void 0,d=0;void 0===c&&d<this.children.length;d++)this.children[d].getId()===this.data.children[b].id&&(c=this.children[d]);void 0!==c?a.push(c):a.push(new KJing.File({share:this.share,data:this.data.children[b],
resourceParent:this}))}this.children=a}this.ready||(this.ready=!0,this.share.getIsReady()&&this.fireEvent("ready",this));this.getIsReady()&&this.fireEvent("change",this)}},loadChildren:function(){"children"in this.data||this.update()},getIsChildrenReady:function(){return"children"in this.data},getChildren:function(){return this.children},setParent:function(a){"string"===typeof a?this.changeData({parent:a}):KJing.Resource.hasInstance(a)&&this.changeData({parent:a.getId()})},getPreviewUrl:function(){return this.getIsReady()?
"/cloud/preview/"+this.storage+"/"+this.file+"?rev="+this.data.rev:"/cloud/preview/"+this.storage+"/"+this.file},getPreviewHighUrl:function(){return this.getIsReady()?"/cloud/previewhigh/"+this.storage+"/"+this.file+"?rev="+this.data.rev:"/cloud/previewhigh/"+this.storage+"/"+this.file},getChildrenUploadUrl:function(){return"/cloud/storage/"+this.storage+"/"+this.file},getDownloadUrl:function(a){var b="/cloud/storage/"+this.storage+"/"+this.file+"/content";!0===a?b=this.getIsReady()?b+("?attachment=true&rev="+
this.data.rev):b+"?attachment=true":this.getIsReady()&&(b+="?rev="+this.data.rev);return b},getMimetype:function(){return this.data.mimetype},monitor:function(){this.retryTask=void 0;this.monitorCount++;void 0===this.socket&&(this.socket=new Core.Socket({service:"/cloud/storage/"+this.storage}),this.connect(this.socket,"message",this.onMessageReceived),this.connect(this.socket,"error",this.onSocketError),this.connect(this.socket,"close",this.onSocketClose))},unmonitor:function(){0<this.monitorCount?
0>=--this.monitorCount&&void 0!==this.socket&&(this.socket.close(),this.socket=void 0):void 0!==this.retryTask&&(this.retryTask.abort(),this.retryTask=void 0)},onGetDataError:function(a){404==a.getStatus()?this.fireEvent("delete",this):this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0},onMessageReceived:function(){this.update()},onSocketError:function(){this.socket.close()},onSocketClose:function(){this.socket=
void 0;0<this.monitorCount&&(this.retryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.monitor}))},onShareReady:function(){this.getIsReady()&&(this.fireEvent("ready",this),this.fireEvent("change",this))}},{},{create:function(a){if("string"===typeof a){if(0!==a.indexOf("file:"))return;var b=a.lastIndexOf(":"),c=a.substring(5,b);a.substring(b+1);return new KJing.File({share:KJing.Resource.create(c),id:a})}if("object"===typeof a&&KJing.File.hasInstance(a))return a}});Ui.LBox.extend("KJing.View",{view:void 0,constructor:function(a){console.log("new KJing.View");this.view=a.view;delete a.view},getView:function(){return this.view}},{},{create:function(a,b){var c=KJing.Resource.create(b);if(KJing.User.hasInstance(c))return new KJing.ResourceView({view:a,resource:c});if(KJing.Group.hasInstance(c))return new KJing.GroupView({view:a,resource:c});if(KJing.Map.hasInstance(c))return new KJing.MapView({view:a,resource:c});if(KJing.Folder.hasInstance(c))return new KJing.ResourceView({view:a,
resource:c});if(KJing.Device.hasInstance(c))return new KJing.DeviceView({view:a,resource:c});if(KJing.Share.hasInstance(c))return new KJing.StorageView({view:a,resource:new KJing.File({share:c})});if(KJing.File.hasInstance(c))return new KJing.StorageView({view:a,resource:c})}});Ui.Selectionable.extend("KJing.ItemView",{view:void 0,content:void 0,name:void 0,label:void 0,progressbar:void 0,iconSrc:void 0,iconName:void 0,imageSrc:void 0,share:!1,tags:void 0,tagsBox:void 0,isRound:!1,constructor:function(a){this.view=a.view;delete a.view;this.setDirectionDrag("horizontal");a=new Ui.VBox({margin:5,spacing:5});this.setContent(a);this.content=new Ui.DropBox({width:70,height:70});this.connect(this.content,"drop",this.onDrop);this.connect(this.content,"dropfile",this.onDropFile);
a.append(this.content);this.label=new Ui.CompactLabel({width:100,maxLine:3,textAlign:"center"});a.append(this.label)},setRoundMode:function(a){this.isRound=a;void 0!==this.imageSrc&&this.setItemImage(this.imageSrc)},getView:function(){return this.view},addMimetype:function(a){this.content.addMimetype(a)},setItemTags:function(a){this.tags=a;if(void 0!==this.tags){void 0===this.tagsBox&&(this.tagsBox=new Ui.LBox({width:64,height:64,verticalAlign:"bottom",horizontalAlign:"center"}),this.content.append(this.tagsBox));
var b=new Ui.Flow({itemAlign:"right",verticalAlign:"bottom"});this.tagsBox.setContent(b);for(var c=0;c<a.length;c++)b.append(new Ui.Icon({icon:a[c],width:24,height:24,fill:"#00c3ff"}))}else void 0!==this.tagsBox&&(this.content.remove(this.tagsBox),this.tagsBox=void 0)},setItemIcon:function(a){this.iconName=a;this.content.setContent(new Ui.Icon({icon:this.iconName,verticalAlign:"bottom",horizontalAlign:"center",width:64,height:64}));void 0!==this.tagsBox&&this.append(this.tagsBox)},setItemIconSrc:function(a){this.iconSrc=
a;this.content.setContent(new Ui.Image({src:this.iconSrc,verticalAlign:"bottom",horizontalAlign:"center"}));void 0!==this.tagsBox&&this.content.append(this.tagsBox)},setItemImage:function(a){this.imageSrc=a;if(this.isRound)a=new KJing.RoundItemGraphic({verticalAlign:"bottom",horizontalAlign:"center",imageSrc:this.imageSrc,width:70,height:70}),this.content.setContent(a);else{var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});this.content.setContent(b);b.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,
b:0.7,g:0.7})}));b.append(new Ui.Rectangle({fill:"white",margin:1}));a=new Ui.Image({src:this.imageSrc,margin:3,width:64});b.append(a);this.connect(a,"error",this.onImageError)}void 0!==this.tagsBox&&this.content.append(this.tagsBox)},getItemName:function(){return this.name},setItemName:function(a){this.name=a;void 0!==this.label.getText()&&""!==this.label.getText()||this.setItemLabel(a)},setItemLabel:function(a){this.label.setText(a)},onImageError:function(a){this.disconnect(a,"error",this.onImageError);
void 0!==this.iconSrc?this.setItemIconSrc(this.iconSrc):void 0!==this.iconName&&this.setItemIcon(this.iconName)},onDrop:function(){},onDropFile:function(){}});Ui.VBox.extend("KJing.TextField",{title:void 0,field:void 0,constructor:function(a){this.addEvents("change");var b=new Ui.Text({text:a.title});delete a.title;this.append(b);this.field=new Ui.TextField({marginLeft:5});this.connect(this.field,"change",this.onFieldChange);this.append(this.field);a.desc&&(this.append(new Ui.Text({text:a.desc,color:"#aaaaaa"})),delete a.desc)},getTitle:function(){return this.title.getText()},setTitle:function(a){this.title.setText(a)},getValue:function(){return this.field.getValue()},
setValue:function(a){this.field.setValue(a)},setPasswordMode:function(a){this.field.setPasswordMode(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Ui.VBox.extend("KJing.TextAreaField",{title:void 0,field:void 0,constructor:function(a){this.addEvents("change");var b=new Ui.Text({text:a.title});delete a.title;this.append(b);this.field=new Ui.TextAreaField({marginLeft:5});this.connect(this.field,"change",this.onFieldChange);this.append(this.field);a.desc&&(this.append(new Ui.Text({text:a.desc,color:"#aaaaaa"})),delete a.desc)},getTitle:function(){return this.title.getText()},setTitle:function(a){this.title.setText(a)},getValue:function(){return this.field.getValue()},
setValue:function(a){this.field.setValue(a)},setPasswordMode:function(a){this.field.setPasswordMode(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Ui.VBox.extend("KJing.ComboField",{title:void 0,field:void 0,constructor:function(a){this.addEvents("change");var b=new Ui.Text({text:a.title});delete a.title;this.append(b);this.field=new Ui.Combo({marginLeft:5});this.connect(this.field,"change",this.onFieldChange);this.append(this.field);a.desc&&(this.append(new Ui.Text({text:a.desc,color:"#aaaaaa"})),delete a.desc)},setField:function(a){this.field.setField(a)},getData:function(){return this.field.getData()},setData:function(a){this.field.setData(a)},
setCurrentAt:function(a){this.field.setCurrentAt(a)},getTitle:function(){return this.title.getText()},setTitle:function(a){this.title.setText(a)},getValue:function(){return this.field.getValue()},setValue:function(a){this.field.setValue(a)},setPasswordMode:function(a){this.field.setPasswordMode(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Ui.Fold.extend("KJing.OptionSection",{title:void 0,arrow:void 0,optionContent:void 0,constructor:function(){this.setOver(!1);this.setIsFolded(!1);var a=new Ui.HBox;this.setHeader(a);this.arrow=new Ui.Icon({icon:"play",fill:"#666666",verticalAlign:"center",width:12,height:12});a.append(this.arrow);this.title=new Ui.Text({fontWeight:"bold",margin:5,color:"#666666",fontSize:20,verticalAlign:"center"});a.append(this.title,!0);this.optionContent=new Ui.LBox({paddingLeft:30});KJing.OptionSection.base.setContent.call(this,
this.optionContent)},setTitle:function(a){this.title.setText(a)}},{setContent:function(a){this.optionContent.setContent(a)},setOffset:function(a){KJing.OptionSection.base.setOffset.call(this,a);void 0!==this.arrow&&this.arrow.setTransform(Ui.Matrix.createRotate(90*a))}});Ui.Button.extend("KJing.NewItem",{constructor:function(a){this.setWidth(110);this.setHeight(110);this.setIcon("plus")}});Ui.SFlow.extend("KJing.NewDirectoryCreator",{resource:void 0,valid:!1,nameField:void 0,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.setItemAlign("stretch");this.nameField=new KJing.TextAreaField({title:"Nom"});this.append(this.nameField);this.connect(this.nameField,"change",this.checkValid)},checkValid:function(){var a=""!==this.nameField.getValue();this.valid!==a&&((this.valid=a)?this.fireEvent("valid",this):this.fireEvent("notvalid",
this))},create:function(){this.valid=!1;this.fireEvent("notvalid",this);var a=new Core.HttpRequest({method:"POST",url:this.resource.getChildrenUploadUrl(),content:JSON.stringify({name:this.nameField.getValue(),mimetype:"application/x-directory"})});this.connect(a,"done",function(){this.fireEvent("done",this);this.resource.update()});this.connect(a,"error",function(){this.fireEvent("done",this)});a.send()}});
Ui.SFlow.extend("KJing.NewFileCreator",{resource:void 0,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;var b=a.file;delete a.file;a=new Core.FilePostUploader({file:b,service:this.resource.getChildrenUploadUrl()});this.connect(a,"progress",this.onUploadProgress);this.connect(a,"complete",this.onUploadComplete);a.send()},create:function(){},onUploadProgress:function(a){},onUploadComplete:function(a){this.fireEvent("done",this);this.resource.update()}});
Ui.SFlow.extend("KJing.NewFileSelector",{constructor:function(a){this.addEvents("done");this.setItemAlign("stretch");this.setSpacing(5);this.setUniform(!0);a=[{type:"folder",icon:"folder",text:"Dossier",creator:KJing.NewDirectoryCreator},{type:"file",uploader:!0,icon:"new",text:"Fichier",creator:KJing.NewFileCreator}];for(var b=0;b<a.length;b++){var c=a[b],d;c.uploader?(d=new Ui.UploadButton({text:c.text,icon:c.icon,orientation:"horizontal",width:200}),this.connect(d,"file",this.onButtonFile)):(d=
new Ui.Button({text:c.text,icon:c.icon,orientation:"horizontal",width:200}),this.connect(d,"press",this.onButtonPress));d.kjingNewFileSelectorType=c;this.append(d)}},onButtonFile:function(a,b){this.fireEvent("done",this,a.kjingNewFileSelectorType,b)},onButtonPress:function(a){this.fireEvent("done",this,a.kjingNewFileSelectorType)}});
Ui.Dialog.extend("KJing.NewFileDialog",{resource:void 0,transBox:void 0,selector:void 0,creator:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.setTitle("Nouveau fichier");this.setFullScrolling(!0);this.setPreferedWidth(400);this.setPreferedHeight(400);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.selector=new KJing.NewFileSelector;this.connect(this.selector,"done",this.onSelectorDone);this.transBox.replaceContent(this.selector);this.setCancelButton(new Ui.Button({text:"Annuler"}));
this.prevButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.connect(this.prevButton,"press",this.onPrevPress);this.createButton=new Ui.Button({text:"Cr\u00e9er"});this.connect(this.createButton,"press",this.onCreatePress)},onSelectorDone:function(a,b,c){this.setTitle(b.text);this.setActionButtons([this.prevButton,this.createButton]);this.creator=void 0!==c?new b.creator({resource:this.resource,file:c}):new b.creator({resource:this.resource});this.transBox.replaceContent(this.creator);this.connect(this.creator,
"done",this.onCreatorDone);this.connect(this.creator,"valid",this.onCreatorValid);this.connect(this.creator,"notvalid",this.onCreatorNotvalid);this.onCreatorNotvalid(this.creator)},onPrevPress:function(){this.setTitle("Nouveau fichier");this.setActionButtons([]);this.transBox.replaceContent(this.selector);void 0!==this.creator&&(this.disconnect(this.creator,"done",this.onCreatorDone),this.disconnect(this.creator,"valid",this.onCreatorValid),this.disconnect(this.creator,"notvalid",this.onCreatorNovalid),
this.creator=void 0)},onCreatePress:function(){this.creator.create()},onCreatorDone:function(){this.close()},onCreatorValid:function(){this.createButton.enable()},onCreatorNotvalid:function(){this.createButton.disable()}});Ui.Dialog.extend("Storage.FilePropertiesDialog",{resource:void 0,deleteButton:void 0,modifyButton:void 0,nameField:void 0,mimetypeField:void 0,filesizeField:void 0,ctimeField:void 0,mtimeField:void 0,positionField:void 0,durationField:void 0,iframeField:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.setPreferedWidth(500);this.setPreferedHeight(500);this.setFullScrolling(!0);this.setTitle("Propri\u00e9t\u00e9s du fichier");this.setCancelButton(new Ui.Button({text:"Fermer"}));
if(this.resource.getIsReady())this.onResourceReady();else this.connect(this.resource,"ready",this.onResourceReady)},onResourceReady:function(){var a=new Ui.VBox;this.setContent(a);var b=new Ui.VBox({spacing:10});a.append(b);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Nom",width:100,textAlign:"right",verticalAlign:"center"}));this.nameField=new Ui.TextAreaField({verticalAlign:"center"});a.append(this.nameField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Type",
width:100,textAlign:"right",verticalAlign:"center"}));this.mimetypeField=new Ui.Text({verticalAlign:"center"});a.append(this.mimetypeField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Taille",width:100,textAlign:"right",verticalAlign:"center"}));this.filesizeField=new Ui.Text({verticalAlign:"center"});a.append(this.filesizeField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Cr\u00e9ation",width:100,textAlign:"right",verticalAlign:"center"}));this.ctimeField=
new Ui.Text({verticalAlign:"center"});a.append(this.ctimeField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Modification",width:100,textAlign:"right",verticalAlign:"center"}));this.mtimeField=new Ui.Text({verticalAlign:"center"});a.append(this.mtimeField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Position",width:100,textAlign:"right",verticalAlign:"center"}));this.positionField=new Ui.TextField({verticalAlign:"center"});a.append(this.positionField,
!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Dur\u00e9e d'affichage",width:100,textAlign:"right",verticalAlign:"center"}));this.durationField=new Ui.TextField({verticalAlign:"center"});a.append(this.durationField,!0);"text/uri-list"===this.resource.getMimetype()&&(this.iframeField=new Ui.CheckBox({text:"IFrame"}),b.append(this.iframeField));"application/x-directory"!==this.resource.getMimetype()&&(a=new Storage.FileViewer({file:this.resource,height:300}),b.append(a));Ui.App.current.getUser();
Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.deleteButton=new Ui.Button({text:"Supprimer",style:{"Ui.Button":{color:"#fa4141"}}}),this.connect(this.deleteButton,"press",this.onDeletePress),this.saveButton=new Ui.Button({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),this.setActionButtons([this.deleteButton,this.saveButton])):this.nameField.disable()},formatSize:function(a){return 1E9<a?(a/1E9).toFixed(2)+" Go":1E6<a?(a/1E6).toFixed(2)+" Mo":1E3<a?
(a/1E3).toFixed(2)+" ko":a+" octets"},formatDate:function(a){var b="",b=10>a.getDate()?b+("0"+a.getDate()):b+a.getDate(),b=b+"/",b=10>a.getMonth()+1?b+("0"+(a.getMonth()+1)):b+(a.getMonth()+1),b=b+("/"+a.getFullYear()+" "),b=10>a.getHours()?b+("0"+a.getHours()):b+a.getHours(),b=b+":",b=10>a.getMinutes()?b+("0"+a.getMinutes()):b+a.getMinutes(),b=b+":";return b=10>a.getSeconds()?b+("0"+a.getSeconds()):b+a.getSeconds()},onSavePress:function(){var a={name:this.nameField.getValue(),position:this.positionField.getValue(),
meta:{duration:this.durationField.getValue()}};"text/uri-list"===this.resource.getMimetype()&&(a.meta.iframe=this.iframeField.getValue());this.resource.changeData(a);this.close()},onDeletePress:function(){this.resource.suppress();this.close()},onResourceChange:function(){this.nameField.setValue(this.resource.getName());this.mimetypeField.setText(this.resource.getMimetype());this.filesizeField.setText(this.formatSize(this.resource.getData().size));this.ctimeField.setText(this.formatDate(new Date(1E3*
this.resource.getData().ctime)));this.mtimeField.setText(this.formatDate(new Date(1E3*this.resource.getData().mtime)));this.positionField.setValue(this.resource.getData().position);"duration"in this.resource.getData().meta?this.durationField.setValue(this.resource.getData().meta.duration):this.durationField.setValue(void 0);void 0!==this.iframeField&&this.iframeField.setValue((new Boolean(this.resource.getData().meta.iframe)).valueOf())}},{onLoad:function(){Storage.FilePropertiesDialog.base.onLoad.apply(this,
arguments);this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Storage.FilePropertiesDialog.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange)}});Ui.Selectionable.extend("KJing.FileItemView",{resourceParent:void 0,resource:void 0,uploader:void 0,view:void 0,preview:void 0,constructor:function(a){this.setDirectionDrag("horizontal");this.view=a.view;delete a.view;this.resourceParent=a.resourceParent;delete a.resourceParent;this.resource=a.resource;delete a.resource;"uploader"in a?(this.uploader=a.uploader,delete a.uploader,this.preview=new Storage.FileUploadPreview({resourceParent:this.resourceParent,uploader:this.uploader})):(this.setDownloadUrl(this.resource.getDownloadUrl(),
this.resource.getMimetype(),this.resource.getName()),this.setMimetype("application/x-file"),this.setData(this.resource.getId()),this.preview=new Storage.FilePreview({resource:this.resource}));this.setContent(this.preview)},getResourceParent:function(){return this.resourceParent},getResource:function(){return this.resource},getUploader:function(){return this.uploader},deleteFile:function(){void 0!==this.uploader&&(this.uploader.abort(),this.uploader=void 0);void 0!==this.resource&&this.resource.suppress()},
onDelete:function(a){a.getElements()[0].getResource().suppress()},onEdit:function(a){a=a.getElements()[0];(new Storage.FilePropertiesDialog({resource:a.getResource()})).open()},onOpen:function(a){a=a.getElements()[0];"application/x-directory"===a.getResource().getMimetype()&&a.view.push(a.getResource().getName(),a.getResource().getId())}},{getSelectionActions:function(){return void 0!==this.uploader?{suppress:{text:"Supprimer",icon:"trash",color:"#d02020",callback:this.onDelete,multiple:!1}}:"application/x-directory"===
this.resource.getMimetype()?{suppress:{text:"Supprimer",icon:"trash",color:"#d02020",callback:this.onDelete,multiple:!1},open:{"default":!0,text:"Ouvrir",icon:"eye",callback:this.onOpen,multiple:!1},property:{text:"Propri\u00e9t\u00e9s",icon:"pen",callback:this.onEdit,multiple:!1}}:{suppress:{text:"Supprimer",icon:"trash",color:"#d02020",callback:this.onDelete,multiple:!1},edit:{"default":!0,text:"Propri\u00e9t\u00e9s",icon:"pen",callback:this.onEdit,multiple:!1}}}});
Ui.LBox.extend("Storage.FilePreview",{resource:void 0,content:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;if(this.resource.getIsReady())this.onResourceReady();else this.connect(this.resource,"ready",this.onResourceReady)},onResourceReady:function(){var a=new Ui.VBox({spacing:5});this.setContent(a);this.content=new Ui.LBox({width:70,height:70});a.append(this.content);this.label=new Ui.CompactLabel({width:100,maxLine:3,textAlign:"center",horizontalAlign:"center"});a.append(this.label);
a=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});this.content.setContent(a);a.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,b:0.7,g:0.7})}));a.append(new Ui.Rectangle({fill:"white",margin:1}));var b=new Ui.Image({src:"/cloud/preview/"+this.resource.getShare().getId()+"/"+this.resource.getData().id+"?rev="+this.resource.getRev(),margin:3});this.connect(b,"error",this.onPreviewError);a.append(b);this.label.setText(this.resource.getName())},onPreviewError:function(a){this.disconnect(a,
"error",this.onPreviewError);a="file";"application/x-directory"===this.resource.getMimetype()?a="folder":0===this.resource.getMimetype().indexOf("audio/")&&(a="sound");this.content.setContent(new Ui.Icon({icon:a,verticalAlign:"bottom",horizontalAlign:"center",width:64,height:64}))}});
Ui.LBox.extend("Storage.FileUploadPreview",{resourceParent:void 0,uploader:void 0,label:void 0,progressbar:void 0,constructor:function(a){this.resourceParent=a.resourceParent;delete a.resourceParent;this.uploader=a.uploader;delete a.uploader;a=new Ui.VBox({spacing:5});this.setContent(a);var b=new Ui.LBox({width:70,height:70});a.append(b);b.append(new Ui.Icon({icon:"uploadfile",verticalAlign:"bottom",horizontalAlign:"center",width:48,height:48}));this.progressbar=new Ui.ProgressBar({verticalAlign:"bottom",
horizontalAlign:"center",margin:5,width:50});b.append(this.progressbar);this.connect(this.uploader,"progress",this.onUploaderProgress);this.connect(this.uploader,"complete",this.onUploaderComplete);this.label=new Ui.CompactLabel({width:100,maxLine:3,textAlign:"center",horizontalAlign:"center"});a.append(this.label);void 0!==this.uploader.getFile().getFileName()&&this.label.setText(this.uploader.getFile().getFileName())},getUploader:function(){return this.uploader},onUploaderProgress:function(a,b,
c){void 0!==this.progressbar&&this.progressbar.setValue(b/c)},onUploaderComplete:function(){this.resourceParent.update()}});Ui.Selectionable.extend("KJing.WebAccount",{label:void 0,accountIcon:void 0,user:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;a=new Ui.VBox({margin:0});this.setContent(a);this.accountIcon=new Ui.Icon({icon:"google",width:48,height:48,fill:"#444444",horizontalAlign:"center"});a.append(this.accountIcon);this.label=new Ui.CompactLabel({width:80,maxLine:2,textAlign:"center"});a.append(this.label)},getUser:function(){return this.user},setAccountIcon:function(a){this.accountIcon.setIcon(a)},
setText:function(a){this.label.setText(a)},"delete":function(){this.fireEvent("delete",this)},testDeleteRight:function(){var a=this.user.getData(),b=0;null!==a.login&&b++;null!==a.googleid&&b++;null!==a.facebookid&&b++;return 1<b}});
Ui.Dialog.extend("KJing.WebAccountNewDialog",{user:void 0,path:void 0,constructor:function(a){this.addEvents("done");this.user=a.user;delete a.user;this.setTitle("Nouveau compte Web");this.setPreferedWidth(400);this.setPreferedHeight(400);this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.VBox({spacing:5});this.setContent(a);var b=this.user.getData();if(null===b.login){var c=new Ui.Button({icon:"localaccount",text:"HOST",orientation:"horizontal"});this.connect(c,"press",this.onLocalPress);
a.append(c)}null===b.googleid&&(c=new Ui.Button({icon:"google",text:"Google",orientation:"horizontal"}),this.connect(c,"press",this.onGooglePress),a.append(c));null===b.facebookid&&(c=new Ui.Button({icon:"facebook",text:"Facebook",orientation:"horizontal"}),this.connect(c,"press",this.onFacebookPress),a.append(c))},onLocalPress:function(){var a=new Ui.VBox({spacing:10});this.setContent(a);var b=new Ui.TextField,c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",
verticalAlign:"center",width:100}));c.append(b,!0);a.append(c);passwordField=new Ui.TextField({passwordMode:!0});c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Mot de passe",textAlign:"right",verticalAlign:"center",width:100}));c.append(passwordField,!0);a.append(c);var d=new Ui.Text({color:"red"});d.hide();a.append(d);var e=void 0,f=new Ui.Button({text:"Cr\u00e9er"});this.connect(f,"press",function(){var a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:b.getValue(),
password:passwordField.getValue()})});this.connect(a,"done",function(){this.close();this.user.getData().login=b.getValue();this.fireEvent("done",this,new KJing.LocalAccount({user:this.user}))});this.connect(a,"error",function(a){var b=a.getStatus(),c="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";403==b?1==a.getResponseJSON().code&&(c="Echec: mot de passe trop faible"):409==b&&(c="Echec: identifiant d\u00e9j\u00e0 utilis\u00e9");void 0!==e&&e.abort();d.setText(c);d.show();e=new Core.DelayedTask({scope:this,
delay:4,callback:function(){d.hide()}});this.getContent().enable();f.enable()});this.getContent().disable();f.disable();a.send()});this.setActionButtons([f])},onGooglePress:function(){this.setContent(new Ui.Text({verticalAlign:"center",textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/googleoauth2/redirect?state=grant","googleoauth");this.connect(a,"unload",function(){this.close()})},onFacebookPress:function(){this.setContent(new Ui.Text({verticalAlign:"center",
textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/facebookoauth2/redirect?state=grant","facebookoauth");this.connect(a,"unload",function(){this.close()})}});
Ui.Dialog.extend("KJing.GoogleAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte Google");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",
width:100}));c.append(new Ui.Text({text:this.user.getData().googleid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
KJing.WebAccount.extend("KJing.GoogleAccount",{constructor:function(a){this.setAccountIcon("google");this.setText("Google")},onGoogleEdit:function(){(new KJing.GoogleAccountDialog({user:this.getUser(),account:this})).open()},onGoogleDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({googleid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onGoogleDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onGoogleEdit,multiple:!1}}}});
Ui.Dialog.extend("KJing.FacebookAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte Facebook");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",
verticalAlign:"center",width:100}));c.append(new Ui.Text({text:this.user.getData().facebookid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
KJing.WebAccount.extend("KJing.FacebookAccount",{constructor:function(a){this.setAccountIcon("facebook");this.setText("Facebook")},onFacebookEdit:function(){(new KJing.FacebookAccountDialog({user:this.getUser(),account:this})).open()},onFacebookDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({facebookid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onFacebookDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onFacebookEdit,multiple:!1}}}});
Ui.Dialog.extend("KJing.LocalAccountDialog",{user:void 0,account:void 0,loginField:void 0,passwordField:void 0,deleteButton:void 0,saveButton:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte local");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.deleteButton=new Ui.Button({text:"Supprimer"});this.connect(this.deleteButton,"press",this.onDeletePress);
this.saveButton=new Ui.Button({text:"Enregistrer"});this.connect(this.saveButton,"press",this.onSavePress);a=new Ui.VBox({spacing:10});this.setContent(a);this.loginField=new Ui.TextField({value:this.user.getData().login});var b=new Ui.HBox({spacing:10});b.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",width:100}));b.append(this.loginField,!0);a.append(b);this.passwordField=new Ui.TextField({textHolder:"********",passwordMode:!0});b=new Ui.HBox({spacing:10});b.append(new Ui.Text({text:"Mot de passe",
textAlign:"right",verticalAlign:"center",width:100}));b.append(this.passwordField,!0);a.append(b);this.errorMessage=new Ui.Text({color:"red"});this.errorMessage.hide();a.append(this.errorMessage);this.account.testDeleteRight()?this.setActionButtons([this.deleteButton,this.saveButton]):this.setActionButtons([this.saveButton])},onDeletePress:function(){this.account["delete"]();this.close()},onSavePress:function(){var a={};void 0!=this.passwordField.getValue()&&""!=this.passwordField.getValue()&&(a.password=
this.passwordField.getValue());a.login=this.loginField.getValue();a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)});this.connect(a,"done",this.onSaveDone);this.connect(a,"error",this.onSaveError);this.getContent().disable();this.saveButton.disable();this.deleteButton.disable();a.send()},onSaveDone:function(){this.close()},onSaveError:function(a){var b="Echec de la modification. V\u00e9rifier vos donn\u00e9es";403==a.getStatus()&&1==a.getResponseJSON().code&&
(b="Echec: mot de passe trop faible");this.showError(b);this.getContent().enable();this.saveButton.enable();this.deleteButton.enable()},showError:function(a){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!==this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=
void 0;this.errorMessage.hide()}});
KJing.WebAccount.extend("KJing.LocalAccount",{constructor:function(a){this.setAccountIcon("localaccount");this.setText("Local")},onLocalEdit:function(){(new KJing.LocalAccountDialog({user:this.getUser(),account:this})).open()},onLocalDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:null,password:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",icon:"trash",
color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onLocalDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onLocalEdit,multiple:!1}}}});
KJing.OptionSection.extend("KJing.WebAccountSection",{flow:void 0,user:void 0,plus:void 0,googleAccount:void 0,facebookAccount:void 0,localAccount:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Comptes Web");this.selection=[];this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);this.plus=new Ui.Pressable;this.plus.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",verticalAlign:"center",horizontalAlign:"center"}));this.flow.append(this.plus);
this.connect(this.plus,"press",this.onPlusPress)},testPlus:function(){4<=this.flow.getChildren().length?this.plus.hide(!0):this.plus.show()},onPlusPress:function(){(new KJing.WebAccountNewDialog({user:this.user})).open()},onUserChange:function(){null!==this.user.getData().googleid&&void 0===this.googleAccount?(this.googleAccount=new KJing.GoogleAccount({user:this.user}),this.flow.prepend(this.googleAccount)):null===this.user.getData().googleid&&void 0!==this.googleAccount&&(this.flow.remove(this.googleAccount),
this.googleAccount=void 0);null!==this.user.getData().facebookid&&void 0===this.facebookAccount?(this.facebookAccount=new KJing.FacebookAccount({user:this.user}),this.flow.prepend(this.facebookAccount)):null===this.user.getData().facebookid&&void 0!==this.facebookAccount&&(this.flow.remove(this.facebookAccount),this.facebookAccount=void 0);null!==this.user.getData().login&&void 0===this.localAccount?(this.localAccount=new KJing.LocalAccount({user:this.user}),this.flow.prepend(this.localAccount)):
null===this.user.getData().login&&void 0!==this.localAccount&&(this.flow.remove(this.localAccount),this.localAccount=void 0);this.testPlus()}},{onLoad:function(){KJing.WebAccountSection.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){KJing.WebAccountSection.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.DropBox.extend("KJing.UploadFaceButton",{user:void 0,graphic:void 0,uploadable:void 0,lbox:void 0,image:void 0,icon:void 0,constructor:function(a){this.user=a.user;delete a.user;this.addMimetype("files");this.uploadable=new Ui.Uploadable;this.setContent(this.uploadable);this.lbox=new Ui.LBox;this.uploadable.setContent(this.lbox);this.graphic=new Ui.ButtonGraphic;this.lbox.append(this.graphic);this.image=new Ui.Image({width:64,height:64,margin:10});this.lbox.append(this.image);this.connect(this.uploadable,
"down",function(){this.graphic.setIsDown(!0)});this.connect(this.uploadable,"up",function(){this.graphic.setIsDown(!1)});this.connect(this.uploadable,"focus",function(){this.graphic.setHasFocus(!0)});this.connect(this.uploadable,"blur",function(){this.graphic.setHasFocus(!1)});this.connect(this,"dropfile",this.onUploadFile);this.connect(this.uploadable,"file",this.onUploadFile)},onUploadFile:function(a,b){var c=new Core.FilePostUploader({file:b,service:"/cloud/user/"+this.user.getId()+"/face"});this.connect(c,
"progress",this.onUploadProgress);this.connect(c,"complete",this.onUploadComplete);c.send()},onUploadProgress:function(a){},onUploadComplete:function(a){this.image.setSrc("/cloud/user/"+this.user.getId()+"/face");this.user.update()},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())}},{onLoad:function(){KJing.UploadFaceButton.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){KJing.UploadFaceButton.base.onUnload.call(this);
this.disconnect(this.user,"change",this.onUserChange)}});
Ui.Dialog.extend("KJing.UserProfil",{user:void 0,firstnameField:void 0,lastnameField:void 0,emailField:void 0,avatarBlob:void 0,avatarImage:void 0,adminField:void 0,saveButton:void 0,sflow:void 0,webSection:void 0,saveRequests:void 0,errorRequests:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setPreferedWidth(650);this.setPreferedHeight(550);this.setTitle("Profil utilisateur");this.setCancelButton(new Ui.Button({text:"Fermer"}));if(this.user.getIsReady())this.onUserReady();
else this.connect(this.user,"ready",this.onUserReady)},onUserReady:function(){var a=[];if(KJing.User.hasInstance(this.user)&&Ui.App.current.getUser().isAdmin()){var b=new Ui.Button({text:"Commuter"});b.setStyle({"Ui.Button":{color:"#b243ff"}});this.connect(b,"press",this.onSwitchPress);var c=new Ui.Button({text:"Supprimer"});c.setStyle({"Ui.Button":{color:"#d04040"}});this.connect(c,"press",this.onDeletePress);Ui.App.current.getUser().getId()!==this.user.getId()&&a.push(b);a.push(c)}KJing.User.hasInstance(this.user)&&
(this.saveButton=new Ui.Button({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),a.push(this.saveButton));this.setActionButtons(a);a=new Ui.VBox;this.setContent(a);this.sflow=new Ui.SFlow({spacing:5,itemAlign:"stretch"});a.append(this.sflow);b=new KJing.UploadFaceButton({user:this.user,marginLeft:10});this.sflow.append(b,"right");this.firstnameField=new KJing.TextField({title:"Pr\u00e9nom",width:150});this.sflow.append(this.firstnameField);this.lastnameField=new KJing.TextField({title:"Nom",
width:150});this.sflow.append(this.lastnameField);KJing.User.hasInstance(this.user)&&(this.emailField=new KJing.TextField({title:"Email",width:250}),this.sflow.append(this.emailField));this.descField=new KJing.TextAreaField({title:"Description",width:250});this.sflow.append(this.descField);KJing.User.hasInstance(this.user)&&(Ui.App.current.getUser().isAdmin()&&(this.adminField=new Ui.CheckBox({text:"Compte administrateur"}),this.sflow.append(this.adminField)),this.webSection=new KJing.WebAccountSection({user:this.user}),
a.append(this.webSection));this.firstnameField.setValue(this.user.getData().firstname);this.lastnameField.setValue(this.user.getData().lastname);this.descField.setValue(this.user.getData().description);KJing.User.hasInstance(this.user)?(this.emailField.setValue(this.user.getData().email),Ui.App.current.getUser().isAdmin()&&this.adminField.setValue(this.user.getData().admin)):this.sflow.disable()},onSavePress:function(){this.saveRequests=[];this.errorRequests=[];var a={};a.firstname=this.firstnameField.getValue();
a.lastname=this.lastnameField.getValue();a.email=this.emailField.getValue();""===a.email&&(a.email=null);a.description=this.descField.getValue();Ui.App.current.getUser().isAdmin()&&(a.admin=this.adminField.getValue());a=Core.Object.diff(this.user.getData(),a);void 0!==a&&(a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)}),this.connect(a,"done",this.onSaveDone),this.connect(a,"error",this.onSaveError),this.saveRequests.push(a),a.send());0===this.saveRequests.length?
this.close():(this.sflow.disable(),this.saveButton.disable())},testSaveEnd:function(){if(0==this.saveRequests.length)if(0<this.errorRequests.length){this.sflow.enable();this.saveButton.enable();var a=new Ui.Dialog({preferedWidth:300,title:"Echec de l'enregistrement"});a.setContent(new Ui.Text({text:"L'enregistrement \u00e0 \u00e9chou\u00e9. V\u00e9rifiez que votre mot de passe respecte la politique de s\u00e9curit\u00e9. A savoir qu'il doit faire au moins 8 caract\u00e8res et contenir des chiffres et des lettres."}));
var b=new Ui.Button({text:"Fermer"});a.setActionButtons([b]);this.connect(b,"press",function(){a.close()});a.open()}else this.close()},onSaveDone:function(a){for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==b&&this.saveRequests.splice(b,1);this.testSaveEnd()},onSaveError:function(a){this.errorRequests.push(a);for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==b&&this.saveRequests.splice(b,1);this.testSaveEnd()},
onDeletePress:function(){var a=new Ui.Dialog({title:"Suppression de compte",fullScrolling:!1,preferedWidth:300});a.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer ce compte ? ATTENTION, cet utilisateur et toutes ses ressources n'existeront plus apr\u00e8s cette action."}));a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Ui.Button({text:"Supprimer"});b.setStyle({"Ui.Button":{color:"#d04040"}});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();var b=new Core.HttpRequest({method:"DELETE",
url:"/cloud/user/"+this.user.getId()});this.connect(b,"done",function(){a.close();Ui.App.current.setMainPath("");this.close()});this.connect(b,"error",function(){a.close();this.close()});b.send()});a.open()},onSwitchPress:function(){var a=void 0,b=new Ui.Dialog({title:"Connexion au compte",fullScrolling:!1,preferedWidth:300});b.setContent(new Ui.Text({text:"Voulez vous vraiment ouvrir une session sur le compte de cet utilisateur ? ATTENTION, vous ne serez plus sur votre compte et vous aller agir au nom de cette personne."}));
b.setCancelButton(new Ui.Button({text:"Annuler"}));var c=new Ui.Button({text:"Commuter"});c.setStyle({"Ui.Button":{color:"#b243ff"}});c.disable();b.setActionButtons([c]);var d=new Core.HttpRequest({method:"POST",url:"/cloud/authsession",content:JSON.stringify({user:this.user.getId()})});this.connect(d,"done",function(){a=d.getResponseJSON();c.enable()});d.send();this.connect(c,"press",function(){b.close();window.open("/?authsession="+a.id)});b.open()}});KJing.ItemView.extend("KJing.RightItemView",{resource:void 0,right:void 0,user:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.right=a.right;delete a.right;this.user=KJing.Resource.create(this.right.user);KJing.Group.hasInstance(this.user)?this.setItemIcon("group"):(this.setRoundMode(!0),this.setItemImage(this.user.getFaceUrl()),this.setItemName(this.user.getName()));a=void 0;this.right.write&&this.right.admin?a=["pen","tools"]:this.right.write?a=["pen"]:this.right.admin&&
(a=["tools"]);this.setItemTags(a)},getResource:function(){return this.resource},getUser:function(){return this.user},onUserChange:function(){this.setItemName(this.user.getName());KJing.User.hasInstance(this.user)&&this.setItemImage(this.user.getFaceUrl())}},{onLoad:function(){KJing.RightItemView.base.onLoad.apply(this,arguments);this.connect(this.user,"change",this.onUserChange)},onUnload:function(){KJing.RightItemView.base.onUnload.apply(this,arguments);this.disconnect(this.user,"change",this.onUserChange)},
getSelectionActions:function(){return KJing.RightItemView.actions}},{actions:void 0,constructor:function(a){KJing.RightItemView.actions={suppress:{icon:"trash",text:"Supprimer","default":!0,multiple:!0,callback:KJing.RightItemView.onSuppressAction}}},onSuppressAction:function(a){a=a.getElements();for(var b=[],c=0;c<a.length;c++)b.push({user:a[c].getUser().getId(),read:!1,write:!1,admin:!1});a[0].getResource().addRights(b)}});
KJing.NewItem.extend("KJing.RightNewItem",{resource:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.connect(this,"press",this.onNewPress)},onNewPress:function(){(new KJing.NewResourceDialog({resource:this.resource,types:["rightuser","rightgroup"]})).open()}});
KJing.OptionSection.extend("KJing.ResourceRightsSection",{resource:void 0,flow:void 0,constructor:function(a){this.setTitle("Droits");this.resource=a.resource;delete a.resource;this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);if(this.resource.getIsReady())this.onResourceChange()},onResourceChange:function(){this.flow.clear();var a=new KJing.RightNewItem({resource:this.resource});this.flow.append(a);for(var a=this.resource.getRights(),b=0;b<a.length;b++){var c=new KJing.RightItemView({resource:this.resource,
right:a[b]});this.flow.append(c)}this.resource.canAdmin()||this.flow.disable()}},{onLoad:function(){KJing.ResourceRightsSection.base.onLoad.apply(this,arguments);this.connect(this.resource,"change",this.onResourceChange)},onUnload:function(){KJing.ResourceRightsSection.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange)}});
Ui.Dialog.extend("KJing.ResourcePropertiesDialog",{resource:void 0,constructor:function(a){this.setFullScrolling(!0);this.setPreferedWidth(500);this.setPreferedHeight(500);this.setTitle("Propri\u00e9t\u00e9s");this.resource=a.resource;delete a.resource;a=new Ui.SFlow({itemAlign:"stretch",spacing:5});this.setContent(a);var b=new KJing.TextField({title:"Identifiant",value:this.resource.getId(),width:200});b.disable();a.append(b);b=new KJing.TextField({title:"Nom",value:this.resource.getName(),width:200});
a.append(b);KJing.Device.hasInstance(this.resource)?(b=new KJing.TextField({title:"URL du client Web"}),b.setValue((new Core.Uri({uri:"../client/?device="+this.resource.getId()})).toString()),b.disable(),a.append(b)):KJing.Map.hasInstance(this.resource)?(b=new KJing.TextField({title:"URL des clients Web",width:300}),b.setValue((new Core.Uri({uri:"../client/?parent="+this.resource.getId()})).toString()),b.disable(),a.append(b)):KJing.Share.hasInstance(this.resource)&&(b=new KJing.TextField({title:"Espace utilis\u00e9",
width:200}),b.disable(),b.setValue(this.formatSize(this.resource.getData().used)),a.append(b));b=new KJing.ResourceRightsSection({resource:this.resource});a.append(b);this.setCancelButton(new Ui.Button({text:"Fermer"}));this.resource.canWrite()?(a=new Ui.Button({text:"Enregister"}),this.connect(a,"press",this.onSavePress),this.setActionButtons([a])):a.disable()},formatSize:function(a){return 1E9<a?(a/1E9).toFixed(2)+" Go":1E6<a?(a/1E6).toFixed(2)+" Mo":1E3<a?(a/1E3).toFixed(2)+" ko":a+" octets"},
onSavePress:function(){console.log(this+".onSavePress")}});KJing.ItemView.extend("KJing.GroupAddUserItemView",{resource:void 0,group:void 0,constructor:function(a){this.setRoundMode(!0);this.resource=a.resource;delete a.resource;this.group=a.group;delete a.group;this.setItemImage(this.getResource().getFaceUrl());this.setItemName(this.getResource().getName())},getResource:function(){return this.resource},getGroup:function(){return this.group}},{getSelectionActions:function(){return KJing.GroupAddUserItemView.actions}},{actions:void 0,constructor:function(){KJing.GroupAddUserItemView.actions=
{add:{text:"Ajouter",icon:"plus","default":!0,callback:KJing.GroupAddUserItemView.onAddAction,multiple:!0}}},onAddAction:function(a){a=a.getElements();for(var b=[],c=0;c<a.length;c++)b.push(a[c].getResource());a[0].getGroup().addUsers(b);a[0].getView().create()}});
KJing.ItemView.extend("KJing.GroupAddGroupItemView",{resource:void 0,group:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.group=a.group;delete a.group;this.setItemIcon("group");this.setItemName(this.getResource().getName())},getResource:function(){return this.resource},getGroup:function(){return this.group}},{getSelectionActions:function(){return KJing.GroupAddGroupItemView.actions}},{actions:void 0,constructor:function(){KJing.GroupAddGroupItemView.actions={add:{text:"Ajouter",
icon:"plus","default":!0,callback:KJing.GroupAddGroupItemView.onAddAction,multiple:!0}}},onAddAction:function(a){a=a.getElements();for(var b=[],c=0;c<a.length;c++)b.push(a[c].getResource());a[0].getGroup().addUsers(b);a[0].getView().create()}});
KJing.ItemView.extend("KJing.RightAddUserItemView",{resource:void 0,target:void 0,constructor:function(a){this.setRoundMode(!0);this.resource=a.resource;delete a.resource;this.target=a.target;delete a.target;this.setItemImage(this.getResource().getFaceUrl());this.setItemName(this.getResource().getName())},getResource:function(){return this.resource},getTarget:function(){return this.target}},{getSelectionActions:function(){return KJing.RightAddUserItemView.actions}},{actions:void 0,constructor:function(){KJing.RightAddUserItemView.actions=
{add:{text:"Ajouter",icon:"plus","default":!0,callback:KJing.RightAddUserItemView.onAddAction,multiple:!0}}},onAddAction:function(a){a=a.getElements();for(var b=a[0].getView().getRights(),c=[],d=0;d<a.length;d++)c.push({user:a[d].getResource().getId(),read:b.read,write:b.write,admin:b.admin});a[0].getTarget().addRights(c);a[0].getView().create()}});
KJing.ItemView.extend("KJing.RightAddGroupItemView",{resource:void 0,target:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.target=a.target;delete a.target;this.setItemIcon("group");this.setItemName(this.getResource().getName())},getResource:function(){return this.resource},getTarget:function(){return this.target}},{getSelectionActions:function(){return KJing.RightAddGroupItemView.actions}},{actions:void 0,constructor:function(){KJing.RightAddGroupItemView.actions={add:{text:"Ajouter",
icon:"plus","default":!0,callback:KJing.RightAddGroupItemView.onAddAction,multiple:!0}}},onAddAction:function(a){a=a.getElements();for(var b=a[0].getView().getRights(),c=[],d=0;d<a.length;d++)c.push({user:a[d].getResource().getId(),read:b.read,write:b.write,admin:b.admin});a[0].getTarget().addRights(c);a[0].getView().create()}});
Ui.SFlow.extend("KJing.NewResourceSelector",{types:void 0,constructor:function(a){this.addEvents("done");"types"in a&&(this.types=a.types,delete a.types);this.setItemAlign("stretch");this.setSpacing(5);a={folder:{icon:"folder",text:"Dossier",creator:KJing.NewFolderCreator},user:{icon:"person",text:"Utilisateur",creator:KJing.NewUserCreator},group:{icon:"group",text:"Groupe de personne",creator:KJing.NewGroupCreator},share:{icon:"files",text:"Partage de fichiers",creator:KJing.NewShareCreator},map:{icon:"map",
text:"Salle de diffusion",creator:KJing.NewMapCreator},groupuser:{icon:"person",text:"Utilisateur",creator:KJing.NewGroupUserCreator},groupgroup:{icon:"group",text:"Groupe de personne",creator:KJing.NewGroupGroupCreator},rightuser:{icon:"person",text:"Utilisateur",creator:KJing.NewRightUserCreator},rightgroup:{icon:"group",text:"Group de personne",creator:KJing.NewRightGroupCreator},device:{icon:"eye",text:"Client de diffusion",creator:KJing.NewDeviceCreator}};for(var b in a){if(void 0!==this.types){for(var c=
!1,d=0;!c&&d<this.types.length;d++)c=this.types[d]===b;if(!c)continue}c=a[b];d=new Ui.Button({text:c.text,icon:c.icon,orientation:"horizontal",width:200});d.kjingNewResourceSelectorType=c;this.connect(d,"press",this.onButtonPress);this.append(d)}},onButtonPress:function(a){this.fireEvent("done",this,a.kjingNewResourceSelectorType)}});
Ui.VBox.extend("KJing.NewGroupUserCreator",{resource:void 0,searchField:void 0,flow:void 0,valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.connect(this.searchField,"validate",this.onSearchValidate);this.append(this.searchField);this.flow=new Ui.Flow;this.append(this.flow)},create:function(){this.fireEvent("done",this)},onSearchValidate:function(){var a=new Core.HttpRequest({method:"GET",
url:"/cloud/user?seenBy="+Ui.App.current.getUser().getId()+"&query="+encodeURIComponent(this.searchField.getValue())});this.connect(a,"done",this.onSearchDone);this.connect(a,"error",this.onSearchError);a.send()},onSearchDone:function(a){a=a.getResponseJSON();this.flow.clear();for(var b=0;b<a.length;b++){var c=KJing.Resource.create(a[b]);console.log(c);c=new KJing.GroupAddUserItemView({resource:c,group:this.resource,view:this});this.flow.append(c)}},onSearchError:function(a){}});
Ui.VBox.extend("KJing.NewGroupGroupCreator",{resource:void 0,searchField:void 0,flow:void 0,valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.connect(this.searchField,"validate",this.onSearchValidate);this.append(this.searchField);this.flow=new Ui.Flow;this.append(this.flow)},create:function(){this.fireEvent("done",this)},onSearchValidate:function(){var a=new Core.HttpRequest({method:"GET",
url:"/cloud/resource?seenBy="+Ui.App.current.getUser().getId()+"&type=group&query="+encodeURIComponent(this.searchField.getValue())});this.connect(a,"done",this.onSearchDone);this.connect(a,"error",this.onSearchError);a.send()},onSearchDone:function(a){a=a.getResponseJSON();this.flow.clear();for(var b=0;b<a.length;b++){var c=KJing.Resource.create(a[b]),c=new KJing.GroupAddGroupItemView({resource:c,group:this.resource,view:this});this.flow.append(c)}},onSearchError:function(a){}});
Ui.VBox.extend("KJing.NewRightUserCreator",{resource:void 0,searchField:void 0,writeField:void 0,readField:void 0,flow:void 0,valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.connect(this.searchField,"validate",this.onSearchValidate);this.append(this.searchField);a=new Ui.HBox;this.append(a);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.adminField=new Ui.CheckBox({text:"Administrer"});
a.append(this.writeField,!0);a.append(this.adminField,!0);this.flow=new Ui.Flow;this.append(this.flow)},getRights:function(){return{read:!0,write:this.writeField.getValue(),admin:this.adminField.getValue()}},create:function(){this.fireEvent("done",this)},onSearchValidate:function(){var a=new Core.HttpRequest({method:"GET",url:"/cloud/user?seenBy="+Ui.App.current.getUser().getId()+"&query="+encodeURIComponent(this.searchField.getValue())});this.connect(a,"done",this.onSearchDone);this.connect(a,"error",
this.onSearchError);a.send()},onSearchDone:function(a){a=a.getResponseJSON();this.flow.clear();for(var b=0;b<a.length;b++){var c=KJing.Resource.create(a[b]);console.log(c);c=new KJing.RightAddUserItemView({resource:c,target:this.resource,view:this});this.flow.append(c)}},onSearchError:function(a){}});
Ui.VBox.extend("KJing.NewRightGroupCreator",{resource:void 0,searchField:void 0,writeField:void 0,readField:void 0,flow:void 0,valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.connect(this.searchField,"validate",this.onSearchValidate);this.append(this.searchField);a=new Ui.HBox;this.append(a);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.adminField=new Ui.CheckBox({text:"Administrer"});
a.append(this.writeField,!0);a.append(this.adminField,!0);this.flow=new Ui.Flow;this.append(this.flow)},getRights:function(){return{read:!0,write:this.writeField.getValue(),admin:this.adminField.getValue()}},create:function(){this.fireEvent("done",this)},onSearchValidate:function(){var a=new Core.HttpRequest({method:"GET",url:"/cloud/resource?seenBy="+Ui.App.current.getUser().getId()+"&type=group&query="+encodeURIComponent(this.searchField.getValue())});this.connect(a,"done",this.onSearchDone);this.connect(a,
"error",this.onSearchError);a.send()},onSearchDone:function(a){a=a.getResponseJSON();this.flow.clear();for(var b=0;b<a.length;b++){var c=KJing.Resource.create(a[b]),c=new KJing.RightAddGroupItemView({resource:c,target:this.resource,view:this});this.flow.append(c)}},onSearchError:function(a){}});
Ui.SFlow.extend("KJing.NewUserCreator",{resource:void 0,firstnameField:void 0,lastnameField:void 0,loginField:void 0,passwordField:void 0,valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.setItemAlign("stretch");this.firstnameField=new KJing.TextField({title:"Pr\u00e9nom",width:100});this.connect(this.firstnameField,"change",this.checkValid);this.append(this.firstnameField);this.lastnameField=new KJing.TextField({title:"Nom",
width:100});this.connect(this.lastnameField,"change",this.checkValid);this.append(this.lastnameField);this.loginField=new KJing.TextField({title:"Identifiant",width:200});this.connect(this.loginField,"change",this.checkValid);this.append(this.loginField);this.passwordField=new KJing.TextField({title:"Mot de passe",width:200,passwordMode:!0,desc:"8 caract\u00e8res minimum avec chiffre et lettre"});this.connect(this.passwordField,"change",this.checkValid);this.append(this.passwordField)},create:function(){var a=
new Core.HttpRequest({method:"POST",url:"/cloud/resource",content:JSON.stringify({type:"user",parent:this.resource.getId(),firstname:this.firstnameField.getValue(),lastname:this.lastnameField.getValue(),login:this.loginField.getValue(),password:this.passwordField.getValue()})});this.connect(a,"done",this.onRequestDone);this.connect(a,"done",this.onRequestFail);this.valid=!1;this.fireEvent("notvalid",this);a.send()},onRequestFail:function(){this.valid=!0;this.fireEvent("valid",this)},onRequestDone:function(){this.fireEvent("done",
this)},checkValid:function(){var a=""!==this.loginField.getValue(),b=this.passwordField.getValue(),a=a&""!==b&8<=b.length;this.valid!==a&&((this.valid=a)?this.fireEvent("valid",this):this.fireEvent("notvalid",this))}});
Ui.SFlow.extend("KJing.NewResourceCreator",{nameField:void 0,resource:void 0,resourceType:"resource",valid:!1,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.setItemAlign("stretch");this.nameField=new KJing.TextField({title:"Nom",width:150});this.connect(this.nameField,"change",this.checkValid);this.append(this.nameField)},setType:function(a){this.type=a},create:function(){var a=new Core.HttpRequest({method:"POST",url:"/cloud/resource",
content:JSON.stringify({type:this.type,parent:this.resource.getId(),name:this.nameField.getValue()})});this.connect(a,"done",this.onRequestDone);this.connect(a,"done",this.onRequestFail);this.valid=!1;this.fireEvent("notvalid",this);a.send()},onRequestFail:function(){this.valid=!0;this.fireEvent("valid",this)},onRequestDone:function(){this.fireEvent("done",this)},checkValid:function(){var a=""!==this.nameField.getValue();this.valid!==a&&((this.valid=a)?this.fireEvent("valid",this):this.fireEvent("notvalid",
this))}});KJing.NewResourceCreator.extend("KJing.NewGroupCreator",{constructor:function(a){this.setType("group")}});KJing.NewResourceCreator.extend("KJing.NewMapCreator",{constructor:function(a){this.setType("map")}});KJing.NewResourceCreator.extend("KJing.NewFolderCreator",{constructor:function(a){this.setType("folder")}});KJing.NewResourceCreator.extend("KJing.NewShareCreator",{constructor:function(a){this.setType("share")}});
Ui.SFlow.extend("KJing.AirPlayDeviceForm",{addressField:void 0,passwordField:void 0,constructor:function(a){this.setItemAlign("stretch");this.setSpacing(10);this.addressField=new KJing.TextField({title:"Nom de l'h\u00f4te (ou adresse IP)",width:150});this.append(this.addressField);this.passwordField=new KJing.TextField({title:"Mot de passe (si n\u00e9cessaire)",width:150,passwordMode:!0});this.append(this.passwordField)}});
Ui.SFlow.extend("KJing.ChromecastDeviceForm",{addressField:void 0,constructor:function(a){this.setItemAlign("stretch");this.setSpacing(10);this.addressField=new KJing.TextField({title:"Nom de l'h\u00f4te (ou adresse IP)",width:150});this.append(this.addressField)}});
Ui.SFlow.extend("KJing.NewDeviceCreator",{resource:void 0,form:void 0,valid:!1,nameField:void 0,protocolField:void 0,constructor:function(a){this.addEvents("done","valid","notvalid");this.resource=a.resource;delete a.resource;this.setItemAlign("stretch");this.setSpacing(10);this.nameField=new KJing.TextField({title:"Nom",width:150});this.connect(this.nameField,"change",this.checkValid);this.append(this.nameField);this.protocolField=new KJing.ComboField({title:"Protocole",field:"text"});this.protocolField.setData([{text:"Web",
protocol:"web"},{text:"AirPlay",protocol:"airplay",creator:KJing.AirPlayDeviceForm},{text:"Chromecast",protocol:"chromecast",creator:KJing.ChromecastDeviceForm}]);this.protocolField.setCurrentAt(0);this.connect(this.protocolField,"change",this.onProtocolChange);this.append(this.protocolField)},create:function(){this.valid=!1;this.fireEvent("notvalid",this);var a=this.protocolField.getValue(),a={type:"device",parent:this.resource.getId(),protocol:a.protocol,name:this.nameField.getValue()},a=new Core.HttpRequest({method:"POST",
url:"/cloud/resource",content:JSON.stringify(a)});this.connect(a,"done",function(){this.fireEvent("done",this)});this.connect(a,"error",function(){this.fireEvent("done",this)});a.send()},checkValid:function(){var a=""!==this.nameField.getValue();this.valid!==a&&((this.valid=a)?this.fireEvent("valid",this):this.fireEvent("notvalid",this))},onProtocolChange:function(a,b,c){void 0!==this.form&&(this.remove(this.form),this.form=void 0);void 0!==b.creator&&(this.form=new b.creator,this.append(this.form));
this.checkValid()}});
Ui.Dialog.extend("KJing.NewResourceDialog",{transBox:void 0,resource:void 0,prevButton:void 0,createButton:void 0,creator:void 0,selector:void 0,types:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;"types"in a&&(this.types=a.types,delete a.types);this.setTitle("Nouvelle ressource");this.setFullScrolling(!0);this.setPreferedWidth(400);this.setPreferedHeight(400);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.selector=new KJing.NewResourceSelector({types:this.types});this.connect(this.selector,
"done",this.onSelectorDone);this.transBox.replaceContent(this.selector);this.setCancelButton(new Ui.Button({text:"Annuler"}));this.prevButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.connect(this.prevButton,"press",this.onPrevPress);this.createButton=new Ui.Button({text:"Cr\u00e9er"});this.connect(this.createButton,"press",this.onCreatePress)},onSelectorDone:function(a,b){this.setTitle(b.text);this.setActionButtons([this.prevButton,this.createButton]);this.creator=new b.creator({resource:this.resource});
this.transBox.replaceContent(this.creator);this.connect(this.creator,"done",this.onCreatorDone);this.connect(this.creator,"valid",this.onCreatorValid);this.connect(this.creator,"notvalid",this.onCreatorNotvalid);this.onCreatorNotvalid(this.creator)},onPrevPress:function(){this.setTitle("Nouvelle ressource");this.setActionButtons([]);this.transBox.replaceContent(this.selector);void 0!==this.creator&&(this.disconnect(this.creator,"done",this.onCreatorDone),this.disconnect(this.creator,"valid",this.onCreatorValid),
this.disconnect(this.creator,"notvalid",this.onCreatorNovalid),this.creator=void 0)},onCreatePress:function(){this.creator.create()},onCreatorDone:function(){this.close();this.resource.update()},onCreatorValid:function(){this.createButton.enable()},onCreatorNotvalid:function(){this.createButton.disable()}});Ui.CanvasElement.extend("KJing.ScaledImage",{image:void 0,constructor:function(a){this.image=new Ui.Image;this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onImageReady:function(){this.invalidateDraw()}},{updateCanvas:function(a){if(this.image.getIsReady()){var b=this.image.getNaturalWidth(),c=this.image.getNaturalHeight(),d=this.getLayoutWidth(),e=this.getLayoutHeight(),
f,g;b<=d&&c<=e?(d=(d-b)/2,e=(e-c)/2,f=b,g=c):b/c<d/e?(g=e,f=b*g/c,d=-(f-d)/2,e=0):(f=d,g=c*f/b,d=0,e=-(g-e)/2);a.drawImage(this.image.getDrawing(),0,0,b,c,d,e,f,g)}}});Ui.Fixed.extend("KJing.ScaledImage2",{image:void 0,src:void 0,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();
this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a/b<c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}});Ui.CanvasElement.extend("KJing.PosButton",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#444444";a.beginPath();a.arc(b/2,c/2,d,0,2*Math.PI,!1);a.closePath();a.fill();a.fillStyle="rgb(240,240,240)";a.beginPath();a.arc(b/2,c/2,0.66*d,0,2*Math.PI,!1);a.closePath();a.fill()},measureCore:function(a,b){return{width:30,height:30}}});
Ui.CanvasElement.extend("KJing.PosBar",{currentPos:0,loadPos:0,setCurrentPos:function(a){a!=this.currentPos&&(this.currentPos=a,this.invalidateDraw())},getCurrentPos:function(){return this.currentPos},setLoadPos:function(a){a!=this.loadPos&&(this.loadPos=a,this.invalidateDraw())},getLoadPos:function(){return this.loadPos},drawBar:function(a,b,c,d,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.fill();a.rect(b,c-e,d,2*e);a.fill();a.beginPath();a.arc(b+d,c,e,0,2*Math.PI,!1);a.closePath();
a.fill()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#aaaaaa";this.drawBar(a,d,c/2,b-2*d,0.5*d);a.fillStyle="#888888";0<this.loadPos&&this.drawBar(a,d,c/2,(b-2*d)*this.loadPos,0.5*d);a.fillStyle="#ffc30b";0<this.currentPos&&this.drawBar(a,d,c/2,(b-2*d)*this.currentPos,0.5*d)},measureCore:function(a,b){return{width:20,height:20}}});
Ui.Container.extend("KJing.MediaProgressBar",{posButton:void 0,posBar:void 0,pos:0,constructor:function(a){this.addEvents("up","down","move");this.posBar=new KJing.PosBar({verticalAlign:"center"});this.appendChild(this.posBar);a=new KJing.PosButton;this.posButton=new Ui.Movable({moveVertical:!1,horizontalAlign:"left",verticalAlign:"center"});this.connect(this.posButton,"move",this.onButtonMove);this.connect(this.posButton,"up",this.onButtonUp);this.connect(this.posButton,"down",this.onButtonDown);
this.posButton.setContent(a);this.appendChild(this.posButton)},getCurrentPos:function(){return this.posBar.getCurrentPos()},getLoadPos:function(){return this.posBar.getLoadPos()},setLoadPos:function(a){this.posBar.setLoadPos(a)},onButtonMove:function(a){this.pos=Math.min(1,Math.max(0,a.getPositionX()/(this.getLayoutWidth()-a.getLayoutWidth())));this.updatePos();this.fireEvent("move",this)},onButtonUp:function(a){this.fireEvent("up",this)},onButtonDown:function(a){this.fireEvent("down",this)},updatePos:function(){this.disconnect(this.posButton,
"move",this.onButtonMove);this.posButton.setPosition((this.getLayoutWidth()-this.posButton.getLayoutWidth())*this.pos,void 0);this.connect(this.posButton,"move",this.onButtonMove);this.posBar.setCurrentPos(this.pos)},setPos:function(a){this.pos!=a&&(this.pos=a,this.invalidateArrange())}},{measureCore:function(a,b){var c=this.posBar.measure(a,b),d=this.posButton.measure(a,b);return{width:Math.max(c.width,d.width),height:Math.max(c.height,d.height)}},arrangeCore:function(a,b){this.posBar.arrange(0,
0,a,b);this.posButton.arrange(0,0,a,b);this.updatePos()}});
Ui.CanvasElement.extend("KJing.PlayButton",{mode:"play",clock:void 0,backgroundVisible:!0,constructor:function(a){},setMode:function(a){a!=this.mode&&(this.mode=a,this.invalidateDraw(),"load"==a?(this.clock=new Anim.Clock({duration:"forever",scope:this,onTimeupdate:function(a,c){this.invalidateDraw()}}),this.getIsVisible()&&this.clock.begin()):void 0!=this.clock&&(this.clock.stop(),this.clock=void 0))},setBackgroundVisible:function(a){this.backgroundVisible!=a&&(this.backgroundVisible=a,this.invalidateDraw())}},
{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);this.backgroundVisible&&(a.fillStyle="rgba(221,221,221,0.6)",a.beginPath(),a.arc(b/2,c/2,d,0,2*Math.PI,!1),a.closePath(),a.fill());a.fillStyle="#444444";if("play"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2+0.6*d,c/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill();else if("pause"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2-0.3*d+d/5,c/2-d/2),a.lineTo(b/
2-0.3*d+d/5,c/2+d/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill(),a.beginPath(),a.moveTo(b/2+0.1*d,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2+d/2),a.lineTo(b/2+0.1*d,c/2+d/2),a.closePath(),a.fill();else for(a.translate(b/2,c/2),b=this.clock.getTime()%1,c=0;8>c;c++)a.save(),a.rotate(2*Math.PI*c/8+1*Math.PI*b),a.beginPath(),a.arc(0,d/2,5,0,2*Math.PI,!1),a.closePath(),a.fill(),a.restore()},measureCore:function(a,b){return{width:20,height:20}},onVisible:function(){void 0!=
this.clock&&this.clock.begin()},onHidden:function(){void 0!=this.clock&&this.clock.stop()}});
Ui.LBox.extend("KJing.MediaPlayBar",{media:void 0,progressBar:void 0,playButton:void 0,posLabel:void 0,totalLabel:void 0,seeking:!1,constructor:function(a){this.media=a.media;delete a.media;this.connect(this.media,"ready",this.onMediaReady);this.connect(this.media,"timeupdate",this.onMediaTimeUpdate);this.connect(this.media,"bufferingupdate",this.onMediaBufferingUpdate);this.connect(this.media,"statechange",this.onMediaStateChange);this.append(new Ui.Shadow({shadowWidth:2,radius:3,inner:!1,opacity:0.5,
color:"#555555"}));this.append(new Ui.Rectangle({fill:"rgb(240,240,240)",margin:2,radius:3}));a=new Ui.HBox({margin:5});this.append(a);var b=new Ui.Pressable;this.connect(b,"press",this.onPlayPress);this.playButton=new KJing.PlayButton({mode:"play",backgroundVisible:!1,width:60,height:60});b.setContent(this.playButton);"playing"!=this.media.getState()&&"buffering"!=this.media.getState()||this.playButton.setMode("pause");a.append(b);b=new Ui.LBox;a.append(b,!0);this.progressBar=new KJing.MediaProgressBar({height:30,
verticalAlign:"center"});this.connect(this.progressBar,"down",this.onProgressBarDown);this.connect(this.progressBar,"up",this.onProgressBarUp);b.append(this.progressBar,!0);this.media.getIsReady()||this.progressBar.disable();a=new Ui.HBox({marginLeft:10,marginRight:10,verticalAlign:"bottom"});b.append(a);this.posLabel=new Ui.Label({text:"",color:"#444444"});this.totalLabel=new Ui.Label({text:"",color:"#444444"});a.append(this.posLabel);a.append(new Ui.Element,!0);a.append(this.totalLabel)},updateLabels:function(){var a=
this.media.getDuration();if(void 0==a)this.totalLabel.setText("");else{var b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":";this.totalLabel.setText(10>b?a+("0"+b):a+b)}a=this.media.getCurrentTime();void 0==a?this.posLabel.setText(""):(b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":",a=10>b?a+("0"+b):a+b,this.posLabel.setText(a))},updatePos:function(){if(void 0!=this.media.getDuration()){var a=this.media.getCurrentTime();void 0==a&&(a=0);this.seeking||this.progressBar.setPos(a/
this.media.getDuration())}else this.progressBar.setPos(0)},onPlayPress:function(){var a=this.media.getState();"initial"==a?this.media.play():"paused"==a?this.media.play():"playing"==a?this.media.pause():"buffering"==a&&this.media.pause()},onProgressBarDown:function(){this.seeking=!0},onProgressBarMove:function(){this.media.setCurrentTime(this.progressBar.getCurrentPos()*this.media.getDuration())},onProgressBarUp:function(){this.seeking=!1;this.media.setCurrentTime(this.progressBar.getCurrentPos()*
this.media.getDuration())},onMediaStateChange:function(a,b){"playing"==b||"buffering"==b?this.playButton.setMode("pause"):"initial"!=b&&"paused"!=b||this.playButton.setMode("play")},onMediaReady:function(){this.progressBar.enable();this.updatePos();this.updateLabels()},onMediaTimeUpdate:function(){this.updatePos();this.updateLabels()},onMediaBufferingUpdate:function(){this.progressBar.setLoadPos((this.media.getCurrentTime()+this.media.getCurrentBufferSize())/this.media.getDuration())}});
Ui.LBox.extend("KJing.AudioPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,label:void 0,constructor:function(a){this.addEvents("end");this.media=new Ui.Audio;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnded);a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.append(a);var b=new Ui.Shape({horizontalAlign:"center",width:150,height:150,scale:1.5,path:"M 93.161,0.071 C 59.66,-1.043 32.22,11.314 32.22,11.314 L 32.2,74.023 c -3.411,-1.354 -7.559,-1.675 -11.772,-0.651 -9.083,2.207 -15.031,9.82 -13.285,17.007 1.746,7.187 10.524,11.225 19.606,9.019 8.564,-2.081 14.338,-8.969 13.507,-15.772 l 0,0 0,-46.855 c 0,0 19.404,-6.784 44.573,-8.485 l 0,34.849 0,0 C 81.455,61.843 77.386,61.55 73.25,62.555 64.167,64.761 58.219,72.374 59.965,79.562 61.71,86.749 70.488,90.786 79.571,88.58 87.502,86.653 93.042,80.603 93.158,74.316 l 0.003,0.004 c 0,-0.002 0,-61.521 0,-74.249 z"});
a.append(b);this.label=new Ui.Text({textAlign:"center",fontSize:20,width:300});a.append(this.label);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);this.playButton=new KJing.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.append(a);this.mediaBar=new KJing.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},
setText:function(a){this.label.setText(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},onMediaEnded:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?this.playButton.setMode("pause"):"paused"==b||"initial"==b?this.playButton.setMode("play"):"buffering"==b&&this.playButton.setMode("load")},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():
"initial"==a&&this.media.play()}});Ui.LBox.extend("KJing.VideoPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,controlBox:void 0,controlsVisible:!0,constructor:function(a){this.addEvents("statechange","end");this.media=new Ui.Video;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnd);this.controlBox=new Ui.LBox;this.append(this.controlBox);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);
this.playButton=new KJing.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.controlBox.append(a);this.mediaBar=new KJing.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.controlBox.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},setPoster:function(a){this.media.setPoster(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},getState:function(){return this.media.getState()},
getIsControlsVisible:function(){return this.controlsVisible},showControls:function(){this.controlsVisible=!0;this.controlBox.show()},hideControls:function(){this.controlsVisible=!1;this.controlBox.hide()},onMediaEnd:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?(this.hideControls(),this.playButton.setMode("pause")):"paused"==b||"initial"==b?(this.showControls(),this.playButton.setMode("play")):"buffering"==b&&(this.showControls(),this.playButton.setMode("load"));
this.fireEvent("statechange",this,b)},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():"initial"==a&&this.media.play()}});Ui.HBox.extend("Storage.FileViewer",{uploader:void 0,file:void 0,controller:void 0,updateNeeded:!1,viewer:void 0,tools:void 0,contentBox:void 0,playing:!1,contentViewer:void 0,constructor:function(a){this.addEvents("toolschange","end");this.tools=[];this.contentBox=new Ui.LBox;this.append(this.contentBox,!0);"uploader"in a?(this.uploader=a.uploader,delete a.uploader):"file"in a&&(this.update(a.file),delete a.file);"controller"in a&&(this.controller=a.controller,delete a.controller)},getPosition:function(){return void 0!==
this.contentViewer&&"getPosition"in this.contentViewer?this.contentViewer.getPosition():0},setPosition:function(a){if(void 0!==this.contentViewer&&"setPosition"in this.contentViewer)return this.contentViewer.setPosition(a)},setContentTransform:function(a){if(void 0!==this.contentViewer&&"setContentTransform"in this.contentViewer)return this.contentViewer.setContentTransform(a)},getController:function(){return this.controller},update:function(a){if(void 0===this.file||this.updateNeeded||this.file.rev!=
a.rev)this.file=a,this.updateNeeded=!1,this.getIsLoaded()&&this.buildContent()},removeContent:function(){this.contentBox.setContent()},buildContent:function(){void 0!==this.uploader?this.contentBox.setContent(new Storage.UploaderViewer({storage:this.storage,uploader:this.uploader,fileViewer:this})):(console.log("buildContent file: "+this.file.getId()+", mime: "+this.file.getData().mimetype),console.log(this.file.getData()),this.tools=[],this.supportProperties=!0,"image/gif"==this.file.getMimetype()?
this.contentViewer=new Storage.GifImageFileViewer({file:this.file,fileViewer:this}):0==this.file.getMimetype().indexOf("image/")?this.contentViewer=new Storage.ImageFileViewer({file:this.file,fileViewer:this}):"text/uri-list"==this.file.getMimetype()?this.contentViewer=new Storage.SiteFileViewer({file:this.file,fileViewer:this}):"application/x-webnapperon2-rss-item"==this.file.getMimetype()?this.contentViewer=new Storage.RssItemFileViewer({file:this.file,fileViewer:this}):navigator.isIE7||navigator.isIE8||
0!=this.file.getMimetype().indexOf("video/")?navigator.isIE7||navigator.isIE8||0!=this.file.getMimetype().indexOf("audio/")?0==this.file.getMimetype().indexOf("text/plain")&&5E4>this.file.getData().size?this.contentViewer=new Storage.TextFileViewer({file:this.file,fileViewer:this}):0==this.file.getMimetype().indexOf("application/pdf")||0==this.file.getMimetype().indexOf("application/vnd.oasis.opendocument.text")||0==this.file.getMimetype().indexOf("application/vnd.oasis.opendocument.presentation")||
0==this.file.getMimetype().indexOf("application/vnd.oasis.opendocument.graphics")||0==this.file.getMimetype().indexOf("application/vnd.sun.xml.writer")||0==this.file.getMimetype().indexOf("application/vnd.ms-powerpoint")||0==this.file.getMimetype().indexOf("application/msword")||0==this.file.getMimetype().indexOf("application/vnd.openxmlformats-officedocument.wordprocessingml.document")||0==this.file.getMimetype().indexOf("text/richtext")?this.contentViewer=new Storage.PdfFileViewer({file:this.file,
fileViewer:this}):0==this.file.getMimetype().indexOf("application/x-directory")&&5E4>this.file.size?this.contentViewer=new Storage.DirectoryFileViewer({file:this.file,fileViewer:this}):this.contentViewer=new Storage.GenericFileViewer({file:this.file,fileViewer:this}):this.contentViewer=new Storage.AudioFileViewer({file:this.file,fileViewer:this}):this.contentViewer=new Storage.VideoFileViewer({file:this.file,fileViewer:this}),this.contentBox.setContent(this.contentViewer),this.playing&&this.play())},
getFile:function(){return this.file},getUploader:function(){return this.uploader},getTools:function(){return this.tools},appendTool:function(a){this.tools.push(a);this.fireEvent("toolschange",this,this.tools)},play:function(){if(void 0===this.contentViewer)this.playing=!0;else if("play"in this.contentViewer)this.connect(this.contentViewer,"end",this.onPlayEnd),this.contentViewer.play();else{var a=5;"duration"in this.file.meta&&(a=parseFloat(this.file.meta.duration));new Core.DelayedTask({scope:this,
delay:a,callback:this.onPlayEnd})}},current:function(){0<this.contentBox.getChildren().length&&"current"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].current()},uncurrent:function(){0<this.contentBox.getChildren().length&&"uncurrent"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].uncurrent()},onPlayEnd:function(){this.playing=!1;this.fireEvent("end",this)},deleteFile:function(){void 0!==this.file?(this.file.suppress(),(new Core.HttpRequest({method:"DELETE",
url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send()):void 0!=this.uploader&&this.uploader.abort()},onFileChange:function(){console.log(this+".onFileChange");console.log(this.file);this.buildContent()}},{onLoad:function(){Storage.FileViewer.base.onLoad.apply(this,arguments);this.connect(this.file,"change",this.onFileChange);if(this.file.getIsReady())this.onFileChange()},onUnload:function(){Storage.FileViewer.base.onUnload.apply(this,arguments);this.disconnect(this.file,"change",this.onFileChange);
this.removeContent()}});
Ui.LBox.extend("Storage.UploaderViewer",{storage:void 0,uploader:void 0,progressbar:void 0,label:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.uploader=a.uploader;delete a.uploader;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center"});this.setContent(a);a.append(new Ui.Icon({icon:"uploadfile",fill:"#3f3f3f",width:256,height:256,horizontalAlign:"center"}));this.progressbar=new Ui.ProgressBar({width:120,
height:10});a.append(this.progressbar);void 0!=this.uploader.getFile().getFileName()&&a.append(new Ui.CompactLabel({width:256,maxLine:3,textAlign:"center",text:this.uploader.getFile().getFileName()}));this.connect(this.uploader,"progress",this.onUploaderProgress)},onUploaderProgress:function(a,b,c){this.progressbar.setValue(b/c)}});
Ui.LBox.extend("Storage.DirectoryFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,transBox:void 0,playing:!1,directoryChildren:void 0,position:void 0,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);var b=new Core.HttpRequest({url:"/cloud/storage/"+this.storage+"/"+this.file.id+
"?depth=1"});this.connect(b,"done",function(){var a=b.getResponseJSON();this.directoryChildren=a.children;0===this.directoryChildren.length?this.playing&&this.fireEvent("end",this):(this.position=0,a=new Storage.FileViewer({storage:this.storage,file:a.children[this.position]}),this.connect(a,"end",this.onFileEnd),this.transBox.replaceContent(a),this.playing&&a.play())});b.send()},play:function(){this.playing=!0;void 0!==this.directoryChildren&&0===this.directoryChildren.length?this.fireEvent("end",
this):void 0!==this.transBox.getCurrent()&&this.transBox.getCurrent().play()},onFileEnd:function(){this.disconnect(this.transBox.getCurrent(),"end",this.onFileEnd);this.position++;if(this.position>=this.directoryChildren.length)this.fireEvent("end",this);else{var a=new Storage.FileViewer({storage:this.storage,file:this.directoryChildren[this.position]});this.connect(a,"end",this.onFileEnd);this.transBox.replaceContent(a);a.play()}}});
Ui.LBox.extend("Storage.ImageFileViewer",{file:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,transformable:void 0,userInteraction:!0,constructor:function(a){this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.transformable=new Ui.Transformable({inertia:!1,clipToBounds:!0});this.setContent(this.transformable);this.image=new KJing.ScaledImage2;this.image.setSrc(this.file.getDownloadUrl());this.transformable.setContent(this.image);this.connect(this.transformable,
"transform",this.onTransform)},setContentTransform:function(a){this.transformable.getIsDown()||(this.userInteraction=!1,this.transformable.setContentTransform(a.x,a.y,a.scale,a.angle),this.userInteraction=!0)},onTransform:function(){var a=this.getLayoutWidth(),b=this.getLayoutHeight();this.disconnect(this.transformable,"transform",this.onTransform);var c=this.transformable.getScale(),d=this.transformable.getTranslateX(),e=this.transformable.getTranslateY(),c=Math.min(4,Math.max(1,c)),a=(a*c-a)/2,
b=(b*c-b)/2,d=Math.min(d,a),d=Math.max(d,-a),e=Math.min(e,b),e=Math.max(e,-b);this.transformable.setContentTransform(d,e,c,0);this.connect(this.transformable,"transform",this.onTransform);this.userInteraction&&void 0!==this.fileViewer&&void 0!==this.fileViewer.getController()&&this.fileViewer.getController().setDeviceTransform({angle:this.transformable.getAngle(),scale:this.transformable.getScale(),x:this.transformable.getTranslateX(),y:this.transformable.getTranslateY()})}});
Ui.LBox.extend("Storage.GifImageFileViewer",{file:void 0,image:void 0,values:void 0,fileViewer:void 0,constructor:function(a){this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.image=new KJing.ScaledImage2;this.image.setSrc(this.file.getPreviewHighUrl());this.setContent(this.image)}});
Ui.LBox.extend("Storage.SiteFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,linkButton:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onContentLoaded);a.send();a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});
this.setContent(a);var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});a.append(b);b.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,b:0.7,g:0.7}),radius:2}));b.append(new Ui.Rectangle({fill:"white",margin:1,radius:2}));var c=new Ui.Image({src:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,width:128,margin:3});b.append(c);this.connect(c,"error",function(){b.setContent(new Ui.Image({src:"/cloud/mimeicon?mimetype="+encodeURIComponent(this.file.mimetype),
verticalAlign:"bottom",horizontalAlign:"center",width:128}))});this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);this.linkButton=new Ui.LinkButton({text:"Ouvrir le site",horizontalAlign:"center"});this.linkButton.disable();a.append(this.linkButton)},onContentLoaded:function(a){void 0!==this.file.meta&&"true"===this.file.meta.iframe?(a=new Ui.IFrame({src:a.getResponseText()}),this.setContent(a)):(this.linkButton.setSrc(a.getResponseText()),this.linkButton.enable())}});
Ui.LBox.extend("Storage.AudioFileViewer",{file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.setContent(a)},checkReady:function(){void 0!==
this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/audio/"+this.file.getShare().getId()+"/"+this.file.getData().id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new KJing.AudioPlayer({src:"/cloud/audio/"+this.file.getShare().getId()+
"/"+this.file.getData().id,text:this.file.getName()}),this.setContent(this.player),this.connect(this.player,"end",this.onMediaEnd),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son",verticalAlign:"center"}));
this.request=void 0},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()},onMediaEnd:function(){this.fireEvent("end",this)}},{onVisible:function(){void 0===this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.Pressable.extend("Storage.VideoFileViewer",{file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.setContent(a);this.setLock(!0);
this.connect(this,"press",this.onVideoPress)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/video/"+this.file.getShare().getId()+"/"+this.file.getData().id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?
(this.player=new KJing.VideoPlayer({src:"/cloud/video/"+this.file.getShare().getId()+"/"+this.file.getData().id,poster:this.file.getPreviewHighUrl()}),this.connect(this.player,"statechange",this.onVideoStateChange),this.connect(this.player,"end",this.onVideoEnd),this.setContent(this.player),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",
verticalAlign:"center",textAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center",textAlign:"center"}));this.request=void 0},onVideoEnd:function(a){this.playing=!1;this.fireEvent("end",this)},onVideoStateChange:function(a){this.setLock(this.player.getIsControlsVisible())},onVideoPress:function(){void 0!==this.player&&"playing"==this.player.getState()&&this.player.pause()},uncurrent:function(){void 0!==
this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()}},{onVisible:function(){void 0===this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.LBox.extend("Storage.TextFileViewer",{file:void 0,fileViewer:void 0,text:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(a);var b=new Ui.LBox;b.append(new Storage.PageBackgroundGraphic({margin:7}));a.setContent(b);this.text=new Wn.ImproveText({margin:30,style:{"Wn.ImproveText":{fontSize:20}}});
b.append(this.text);a=new Ui.LinkButton({icon:"edit",src:"/app/texteditor/?storage="+this.storage+"&file="+this.file.id});this.fileViewer.appendTool(a);a=new Core.HttpRequest({method:"GET",url:this.file.getDownloadUrl()});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){this.text.setText(a.getResponseText())}});
Ui.CanvasElement.extend("Storage.PageBackgroundGraphic",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(5,5,b-10,c-10,2,2,2,2,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.5}));a.fillStyle="#ffffff";a.fillRect(7,7,b-14,c-14)}});
Ui.LBox.extend("Storage.RssItemFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,title:void 0,content:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;var b=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(b);a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);b.setContent(a);b=new Ui.VBox({margin:20,spacing:10});a.append(b);this.title=
new Ui.Text({text:this.file.name,fontWeight:"bold",fontSize:24,marginTop:20});b.append(this.title);this.content=new Ui.Html;this.connect(this.content,"link",this.onContentLink);b.append(this.content);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){var b='<div style="word-wrap: break-word; font-family: '+this.getStyleProperty("fontFamily")+";font-size: "+
this.getStyleProperty("fontSize")+"px;font-weight: "+this.getStyleProperty("fontWeight")+';">',b=b+((new Date(this.file.meta.pubDate)).toLocaleString()+"&nbsp;&nbsp;");void 0!=this.file.meta.link&&(b+='<a href="'+this.file.meta.link+'" style="cursor: pointer; text-decoration: underline; color: #4d4d4d">article complet</a><br>');b=b+"<br>"+a.getResponseText();b+="</div>";this.content.setHtml(b)},onContentLink:function(a,b){window.open(b,"_blank")}});
Ui.CanvasElement.extend("Storage.PdfPageGraphic",{src:void 0,image:void 0,ratio:1,constructor:function(a){this.src=a.src;delete a.src;this.ratio=a.ratio;delete a.ratio;this.image=new Ui.Image({src:this.src});this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},onImageReady:function(){this.invalidateDraw()}},{measureCore:function(a,b){return{width:a,height:(a-14)/this.ratio+14}},updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(5,
5,b-10,c-10,2,2,2,2,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.5}));a.fillStyle="#ffffff";a.fillRect(7,7,b-14,c-14);this.image.getIsReady()&&a.drawImage(this.image.getDrawing(),0,0,this.image.getNaturalWidth(),this.image.getNaturalHeight(),7,7,b-14,c-14)}});
Ui.LBox.extend("Storage.PdfPage",{file:void 0,page:void 0,graphic:void 0,viewer:void 0,userInteraction:!0,transformable:void 0,constructor:function(a){this.file=a.file;delete a.file;this.page=a.page;delete a.page;this.viewer=a.viewer;delete a.viewer;this.transformable=new Ui.Transformable({inertia:!1,clipToBounds:!0});this.setContent(this.transformable);this.graphic=new KJing.ScaledImage2({src:"/cloud/pdf/"+this.file.getShare().getId()+"/"+this.file.getData().id+"/pages/"+this.page+"/image?rev="+
this.file.getRev()});this.transformable.setContent(this.graphic);this.connect(this.transformable,"transform",this.onTransform)},setContentTransform:function(a){this.transformable.getIsDown()||(this.userInteraction=!1,this.transformable.setContentTransform(a.x,a.y,a.scale,a.angle),this.userInteraction=!0)},onTransform:function(){var a=this.getLayoutWidth(),b=this.getLayoutHeight();this.disconnect(this.transformable,"transform",this.onTransform);var c=this.transformable.getScale(),d=this.transformable.getTranslateX(),
e=this.transformable.getTranslateY(),c=Math.min(4,Math.max(1,c)),a=(a*c-a)/2,b=(b*c-b)/2,d=Math.min(d,a),d=Math.max(d,-a),e=Math.min(e,b),e=Math.max(e,-b);this.transformable.setContentTransform(d,e,c,0);this.connect(this.transformable,"transform",this.onTransform);this.userInteraction&&void 0!==this.viewer&&void 0!==this.viewer.getController()&&this.viewer.getController().setDeviceTransform({angle:this.transformable.getAngle(),scale:this.transformable.getScale(),x:this.transformable.getTranslateX(),
y:this.transformable.getTranslateY()})}});
Ui.LBox.extend("Storage.PdfFileViewer",{file:void 0,fileViewer:void 0,data:void 0,isCurrent:!1,carousel:void 0,checkTask:void 0,request:void 0,position:0,constructor:function(a){this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.setContent(a)},getPosition:function(){return void 0===
this.carousel?0:this.carousel.getCurrentPosition()},setPosition:function(a){void 0!==this.carousel&&this.carousel.setCurrentAt(a)},setContentTransform:function(a){void 0!==this.carousel&&this.carousel.getCurrent().setContentTransform(a)},checkReady:function(){void 0!=this.checkTask&&(this.checkTask=void 0);void 0==this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/pdf/"+this.file.getShare().getId()+"/"+this.file.getData().id}),this.connect(this.request,"done",this.onCheckDone),
this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status?(this.data=a,this.carousel=new Ui.Carousel({directionRelease:!0}),this.connect(this.carousel,"change",this.onCarouselChange),this.setContent(this.carousel),this.onDataDone()):"building"==a.status?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier PDF",
verticalAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center"}));this.request=void 0},onCarouselChange:function(a,b){void 0!==this.fileViewer.getController()&&this.fileViewer.getController().setPosition(b)},onDataDone:function(a){for(a=0;a<this.data.pages.length;a++){var b=new Storage.PdfPage({file:this.file,page:a,viewer:this.fileViewer});this.carousel.append(b)}},current:function(){this.isCurrent=
!0},uncurrent:function(){this.isCurrent=!1}},{onVisible:function(){void 0===this.carousel&&this.checkReady()},onHidden:function(){void 0!=this.request&&(this.request.abort(),this.request=void 0);void 0!=this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0)}});
Ui.LBox.extend("Storage.GenericFileViewer",{file:void 0,text:void 0,fileViewer:void 0,constructor:function(a){this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.setContent(a);a.append(new Ui.Image({src:"/cloud/mimeicon?mimetype="+encodeURIComponent(this.file.getMimetype()),width:128,height:128,horizontalAlign:"center"}));this.text=new Ui.Text({textAlign:"center",text:this.file.getName(),fontSize:20});
a.append(this.text);var b=new Ui.DownloadButton({text:"T\u00e9l\u00e9charger",horizontalAlign:"center"});b.setSrc(this.file.getDownloadUrl(!0));a.append(b)}});Ui.Selectionable.extend("KJing.DeviceItemView",{view:void 0,resource:void 0,label:void 0,content:void 0,graphic:void 0,constructor:function(a){this.setDirectionDrag("horizontal");this.view=a.view;delete a.view;this.resource=a.resource;delete a.resource;a=new Ui.VBox({margin:5,spacing:5});this.setContent(a);this.content=new Ui.DropBox({width:70,height:70});this.connect(this.content,"drop",this.onDrop);this.connect(this.content,"dropfile",this.onDropFile);a.append(this.content);this.content.addMimetype("application/x-file");
this.label=new Ui.CompactLabel({width:100,maxLine:3,textAlign:"center"});a.append(this.label);this.graphic=new KJing.DeviceItemGraphic({verticalAlign:"bottom",horizontalAlign:"center",width:64,height:64});this.content.setContent(this.graphic);if(this.resource.getIsReady())this.onResourceChange()},getView:function(){return this.view},getResource:function(){return this.resource},open:function(){this.getView().push(this.getResource().getName(),this.getResource().getId())},suppress:function(){this.resource.suppress()},
onItemProperties:function(){(new KJing.ResourcePropertiesDialog({resource:this.resource})).open()},onDrop:function(a,b,c,d,e,f){console.log("onDrop: "+c);"application/x-file"===b&&this.getResource().setPath(c)},onDropFile:function(){},onResourceChange:function(){this.label.setText(this.resource.getName());this.graphic.setOnline(this.resource.getIsConnected());if(null!==this.resource.getData().path){var a=this.resource.getData().path,b=a.lastIndexOf(":"),c=a.substring(5,b),a=a.substring(b+1);this.graphic.setImageSrc("/cloud/preview/"+
c+"/"+a)}this.graphic.setRatio(this.resource.getDeviceRatio())}},{onLoad:function(){KJing.DeviceItemView.base.onLoad.apply(this,arguments);this.connect(this.resource,"change",this.onResourceChange)},onUnload:function(){KJing.DeviceItemView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange)},getSelectionActions:function(){return{suppress:{text:"Supprimer",icon:"trash",color:"#e05050",scope:this,callback:this.suppress,multiple:!0},edit:{text:"Propri\u00e9t\u00e9s",
icon:"edit",scope:this,callback:this.onItemProperties,multiple:!1},open:{"default":!0,text:"Ouvrir",icon:"eye",scope:this,callback:this.open,multiple:!1}}}});KJing.View.extend("KJing.DeviceView",{resource:void 0,file:void 0,volumeControl:void 0,mainBox:void 0,path:void 0,mainVBox:void 0,directoryView:void 0,ratioBox:void 0,viewer:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;var b=new Ui.DropBox;this.setContent(b);var c=new Ui.VBox({spacing:5});this.mainVBox=c;b.setContent(c);a=new Ui.HBox;c.append(a,!0);b=new Ui.DropBox;b.addMimetype("application/x-file");a.append(b,!0);this.connect(b,"drop",this.onDrop);this.ratioBox=new KJing.RatioBox({ratio:4/
3});b.setContent(this.ratioBox);this.ratioBox.append(new Ui.Rectangle({fill:"black"}));this.mainBox=new Ui.LBox;this.ratioBox.append(this.mainBox);b=new Ui.VBox;a.append(b);this.volumeControl=new Ui.Slider({orientation:"vertical"});b.append(this.volumeControl,!0);b.append(new Ui.Icon({icon:"sound",width:24,height:24,horizontalAlign:"center"}))},setPath:function(a){this.path=a;null!==this.path&&(this.file=KJing.Resource.create(a),this.viewer=new Storage.FileViewer({file:this.file,controller:this}),
this.mainBox.setContent(this.viewer),void 0!==this.directoryView&&(this.mainVBox.remove(this.directoryView),this.directoryView=void 0))},getPosition:function(){return void 0!==this.viewer?this.viewer.getPosition():0},setPosition:function(a){this.resource.getIsConnected()&&this.resource.sendDeviceMessage({position:a})},setDeviceTransform:function(a){this.resource.getIsConnected()&&this.resource.sendDeviceMessage({transform:a})},onDeviceChange:function(){this.ratioBox.setRatio(this.resource.getDeviceRatio());
this.path!==this.resource.getDevicePath()&&this.setPath(this.resource.getDevicePath());this.getPosition()!==this.resource.getDevicePosition()&&void 0!==this.viewer&&this.viewer.setPosition(this.resource.getDevicePosition());void 0!==this.viewer&&this.viewer.setContentTransform(this.resource.getDeviceTransform())},onDrop:function(a,b,c,d,e,f){console.log(this+".onDrop "+b);"application/x-file"==b&&this.resource.setDevicePath(c)}},{onLoad:function(){KJing.DeviceView.base.onLoad.apply(this,arguments);
this.connect(this.resource,"change",this.onDeviceChange);this.resource.monitor()},onUnload:function(){KJing.DeviceView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onDeviceChange);this.resource.unmonitor()}});
Ui.Pressable.extend("KJing.DeviceControlFileView",{storage:void 0,file:void 0,uploader:void 0,view:void 0,preview:void 0,constructor:function(a){this.view=a.view;delete a.view;this.storage=a.storage;delete a.storage;"uploader"in a&&(this.uploader=a.uploader,delete a.uploader);"file"in a&&(this.file=a.file,delete a.file);this.preview=new Storage.FilePreview({storage:this.storage,uploader:this.uploader,file:this.file});this.setContent(this.preview);this.connect(this,"press",this.onFilePress)},getStorage:function(){return this.storage},
getFile:function(){return this.file},getUploader:function(){return this.uploader},onFilePress:function(){var a="file:"+this.storage+":"+this.file.id;console.log(this+".onFilePress "+a);this.view.setPath(a)}});
Ui.ScrollingArea.extend("KJing.DeviceControlStorageView",{view:void 0,resource:void 0,storage:void 0,file:0,storageRev:0,updateRequest:void 0,flow:void 0,constructor:function(a){this.setScrollVertical(!1);this.view=a.view;delete a.view;this.resource=a.resource;delete a.resource;"file"in a&&(this.file=a.file,delete a.file);this.flow=new Ui.HBox;this.setContent(this.flow);this.update()},getResource:function(){return this.resource},update:function(){this.updateRequest=new Core.HttpRequest({method:"GET",
url:"/cloud/storage/"+this.resource.getId()+"/"+this.file+"?depth=1"});this.connect(this.updateRequest,"done",this.onUpdateDone);this.connect(this.updateRequest,"error",this.onUpdateError);this.updateRequest.send()},onUpdateDone:function(){var a=this.updateRequest.getResponseJSON();this.storageRev=a.storage_rev;for(var a=a.children,b=[],c=0;c<this.getChildren().length;c++){var d=this.getChildren()[c];if(KJing.DeviceControlFileView.hasInstance(d)){var e=d.getFile();if(void 0!=e){var f=void 0;if(void 0!==
e)for(var g=0;void 0===f&&g<a.length;g++)a[g].id==e.id&&(f=a[g]);void 0!==f?(f.hostResourceViewerSeen=!0,d.update(f)):b.push(d)}}}for(c=0;c<b.length;c++)this.flow.remove(b[c]);if(void 0!==a)for(c=0;c<a.length;c++)a[c].hostResourceViewerSeen?delete a[c].hostResourceViewerSeen:(e=a[c],b=new KJing.DeviceControlFileView({view:this.view,storage:this.resource.getId(),file:e}),this.flow.append(b))},onUpdateError:function(){this.updateRequest=void 0}});KJing.DeviceItemView.extend("KJing.MapDeviceItemView",{map:void 0,x:0,y:0,constructor:function(a){},getMap:function(){return this.map},setMap:function(a){this.map=a},getX:function(){return this.x},setX:function(a){this.x=a},getY:function(){return this.y},setY:function(a){this.y=a}},{suppress:function(){this.map.detachDevice(this.resource)}});
Ui.DropBox.extend("KJing.MapDevicesView",{resource:void 0,view:void 0,image:void 0,fixed:void 0,devices:void 0,mapX:0,mapY:0,mapWidth:100,mapHeight:100,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.devices=[];this.fixed=new Ui.Fixed;this.setContent(this.fixed);this.addMimetype("files");this.addMimetype("application/x-file");this.addMimetype("KJing.DeviceItemView");this.connect(this,"dropfile",this.onMapDropFile);this.connect(this,"drop",this.onMapDrop);
this.image=new Ui.Image({src:this.resource.getMapImageUrl()});this.fixed.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this.fixed,"resize",this.onResize);this.addEvents("ready")},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();
if(a/b<c/d){var e=d,f=a*e/b;this.mapX=-(f-c)/2;this.mapY=0}else f=c,e=b*f/a,this.mapX=0,this.mapY=-(e-d)/2;this.mapWidth=f;this.mapHeight=e;this.fixed.setPosition(this.image,this.mapX,this.mapY);this.image.setWidth(f);this.image.setHeight(e);this.updateDevicesPositions()},updateDevicesPositions:function(){for(var a=this.mapWidth,b=this.mapHeight,c=0;c<this.devices.length;c++)this.fixed.setPosition(this.devices[c],this.mapX+this.devices[c].getX()*a,this.mapY+this.devices[c].getY()*b)},onMapDropFile:function(a,
b,c,d,e){this.resource.setMapImage(b)},onMapDrop:function(a,b,c,d,e,f){console.log(this+".onDrop mimetype: "+b+", pos: ("+d+","+e+")");"KJing.DeviceItemView"===b&&(a=c.getDragDelta(),console.log("dragDelta: "+a.x+","+a.y),console.log("data.layout: "+c.getLayoutWidth()+"x"+c.getLayoutHeight()),d-=this.mapX,e-=this.mapY,d-=a.x,e-=a.y,d+=c.getLayoutWidth()/2,e+=c.getLayoutHeight()/2,a=c.getResource(),d/=this.mapWidth,e/=this.mapHeight,console.log(a),console.log(this+".onDrop DeviceItemView isAttached: "+
this.resource.isAttachedDevice(a)),this.resource.isAttachedDevice(a)?(this.resource.moveDevice(a,d,e),c.setX(d),c.setY(e),this.updateDevicesPositions()):this.resource.attachDevice(a,d,e))},onResourceChange:function(){console.log(this+".onResourceChange");console.log(this.resource.getDevices());for(var a=[],b=this.resource.getDevices(),c=0;c<this.devices.length;c++){for(var d=this.devices[c],e=void 0,f=0;void 0===e&&f<b.length;f++)b[f].device.getId()===d.getResource().getId()&&(e=b[f]);void 0===e?
this.fixed.remove(d):(a.push(d),d.setX(e.x),d.setY(e.y))}for(c=0;c<b.length;c++){e=void 0;for(f=0;void 0===e&&f<this.devices.length;f++)this.devices[f].getResource().getId()===b[c].device.getId()&&(e=this.devices[f]);void 0===e&&(d=new KJing.MapDeviceItemView({view:this.view,resource:b[c].device,map:this.resource,x:b[c].x,y:b[c].y}),a.push(d),this.fixed.append(d,0,0),this.fixed.setRelativePosition(d,0.5,0.5,!1))}this.devices=a;this.updateDevicesPositions()}},{onLoad:function(){KJing.MapDevicesView.base.onLoad.apply(this,
arguments);this.connect(this.resource,"change",this.onResourceChange);this.resource.monitor()},onUnload:function(){KJing.MapDevicesView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange);this.resource.unmonitor()}});Ui.LBox.extend("KJing.WizardItem",{data:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.addEvents("done")},getData:function(){return this.data},getIsDone:function(){return this.isDone},done:function(){this.isDone||(this.isDone=!0,this.fireEvent("done"))},save:function(){this.onSave()},onSave:function(){}});Core.Object.extend("KJing.LoginCreator",{data:void 0,session:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.session=a.session;delete a.session;this.addEvents("done","fail")},getIsDone:function(){return this.isDone},getData:function(){return this.data},getSession:function(){return this.session},done:function(a){this.isDone||(this.isDone=!0,this.fireEvent("done",this,a))},fail:function(){this.fireEvent("fail",this)}});KJing.WizardItem.extend("KJing.LoginWizardSelector",{selectItem:void 0,constructor:function(a){this.addEvents("choose");var b=new Ui.VBox({uniform:!0,spacing:10});this.setContent(b);for(var c=KJing.LoginWizard.getWizardTypes(),d=0;d<c.length;d++){var e=KJing.LoginWizard.getWizard(c[d]),e=new Ui.Button({icon:e.icon,text:e.name,orientation:"horizontal"});this.connect(e,"press",this.onItemPress);e.hostLoginWizardSelector=c[d];b.append(e)}delete a.wizardType},getSelectedType:function(){return this.selectItem.hostLoginWizardSelector},
onItemPress:function(a){this.selectItem=a;this.fireEvent("done",this)}});
Ui.Dialog.extend("KJing.LoginWizard",{previousButton:void 0,nextButton:void 0,transBox:void 0,position:0,current:void 0,wizardType:void 0,data:void 0,constructor:function(a){this.addEvents("done");this.setTitle("Connexion");this.setFullScrolling(!0);this.setPreferedWidth(450);this.setPreferedHeight(450);this.data={};this.previousButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.previousButton.hide();this.connect(this.previousButton,"press",this.onPreviousPress);this.nextButton=new Ui.Button({text:"Suivant"});
this.connect(this.nextButton,"press",this.onNextPress);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.current=new KJing.LoginWizardSelector;this.transBox.replaceContent(this.current);this.connect(this.current,"done",this.onItemDone);this.nextButton.disable()},onPreviousPress:function(){this.position--;this.disconnect(this.current,"done",this.onItemDone);this.current.save();0>this.position&&(this.position=0);if(0==this.position)this.setTitle("Connexion"),this.current=new KJing.LoginWizardSelector({wizardType:this.wizardType}),
this.previousButton.hide(),this.setActionButtons(void 0);else{var a=KJing.LoginWizard.getWizard(this.wizardType);this.setTitle(a.name);this.current=new a.array[this.position-1]({data:this.data})}this.nextButton.setText("Suivant");this.connect(this.current,"done",this.onItemDone);this.transBox.replaceContent(this.current);this.current.getIsDone()?this.nextButton.enable():this.nextButton.disable()},onItemDone:function(){if(0==this.position)this.onNextPress();this.nextButton.enable()},onNextPress:function(){this.position++;
this.disconnect(this.current,"done",this.onItemDone);this.current.save();this.nextButton.disable();this.previousButton.show();1==this.position&&(this.setActionButtons([this.previousButton,this.nextButton]),this.wizardType!=this.current.getSelectedType()&&(this.wizardType=this.current.getSelectedType(),this.data={}));var a=KJing.LoginWizard.getWizard(this.wizardType);this.position>a.array.length?(a=new a.creator({data:this.data,item:this.current}),this.disable(),this.connect(a,"done",this.onCreatorDone),
this.connect(a,"fail",this.onCreatorFail)):(this.setTitle(a.name),this.current=new a.array[this.position-1]({data:this.data}),this.position==a.array.length?this.nextButton.setText(a.endlabel):this.nextButton.setText("Suivant"),this.connect(this.current,"done",this.onItemDone),this.transBox.replaceContent(this.current))},onCreatorDone:function(a,b){this.close();this.fireEvent("done",this,b)},onCreatorFail:function(){this.enable();this.position--;this.nextButton.enable()}},{},{apps:void 0,constructor:function(){this.apps=
{}},register:function(a,b,c,d,e,f){KJing.LoginWizard.apps[a]={name:b,icon:c,array:d,creator:e,endlabel:f}},getWizardTypes:function(){var a=[],b;for(b in KJing.LoginWizard.apps)a.push(b);return a},getWizard:function(a){return KJing.LoginWizard.apps[a]}});KJing.LoginCreator.extend("KJing.Local.Creator",{item:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);a.send()},onLoginBasicDone:function(a){"localStorage"in window&&(this.data.localstore?(localStorage.setItem("login",this.data.login),localStorage.setItem("password",
this.data.password)):(localStorage.removeItem("login"),localStorage.removeItem("password")));this.done()},onLoginBasicFails:function(){this.fail();this.item.showError()}});
KJing.WizardItem.extend("KJing.Local.Wizard",{loginField:void 0,passwordField:void 0,localStoreField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.SFlow({spacing:5,itemAlign:"stretch"});this.setContent(a);this.loginField=new KJing.TextField({title:"Identifiant",width:250});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);this.passwordField=new KJing.TextField({title:"Mot de passe",passwordMode:!0,width:250});this.connect(this.passwordField,
"change",this.onChange);a.append(this.passwordField);this.localStoreField=new Ui.CheckBox({text:"Se souvenir de moi"});"localStorage"in window&&a.append(this.localStoreField);this.errorMessage=new Ui.Text({text:"Echec: Identifiant ou mot de passe incorrect",color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login?this.loginField.setValue(a.login):"localStorage"in window&&void 0!=localStorage.getItem("login")&&this.loginField.setValue(localStorage.getItem("login"));
void 0!=a.password?this.passwordField.setValue(a.password):"localStorage"in window&&void 0!=localStorage.getItem("password")&&this.passwordField.setValue(localStorage.getItem("password"));void 0!=a.localstore?this.localStoreField.setValue(a.localstore):"localStorage"in window&&(void 0==localStorage.getItem("password")&&void 0==localStorage.getItem("login")||this.localStoreField.setValue(!0));this.onChange()},showError:function(){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.show();
this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());""!=this.loginField.getValue()&&""!=this.passwordField.getValue()&&this.done()}},{onSave:function(){var a=this.getData();a.login=this.loginField.getValue();a.password=this.passwordField.getValue();a.localstore=
this.localStoreField.getValue()}});KJing.LoginWizard.register("local","Local","localaccount",[KJing.Local.Wizard],KJing.Local.Creator,"Connecter");KJing.WizardItem.extend("KJing.Google.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/googleoauth2/redirect?state=create"}});KJing.LoginWizard.register("google","Google","google",[KJing.Google.Wizard]);KJing.WizardItem.extend("KJing.Facebook.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/facebookoauth2/redirect?state=create"}});KJing.LoginWizard.register("facebook","Facebook","facebook",[KJing.Facebook.Wizard]);KJing.LoginCreator.extend("KJing.Create.Creator",{item:void 0,newuser:void 0,newresources:void 0,resources:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user",content:JSON.stringify({login:this.getData().login,password:this.getData().password,firstname:this.getData().firstname,lastname:this.getData().lastname})});this.connect(a,"done",this.onCreateUserDone);this.connect(a,"error",this.onCreateUserError);a.send()},onCreateUserError:function(a){var b=
a.getStatus(),c="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";409==b?c="Echec: l'identifiant existe d\u00e9j\u00e0":403==b&&1==a.getResponseJSON().code&&(c="Echec: mot de passe trop faible");this.item.showError(c);this.fail()},onCreateUserDone:function(){var a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);
a.send()},onLoginBasicDone:function(){this.done()},onLoginBasicFails:function(){this.fail()}});
KJing.WizardItem.extend("KJing.Create.Wizard",{firstnameField:void 0,lastnameField:void 0,loginField:void 0,passwordField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.SFlow({spacing:10,itemAlign:"stretch"});this.setContent(a);this.firstnameField=new KJing.TextField({title:"Pr\u00e9nom",width:150});this.connect(this.firstnameField,"change",this.onChange);a.append(this.firstnameField);this.lastnameField=new KJing.TextField({title:"Nom",width:150});this.connect(this.lastnameField,
"change",this.onChange);a.append(this.lastnameField);this.loginField=new KJing.TextField({title:"Identifiant",width:200});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);this.passwordField=new KJing.TextField({title:"Mot de passe",width:200,passwordMode:!0,desc:"8 caract\u00e8res minimum avec chiffre et lettre"});this.connect(this.passwordField,"change",this.onChange);a.append(this.passwordField);this.errorMessage=new Ui.Text({text:"Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es",
color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login&&this.loginField.setValue(a.login);void 0!=a.password&&this.passwordField.setValue(a.password);this.onChange()},showError:function(a){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),
this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){""!=this.firstnameField.getValue()&&""!=this.lastnameField.getValue()&&""!=this.loginField.getValue()&&""!=this.passwordField.getValue()&&this.done()}},{onSave:function(){var a=this.getData();a.firstname=this.firstnameField.getValue();a.lastname=this.lastnameField.getValue();a.login=this.loginField.getValue();a.password=this.passwordField.getValue()}});
KJing.LoginWizard.register("create","Nouveau compte","plus",[KJing.Create.Wizard],KJing.Create.Creator,"Cr\u00e9er");Core.Object.extend("KJing.Item",{data:void 0,getData:function(){return this.data},setData:function(a){this.data=a}});KJing.NewItem.extend("KJing.ResourceNewItem",{view:void 0,resource:void 0,types:void 0,constructor:function(a){this.view=a.view;delete a.view;this.resource=a.resource;delete a.resource;"types"in a&&(this.types=a.types,delete a.types);this.connect(this,"press",this.onNewPress)},onNewPress:function(){(new KJing.NewResourceDialog({resource:this.resource,types:this.types})).open()}});
KJing.ItemView.extend("KJing.ResourceItemView",{resource:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},setShare:function(a){!0===a?this.setItemTags(["share"]):this.setItemTags(void 0)},getResource:function(){return this.resource},open:function(){this.getView().push(this.getResource().getName(),this.getResource().getId())},onItemProperties:function(){(new KJing.ResourcePropertiesDialog({resource:this.resource})).open()},
suppress:function(a){this.resource.suppress()},onResourceChange:function(){var a=this.resource.getName();void 0===a||null===a?this.setItemName(""):this.setItemName(a)},onResourceDelete:function(){this.getView().getContentView().getResource().update()}},{onLoad:function(){KJing.ResourceItemView.base.onLoad.apply(this,arguments);this.connect(this.resource,"change",this.onResourceChange);this.connect(this.resource,"delete",this.onResourceDelete)},onUnload:function(){KJing.ResourceItemView.base.onUnload.apply(this,
arguments);this.disconnect(this.resource,"change",this.onResourceChange);this.disconnect(this.resource,"delete",this.onResourceDelete)},getSelectionActions:function(){return{suppress:{text:"Supprimer",icon:"trash",scope:this,callback:this.suppress,multiple:!0},edit:{text:"Propri\u00e9t\u00e9s",icon:"edit",scope:this,callback:this.onItemProperties,multiple:!1},open:{"default":!0,text:"Ouvrir",icon:"eye",scope:this,callback:this.open,multiple:!1}}}});
KJing.ItemView.extend("Storage.FileItemView",{storage:void 0,file:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.setItemIconSrc("/cloud/mimeicon/"+encodeURIComponent(this.file.mimetype));this.setItemName(this.file.name)}});Storage.FileItemView.extend("Storage.DirectoryItemView",{constructor:function(a){}});KJing.ResourceItemView.extend("KJing.GroupItemView",{constructor:function(a){this.setItemIcon("group")}});
KJing.ResourceItemView.extend("KJing.GroupUserItemView",{group:void 0,constructor:function(a){this.setRoundMode(!0);KJing.User.hasInstance(this.getResource())?this.setItemImage(this.getResource().getFaceUrl()):this.setItemIcon("person");this.group=a.group;delete a.group}},{onResourceChange:function(){KJing.GroupUserItemView.base.onResourceChange.call(this);KJing.User.hasInstance(this.getResource())?this.setItemImage(this.getResource().getFaceUrl()):this.setItemIcon("person")},suppress:function(){this.group.removeUser(this.getResource())}});
KJing.ResourceItemView.extend("KJing.ShareItemView",{constructor:function(a){this.setItemIcon("files")}});KJing.ResourceItemView.extend("KJing.FolderItemView",{constructor:function(a){this.setItemIcon("folder")}});
KJing.ResourceItemView.extend("KJing.MapItemView",{constructor:function(a){this.setItemIcon("map");this.addMimetype("application/x-file")}},{onDrop:function(a,b,c,d,e,f){KJing.MapItemView.base.onDrop.apply(this,arguments);if("application/x-file"===b){console.log(this.getResource());for(var g=this.getResource().getDevices(),h=0;h<g.length;h++)g[h].device.setPath(c)}}});
Ui.CanvasElement.extend("KJing.DeviceItemGraphic",{ratio:1.33,online:!1,image:void 0,imageSrc:void 0,constructor:function(a){this.image=new Ui.Image;this.appendChild(this.image);this.connect(this.image,"ready",this.invalidateDraw);this.connect(this.image,"error",this.invalidateDraw)},setRatio:function(a){this.ratio=a;this.invalidateDraw()},setOnline:function(a){this.online!==a&&(this.online=a,this.invalidateDraw())},setImageSrc:function(a){this.imageSrc=a;this.image.setSrc(this.imageSrc)}},{updateCanvas:function(a){var b=
this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b,c),e=Math.round(0.05*d),f;1<this.ratio?f=d/this.ratio:(f=d,d=f*this.ratio);var b=(b-d)/2,c=c-f,g=d-2*e,h=f-2*e;a.fillStyle="black";a.fillRect(b,c,d,d);if(void 0!==this.imageSrc&&this.image.getIsReady()){var k=this.image.getNaturalWidth(),l=this.image.getNaturalHeight(),k=k/l,m;k>this.ratio?(l=d,m=l/k):(m=f,l=m*k);a.drawImage(this.image.getDrawing(),b+(d-l)/2,c+(f-m)/2,l,m)}a.fillStyle=this.online?"#81e309":"#f75265";a.beginPath();a.moveTo(b,
c);a.lineTo(b+d,c);a.lineTo(b+d,c+f);a.lineTo(b,c+f);a.moveTo(b+e,c+e);a.lineTo(b+e,c+e+h);a.lineTo(b+e+g,c+e+h);a.lineTo(b+e+g,c+e);a.closePath();a.fill()}});KJing.ResourceItemView.extend("KJing.UserItemView",{constructor:function(a){this.setItemIcon("person")}});
Ui.DropBox.extend("KJing.ResourceView",{resource:void 0,view:void 0,flow:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);this.setAllowedMode("move");this.addMimetype("KJing.FolderItemView");this.addMimetype("KJing.ShareItemView");this.addMimetype("KJing.MapItemView");this.addMimetype("KJing.GroupItemView");this.connect(this,"drop",this.onItemDrop);if(this.resource.getIsChildrenReady())this.onResourceChange();
else this.resource.loadChildren()},getResource:function(){return this.resource},onItemDrop:function(a,b,c,d,e,f){console.log(this+".onItemDrop "+c);KJing.ResourceItemView.hasInstance(c)&&c.getResource().setParent(this.resource)},onResourceChange:function(){this.flow.clear();this.flow.append(new KJing.ResourceNewItem({view:this.view,resource:this.resource,types:["folder","user","group","share","map"]}));for(var a=this.resource.getChildren(),b=0;b<a.length;b++)this.addResource(a[b],!1);for(var c=this.resource.getShares(),
b=0;b<c.length;b++){for(var d=!1,e=0;!1===d&&e<a.length;e++)d=a[e].getId()===c[b].getId();d||this.addResource(c[b],!0)}},addResource:function(a,b){var c;"group"==a.getType()?c=new KJing.GroupItemView({resource:a,view:this.view,share:b}):"share"==a.getType()?c=new KJing.ShareItemView({resource:a,view:this.view,share:b}):"map"==a.getType()?c=new KJing.MapItemView({resource:a,view:this.view,share:b}):"folder"==a.getType()?c=new KJing.FolderItemView({resource:a,view:this.view,share:b}):"user"==a.getType()&&
(c=new KJing.UserItemView({resource:a,view:this.view,share:b}));void 0!==c&&this.flow.append(c)}},{onLoad:function(){KJing.ResourceView.base.onLoad.apply(this,arguments);this.connect(this.resource,"change",this.onResourceChange)},onUnload:function(){KJing.ResourceView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange)}});
Ui.DropBox.extend("KJing.GroupView",{resource:void 0,view:void 0,flow:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);this.setAllowedMode("copy");this.addMimetype("KJing.GroupUserItemView");this.addMimetype("KJing.UserItemView");this.connect(this,"drop",this.onItemDrop);if(this.resource.getIsReady())this.onResourceChange()},getResource:function(){return this.resource},
onResourceChange:function(){this.flow.clear();this.flow.append(new KJing.ResourceNewItem({view:this.view,resource:this.resource,types:["groupuser","groupgroup"]}));for(var a=this.resource.getUsers(),b=0;b<a.length;b++){var c=KJing.Resource.create(a[b]);this.flow.append(new KJing.GroupUserItemView({group:this.resource,resource:c,view:this.view}))}},onItemDrop:function(a,b,c,d,e,f){this.resource.addUser(c.getResource())}},{onLoad:function(){KJing.GroupView.base.onLoad.apply(this,arguments);this.connect(this.resource,
"change",this.onResourceChange);this.resource.monitor()},onUnload:function(){KJing.GroupView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange);this.resource.unmonitor()}});
Ui.DropBox.extend("KJing.MapProvisioningView",{resource:void 0,view:void 0,flow:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);this.flow.append(new KJing.ResourceNewItem({view:this.view,resource:this.resource,types:["device"]}));if(this.resource.getIsReady())this.onResourceChange()},getResource:function(){return this.resource},onResourceChange:function(){for(var a=this.resource.getChildren(),
b=this.flow.getChildren(),c=[],d=1;d<b.length;d++){for(var e=!1,f=0;!e&&f<a.length;f++)e=b[d].getResource().getId()===a[f].getId();e||c.push(b[d])}for(f=0;f<c.length;f++)this.flow.remove(c[f]);c=[];for(f=0;f<a.length;f++){e=!1;for(d=1;!e&&d<b.length;d++)e=b[d].getResource().getId()===a[f].getId();e||c.push(a[f])}for(f=0;f<c.length;f++)this.flow.append(new KJing.DeviceItemView({resource:c[f],view:this.view}))}},{onLoad:function(){KJing.MapProvisioningView.base.onLoad.apply(this,arguments);this.connect(this.resource,
"change",this.onResourceChange);this.resource.monitor()},onUnload:function(){KJing.MapProvisioningView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange);this.resource.unmonitor()}});
Ui.VBox.extend("KJing.MapMapView",{resource:void 0,view:void 0,devicesBox:void 0,fold:void 0,provisioningText:void 0,mapDevicesView:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.mapDevicesView=new KJing.MapDevicesView({view:this.view,resource:this.resource});this.append(this.mapDevicesView,!0);a=new Ui.ScrollingArea({scrollVertical:!1});this.devicesBox=new Ui.HBox({height:120,uniform:!0});a.setContent(this.devicesBox);var b=new Ui.LBox;
b.append(new Ui.Rectangle({fill:"rgba(120,120,120,0.1)"}));this.provisioningText=new Ui.Text({text:"Hello World",margin:5,textAlign:"center"});b.append(this.provisioningText);this.fold=new Ui.Fold({over:!1});this.fold.setHeader(b);this.fold.setContent(a);this.append(this.fold);if(this.resource.getIsReady())this.onResourceChange()},getResource:function(){return this.resource},onResourceChange:function(){for(var a=this.resource.getChildren(),b=this.devicesBox.getChildren(),c=[],d=0;d<b.length;d++){for(var e=
!1,f=0;!e&&f<a.length;f++)this.resource.isAttachedDevice(a[f])||(e=b[d].getResource().getId()===a[f].getId());e||c.push(b[d])}for(f=0;f<c.length;f++)this.devicesBox.remove(c[f]);for(var c=[],g=0,f=0;f<a.length;f++)if(!this.resource.isAttachedDevice(a[f])){g++;e=!1;for(d=0;!e&&d<b.length;d++)e=b[d].getResource().getId()===a[f].getId();e||c.push(a[f])}for(f=0;f<c.length;f++)this.devicesBox.append(new KJing.DeviceItemView({resource:c[f],view:this.view,directionDrag:"vertical"}));this.provisioningText.setText(g+
" clients en attente")}},{onLoad:function(){KJing.MapMapView.base.onLoad.apply(this,arguments);this.connect(this.resource,"change",this.onResourceChange);this.resource.monitor()},onUnload:function(){KJing.MapMapView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange);this.resource.unmonitor()}});
Ui.DropBox.extend("KJing.MapView",{resource:void 0,view:void 0,viewMode:"map",constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.setContent(new KJing.MapMapView({resource:this.resource,view:this.view}))},getResource:function(){return this.resource},getSetupPopup:function(){var a=new Ui.Popup,b=new Ui.VBox({margin:10});a.setContent(b);var c=new Ui.SegmentBar({orientation:"horizontal",field:"text",data:[{text:"Carte",value:"map"},{text:"Rattach\u00e9s",
value:"provisioning"}]});b.append(c);"provisioning"===this.viewMode?c.setCurrentPosition(1):c.setCurrentPosition(0);this.connect(c,"change",function(b,c){c.value!==this.viewMode&&(this.viewMode=c.value,"provisioning"===this.viewMode?this.setContent(new KJing.MapProvisioningView({resource:this.resource,view:this.view})):this.setContent(new KJing.MapMapView({resource:this.resource,view:this.view})));a.hide()});return a}});
KJing.NewItem.extend("KJing.StorageNewItem",{view:void 0,resource:void 0,storage:void 0,file:void 0,constructor:function(a){this.view=a.view;delete a.view;this.resource=a.resource;delete a.resource;this.connect(this,"press",this.onNewPress)},onNewPress:function(){(new KJing.NewFileDialog({resource:this.resource})).open()}});
Ui.DropBox.extend("KJing.StorageView",{view:void 0,resource:void 0,storage:void 0,storageRev:0,updateRequest:void 0,flow:void 0,constructor:function(a){this.view=a.view;delete a.view;this.resource=a.resource;delete a.resource;this.addMimetype("files");this.addMimetype("text/uri-list");this.addMimetype("application/x-file");this.connect(this,"dropfile",this.onUploadFile);this.connect(this,"drop",this.onItemDrop);this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);this.resource.loadChildren();
if(this.resource.getIsReady())this.onResourceChange()},getResource:function(){return this.resource},onResourceChange:function(){this.flow.clear();this.flow.append(new KJing.StorageNewItem({view:this.view,resource:this.resource}));for(var a=this.resource.getChildren(),b=0;b<a.length;b++)this.flow.append(new KJing.FileItemView({view:this.view,resource:a[b]}))},onUploadFile:function(a,b,c,d,e){a=new Core.FilePostUploader({file:b,service:this.resource.getChildrenUploadUrl()});this.connect(a,"error",this.onUploadError);
this.connect(a,"complete",this.onUploadError);b=new KJing.FileItemView({view:this.view,resourceParent:this.resource,uploader:a});this.flow.append(b);console.log(a);a.send()},onUploadError:function(a){var b=void 0;if(void 0!==this.flow){for(var c=0;void 0===b&&c<this.flow.getChildren().length;c++){var d=this.flow.getChildren()[c];KJing.FileItemView.hasInstance(d)&&d.getUploader()===a&&(b=this.flow.getChildren()[c])}void 0!=b&&this.flow.remove(b)}},onItemDrop:function(a,b,c,d,e,f){if("text/uri-list"==
b)if("link"===f){f="----";for(a=0;16>a;a++)f+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(62*Math.random())];f+="----";a=new Core.HttpRequest({method:"POST",url:this.resource.getChildrenUploadUrl()});a.setRequestHeader("Content-Type","multipart/form-data; boundary="+f);a.setContent("--"+f+'\r\nContent-Disposition: form-data; name="define"\r\nContent-Type: application/json; charset=UTF-8\r\n\r\n'+JSON.stringify({name:c,mimetype:"text/uri-list"})+"\r\n--"+f+'\r\nContent-Disposition: form-data; name="file"; filename="noname"\r\nContent-Type: text/plain; charset=UTF-8\r\n\r\n'+
c+"\r\n--"+f+"--\r\n");a.send()}else(new Core.HttpRequest({method:"POST",url:this.resource.getChildrenUploadUrl(),content:JSON.stringify({downloadUrl:c})})).send();else if("application/x-file"==b)if(c=KJing.Resource.create(c),c.getIsReady())this.onItemDropFileReady(f,c);else this.connect(c,"ready",this.onItemDropFileReady.bind(this,f))},onItemDropFileReady:function(a,b){console.log(this+".onItemDropFileReady("+a+","+b+")");if(this.resource.getShare().getId()===b.getShare().getId()){if(console.log(this+
".onItemDropFileReady same share resource parent_id: "+this.resource.getData().parent_id+", file parent_id: "+b.getData().parent_id),console.log(this.resource.getData()),console.log(b.getData()),this.resource.getData().id!==b.getData().parent_id)if(console.log(this+".onItemDropFileReady different parent"),"copy"===a||"copyMove"===a){var c=new Core.Uri({uri:b.getDownloadUrl()}),c=new Core.HttpRequest({method:"POST",url:this.resource.getChildrenUploadUrl(),content:JSON.stringify({name:b.getName(),mimetype:b.getMimetype(),
downloadUrl:c.toString()})});c.send()}else"move"===a&&b.changeData({parent_id:this.resource.getData().id})}else if("copy"===a||"copyMove"===a||"move"===a)c=new Core.Uri({uri:b.getDownloadUrl()}),c=new Core.HttpRequest({method:"POST",url:this.resource.getChildrenUploadUrl(),content:JSON.stringify({name:b.getName(),mimetype:b.getMimetype(),downloadUrl:c.toString()})}),"move"===a&&this.connect(c,"done",function(){b.suppress()}),c.send()}},{onLoad:function(){KJing.StorageView.base.onLoad.apply(this,arguments);
this.connect(this.resource,"change",this.onResourceChange)},onUnload:function(){KJing.StorageView.base.onUnload.apply(this,arguments);this.disconnect(this.resource,"change",this.onResourceChange)}});
Ui.DropBox.extend("KJing.FolderView",{resource:void 0,view:void 0,flow:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.view=a.view;delete a.view;this.flow=new Ui.Flow({spacing:5,uniform:!0});this.setContent(this.flow);this.setAllowedMode("move");this.addMimetype("KJing.FolderItemView");this.addMimetype("KJing.ShareItemView");this.addMimetype("KJing.MapItemView");this.addMimetype("KJing.GroupItemView");this.addMimetype("KJing.UserItemView");this.connect(this,"drop",this.onItemDrop)},
getResource:function(){return this.resource},onItemDrop:function(a,b,c,d,e,f){console.log(this+".onItemDrop "+c)}});
Ui.ScrollingArea.extend("KJing.PartView",{user:void 0,locator:void 0,setupButton:void 0,content:void 0,contextBar:void 0,selection:void 0,stack:void 0,constructor:function(a){this.user=a.user;delete a.user;this.stack=[];this.vbox=new Ui.VBox;this.setContent(this.vbox);a=new Ui.HBox;this.vbox.append(a);var b=new Ui.ScrollingArea({scrollVertical:!1});a.append(b,!0);this.locator=new Ui.Locator({path:"/",horizontalAlign:"left",margin:5});this.connect(this.locator,"change",this.onPathChange);b.setContent(this.locator);
this.setupButton=new Ui.Button({margin:5,icon:"gear"});this.setupButton.hide(!0);a.append(this.setupButton);this.connect(this.setupButton,"press",this.onSetupPress);this.push("Root",this.user.getId())},onSetupPress:function(a,b,c){this.content.getSetupPopup().show(a,"bottom")},getContentView:function(){return this.content},push:function(a,b){this.stack.push({text:a,resource:b});void 0!==this.content&&this.vbox.remove(this.content);this.content=KJing.View.create(this,b);this.vbox.append(this.content,
!0);this.updateLocator();"getSetupPopup"in this.content?this.setupButton.show():this.setupButton.hide(!0)},pop:function(){this.stack.pop()},updateLocator:function(){for(var a="",b=0;b<this.stack.length;b++)var c=this.stack[b],a=""===a?"/":"/"===a?a+c.text:a+("/"+c.text);this.locator.setPath(a)},onPathChange:function(a,b,c){a=this.stack[c];this.stack.splice(c+1,this.stack.length-c-1);void 0!==this.content&&this.vbox.remove(this.content);this.content=KJing.View.create(this,a.resource);this.vbox.append(this.content,
!0);this.updateLocator();"getSetupPopup"in this.content?this.setupButton.show():this.setupButton.hide(!0)}});Ui.CanvasElement.extend("KJing.RefZoneGraphic",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.beginPath();a.roundRect(2,2,b-4,c-4,3,3,3,3);a.closePath();a.lineWidth=2;a.setLineDash([4]);a.strokeStyle="#888";a.stroke()}});Ui.DropBox.extend("KJing.RefZone",{graphic:void 0,constructor:function(a){this.graphic=new KJing.RefZoneGraphic;this.append(this.graphic)}});
Ui.MenuToolBar.extend("KJing.MenuToolBar",{});
Ui.App.extend("KJing.AdminApp",{user:void 0,selection:void 0,menuBox:void 0,actionBox:void 0,contextBox:void 0,title:void 0,loginDialog:void 0,paned:void 0,constructor:function(a){this.sendGetAuthSession();this.connect(this.getDrawing(),"keyup",this.onKeyUp)},sendGetAuthSession:function(){var a=void 0;void 0!=this.getArguments().authsession?a=this.getArguments().authsession:"localStorage"in window&&(a=localStorage.getItem("authsession"));var b="/cloud/authsession/",b=void 0!=a?b+encodeURIComponent(a):
b+"current",a=new Core.HttpRequest({method:"GET",url:b+"?setcookie=1"});this.connect(a,"done",this.onGetAuthSessionDone);this.connect(a,"error",this.onGetAuthSessionError);a.send()},onGetAuthSessionError:function(a){"localStorage"in window&&void 0==this.getArguments().authsession&&localStorage.removeItem("authsession");this.basicLogin()},onGetAuthSessionDone:function(a){a=a.getResponseJSON();this.sessionId=a.id;"localStorage"in window&&void 0==this.getArguments().authsession&&localStorage.getItem("authsession")!=
a.id&&localStorage.setItem("authsession",a.id);void 0!=this.getArguments().authsession&&this.getArguments().authsession==a.id&&Core.HttpRequest.setRequestHeader("X-KJing-Authentication",a.id);a=new Core.HttpRequest({url:"/cloud/user/"+a.user});this.connect(a,"done",this.onGetUserDone);this.connect(a,"error",this.onGetUserError);a.send()},onGetUserDone:function(a){this.onLoginDone(a.getResponseJSON())},onGetUserError:function(a){"localStorage"in window&&this.sessionId==localStorage.getItem("authsession")&&
localStorage.removeItem("authsession");this.basicLogin()},getUser:function(){return this.user},basicLogin:function(){this.loginDialog=new KJing.LoginWizard;this.connect(this.loginDialog,"done",this.onBasicLoginDone);this.loginDialog.open()},onBasicLoginDone:function(a){a.close();this.sendGetAuthSession()},onLoginDone:function(a){this.user=KJing.Resource.create(a);a=new Ui.VBox;this.setContent(a);this.selection=new Ui.Selection;this.connect(this.selection,"change",this.onSelectionChange);this.menuBox=
new Ui.LBox;a.append(this.menuBox);this.actionBox=new KJing.MenuToolBar({padding:5,spacing:5});this.menuBox.append(this.actionBox);this.title=new Ui.Image({src:"img/logo-kjing.svg",horizontalAlign:"left",width:120});this.actionBox.append(this.title,!0);var b=new Ui.Button({icon:"eye"});this.connect(b,"press",this.onDisplayPress);this.actionBox.append(b);b=new Ui.Button({icon:"bell"});this.connect(b,"press",this.onMessagePress);this.actionBox.append(b);b=new Ui.Button({icon:"person"});this.connect(b,
"press",this.onProfilPress);this.actionBox.append(b);this.contextBox=new Ui.ContextBar({selection:this.selection});this.contextBox.hide();this.menuBox.append(this.contextBox);b=localStorage.getItem("panedPos")||0.5;this.paned=new Ui.Paned({orientation:"horizontal",pos:b});this.connect(this.paned,"change",this.onPanedChange);a.append(this.paned,!0);this.paned.setContent1(new KJing.PartView({user:this.user}));this.paned.setContent2(new KJing.PartView({user:this.user}))},onProfilPress:function(a){var b=
new Ui.Popup,c=new Ui.VBox({spacing:5});b.setContent(c);var d=new Ui.Button;this.connect(d,"press",function(){(new KJing.UserProfil({user:this.user})).open();b.hide()});c.append(d);var e=new Ui.HBox({margin:5,spacing:10,width:150});d.append(e);e.append(new KJing.RoundItemGraphic({imageSrc:this.user.getFaceUrl(),width:48,height:48}));e.append(new Ui.Text({text:this.user.getName(),verticalAlign:"center"}),!0);c.append(new Ui.Separator);d=new Ui.Button({icon:"exit",text:"D\u00e9connecter"});this.connect(d,
"press",this.onLogoutPress);c.append(d);b.show(a,"bottom")},onMessagePress:function(a){var b=new Ui.Popup;b.setContent(new Ui.Text({text:"TODO",verticalAlign:"center",width:150,height:200,margin:10}));b.show(a,"bottom")},onDisplayPress:function(a){var b=new Ui.Popup,c=new Ui.VBox;b.setContent(c);var d=new Ui.SegmentBar({margin:10,field:"text",data:[{text:"Horizontal",value:"horizontal"},{text:"Vertical",value:"vertical"}]});c.append(d);"horizontal"===this.paned.getOrientation()?d.setCurrentPosition(0):
d.setCurrentPosition(1);this.connect(d,"change",function(a,b){this.paned.setOrientation(b.value)});d=new Ui.Button({icon:"switch",text:"Inverser"});c.append(d);this.connect(d,"press",function(){this.paned.invert()});b.show(a,"bottom")},onLogoutPress:function(a){"localStorage"in window&&(localStorage.removeItem("login"),localStorage.removeItem("password"),localStorage.removeItem("currentPath"),localStorage.removeItem("authsession"));document.cookie="KJING_AUTH=; expires=Thu, 01-Jan-1970 00:00:01 GMT";
a=new Core.HttpRequest({method:"DELETE",url:"/cloud/authsession/current"});this.connect(a,"done",this.onAuthSessionDelete);this.connect(a,"error",this.onAuthSessionDelete);a.send()},onAuthSessionDelete:function(){var a=window.location.href;-1!=a.lastIndexOf("#")&&(a=a.substring(0,a.lastIndexOf("#")));window.location.replace(a)},onPanedChange:function(a,b){localStorage.setItem("panedPos",b)},getSelectionHandler:function(){return this.selection},onSelectionChange:function(a){0===a.getElements().length?
(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),this.actionBox.hide())},onKeyUp:function(a){46===a.which&&0<this.selection.getElements().length&&(a.stopPropagation(),a.preventDefault(),this.selection.executeDeleteAction())}});Ui.Icon.register("localaccount","M 41.197799,0.45212012 H 6.8022953 c -3.4926741,0 -6.3502223,2.85754818 -6.3502223,6.35012798 V 41.197752 c 0,3.492675 2.8575482,6.350128 6.3502223,6.350128 H 41.197799 c 3.492769,0 6.350128,-2.857453 6.350128,-6.350128 V 6.8022481 c 0,-3.4924855 -2.857454,-6.35012798 -6.350128,-6.35012798 z M 23.336236,40.15113 c -0.480661,0.480472 -1.110692,0.720709 -1.740157,0.720709 -0.629464,0 -1.259117,-0.240237 -1.739684,-0.720332 l -7.853068,-7.852313 v 6.112156 c -9.4e-5,1.358572 -1.101917,2.4603 -2.460488,2.4603 -1.358855,0 -2.4606769,-1.101728 -2.4606769,-2.460488 V 9.5887443 c 0,-1.3587601 1.1017279,-2.4604881 2.4605829,-2.4604881 1.35876,-9.44e-5 2.460582,1.1016336 2.460582,2.4605825 V 25.46463 l 7.853163,-7.852313 c 0.960661,-0.96085 2.518801,-0.960379 3.479746,4.72e-4 0.960946,0.960757 0.960946,2.518896 -3.78e-4,3.479748 l -7.790413,7.789376 7.790413,7.789281 c 0.961229,0.96085 0.961229,2.518896 3.78e-4,3.479936 z m 0.976043,-9.592281 c -0.948868,-0.948774 -0.948868,-2.487003 0,-3.435587 0.948584,-0.948962 2.486814,-0.948869 3.435587,0 0.948774,0.948773 0.948774,2.48672 0,3.435587 -0.948773,0.948773 -2.486908,0.948678 -3.435587,0 z m 7.891094,9.551706 c -0.480567,0.48019 -1.110126,0.72052 -1.739685,0.72052 -0.629747,0 -1.259589,-0.24033 -1.740062,-0.720897 -0.960946,-0.960851 -0.960946,-2.519085 3.78e-4,-3.479841 l 7.790507,-7.789376 -7.790507,-7.78947 c -0.961324,-0.960758 -0.961324,-2.518897 -3.78e-4,-3.479747 0.961228,-0.960758 2.519368,-0.961324 3.479841,-3.78e-4 L 43.4741,28.840961 32.203373,40.110555 z");
Ui.Icon.register("facebook","M 7.15625 2.15625 C 4.94025 2.15625 3.15625 3.94025 3.15625 6.15625 L 3.15625 42.15625 C 3.15625 44.37225 4.94025 46.15625 7.15625 46.15625 L 42.15625 46.15625 C 44.37225 46.15625 46.15625 44.37225 46.15625 42.15625 L 46.15625 6.15625 C 46.15625 3.94025 44.37225 2.15625 42.15625 2.15625 L 7.15625 2.15625 z M 37.03125 9.1875 C 37.68801 9.1927408 38.391498 9.1964286 39.15625 9.21875 L 39.15625 13.6875 C 37.567149 13.6875 35.637808 13.576474 34.90625 14.59375 C 34.174693 15.611021 34.15625 16.46148 34.15625 21.15625 L 39.15625 21.15625 L 39.15625 26.15625 L 34.15625 26.15625 L 34.15625 43.15625 L 28.15625 43.15625 L 28.15625 26.15625 L 23.15625 26.15625 L 23.15625 21.15625 L 28.15625 21.15625 C 28.15625 14.805452 28.130229 13.408331 29.3125 11.375 C 30.346992 9.5958355 32.433931 9.1508144 37.03125 9.1875 z");
Ui.Icon.register("google","M 7.03125 2 C 4.81525 2 3.03125 3.784 3.03125 6 L 3.03125 12.25 C 3.1302477 11.866836 3.238964 11.490393 3.40625 11.125 C 3.912429 10.019382 4.587611 9.094808 5.34375 8.25 C 6.099889 7.405191 7.044629 6.642653 7.9375 6 C 8.830372 5.357348 9.325384 5.078791 10.65625 4.6875 C 11.6544 4.394032 13.184548 4.16305 14.65625 4.15625 C 15.146817 4.154 15.631404 4.20302 16.09375 4.25 C 17.94313 4.437959 19.823803 5.200897 21.125 5.9375 C 22.426196 6.674105 23.360273 7.363239 24.125 8.375 C 24.889727 9.38676 25.411077 10.762961 25.71875 11.96875 C 26.026426 13.17454 25.974063 14.30012 25.8125 15.53125 C 25.650937 16.762381 24.857498 18.352498 24.15625 19.46875 C 23.455001 20.585001 22.13826 21.559565 21.28125 22.40625 C 20.424239 23.252936 20.314504 23.389945 19.90625 24.09375 C 19.498062 24.797557 19.41406 25.233687 19.5 25.75 C 19.585938 26.266313 19.891888 26.531749 20.34375 27.03125 C 20.795611 27.530752 21.107652 27.715 21.9375 28.46875 C 22.767347 29.222501 24.495602 30.176141 25.53125 31.34375 C 26.566897 32.511358 27.371051 33.75443 27.84375 35.28125 C 28.316442 36.808068 28.29653 38.631069 27.90625 40.0625 C 27.515971 41.49393 26.699792 43.22593 25.9375 44.0625 C 25.280282 44.78376 24.578382 45.425825 23.8125 46 L 42.03125 46 C 44.24725 46 46.03125 44.216 46.03125 42 L 46.03125 6 C 46.03125 3.784 44.24725 2 42.03125 2 L 7.03125 2 z M 12.46875 6.1875 C 12.101083 6.206124 11.717862 6.280756 11.28125 6.4375 C 10.408027 6.750991 9.724957 7.132817 9.0625 7.9375 C 8.400044 8.742184 7.928805 9.809566 7.6875 11 C 7.446197 12.190436 7.590794 13.622757 7.875 14.90625 C 8.159205 16.189743 8.613326 17.286769 9.3125 18.4375 C 10.011674 19.588229 11.119377 20.968676 12.0625 21.6875 C 13.005624 22.406325 13.734674 22.715243 14.65625 22.875 C 15.577826 23.034757 16.58934 22.955681 17.4375 22.625 C 18.28566 22.294319 18.981405 21.915834 19.53125 21.34375 C 20.081095 20.771666 20.405645 20.275214 20.75 19.1875 C 21.094356 18.099787 20.95477 15.934293 20.75 14.53125 C 20.545232 13.128206 20.245037 12.116328 19.6875 10.96875 C 19.129962 9.821173 18.340739 8.515394 17.59375 7.78125 C 16.846761 7.047108 16.282709 6.756004 15.65625 6.5625 C 15.02979 6.368997 14.023783 6.17364 13.46875 6.1875 C 13.191234 6.1945 12.836418 6.16888 12.46875 6.1875 z M 3.03125 17.65625 L 3.03125 35.0625 C 3.5490608 34.410928 4.1847785 33.90628 4.8125 33.46875 C 5.703009 32.848054 6.895613 32.151116 8.09375 31.71875 C 9.291886 31.286385 9.990597 30.955339 11.375 30.65625 C 12.759402 30.357152 16.09375 30.34375 16.09375 30.34375 C 16.09375 30.34375 15.695985 30.051675 15.375 29.71875 C 15.054016 29.385827 14.474793 28.954401 14.21875 28.3125 C 13.962705 27.6706 14.02848 26.625972 14.0625 26 C 14.096515 25.374027 14.28125 24.59375 14.28125 24.59375 C 14.28125 24.59375 12.264623 24.766414 10.84375 24.5 C 9.422876 24.233586 8.515258 23.885412 7.5 23.34375 C 6.484743 22.802088 5.628774 21.920741 4.8125 21.0625 C 3.996227 20.204259 3.621516 19.682342 3.1875 18.25 C 3.1209161 18.030258 3.0810785 17.854931 3.03125 17.65625 z M 14.65625 32.34375 C 13.604496 32.387205 12.182232 32.405853 10.875 32.84375 C 9.567768 33.281652 8.016124 34.118997 7 35.0625 C 5.983877 36.006002 5.131522 37.029519 4.875 38.25 C 4.618478 39.47048 4.799362 40.853463 5.3125 41.9375 C 5.825634 43.021536 6.646935 43.89795 7.59375 44.59375 C 8.540566 45.28955 9.282534 45.642071 10.78125 45.96875 C 10.845188 45.982687 10.932438 45.987169 11 46 L 18.15625 46 C 19.273668 45.842863 20.347335 45.592306 21.0625 45.28125 C 22.13198 44.816088 22.595862 44.476174 23.21875 43.6875 C 23.841639 42.898826 24.240608 41.703023 24.375 40.75 C 24.509392 39.796977 24.396703 38.696229 24.21875 38.03125 C 24.040799 37.366272 23.270015 36.297243 22.5 35.4375 C 21.729984 34.577757 20.542988 33.721469 19.625 33.25 C 18.707014 32.778531 18.020888 32.646687 17.1875 32.5 C 16.354112 32.353337 15.708004 32.3003 14.65625 32.34375 z");
Ui.Icon.register("pen","m 35.491031,1.9380056 c -0.880041,-0.0019 -1.665618,0.25809 -2.25,0.8125 L 7.2097806,28.719256 c -1.081049,1.081049 -1.081049,2.856993 0,3.9375 1.080507,1.081049 2.8257434,1.081049 3.9062504,0 L 34.397281,9.4067556 c 0.325127,-0.281777 0.847379,-0.277621 1.15625,0.03125 0.308329,0.308871 0.312485,0.7675394 0.03125,1.0937504 l 0,0.03125 -22.03125,22 c -1.833719,1.833719 -1.833719,4.822531 0,6.65625 1.833177,1.833177 4.823073,1.833177 6.65625,0 l 24.5625,-24.5625 c 0.06773,-0.06774 0.1241,-0.147222 0.1875,-0.21875 1.627805,-1.913375 0.470025,-5.6862252 -2.78125,-8.9375002 -2.279584,-2.279956 -4.751409,-3.558416 -6.6875,-3.5625 z M 5.8035306,35.781756 c -0.629799,-0.0038 -1.217236,0.248215 -1.625,0.65625 -0.389069,0.389069 -0.65969,0.915496 -0.8125,1.5625 l -0.96875,4.1875 c -0.258476,1.098931 -1.067342,2.993711 -0.40625,3.625 0.658925,0.631289 2.695866,-0.10063 3.78125,-0.40625 l 4.0625,-1.15625 c 0.5955254,-0.167441 1.1018984,-0.445648 1.4687504,-0.8125 0.442715,-0.442715 0.661127,-0.992264 0.65625,-1.59375 -0.0065,-0.725034 -0.321746,-1.437171 -0.96875,-2.0625 l -3.1875004,-3.0625 c -0.679787,-0.657299 -1.370201,-0.933707 -2,-0.9375 z");
Ui.Icon.register("bubble","M 22.9375,3.90625 C 10.790957,3.90625 0.5,12.130045 0.5,22.78125 0.5,33.432455 10.790957,41.625 22.9375,41.625 c 2.124327,0 4.17045,-0.3792 6.125,-0.84375 7.279657,3.168207 11.862809,3.147181 18.4375,1.96875 -2.660808,-2.477164 -5.513133,-5.353739 -7.40625,-7.9375 3.222545,-3.236231 5.28125,-7.390481 5.28125,-12.03125 0,-10.651205 -10.291328,-18.875 -22.4375,-18.875 z m 0,4.59375 c 10.113871,0 17.84375,6.639208 17.84375,14.28125 -0.698708,5.363994 -3.032958,8.351365 -6.65625,11.25 0.926077,2.069229 3.275767,4.207025 4.59375,5.6875 -3.489625,-0.707366 -6.340952,-1.85199 -8.78125,-3.75 -2.352313,0.645471 -4.924033,1.051885 -7,1.0625 -10.114319,0 -17.84375,-6.608273 -17.84375,-14.25 C 5.09375,15.139208 12.823181,8.5 22.9375,8.5 z");
Ui.Icon.override("plus","M 21.5 4 L 21.5 21.5 L 4 21.5 L 4 26.5 L 21.5 26.5 L 21.5 44 L 26.5 44 L 26.5 26.5 L 44 26.5 L 44 21.5 L 26.5 21.5 L 26.5 4 L 21.5 4 z");Ui.Icon.register("person","m 31.255154,11.504904 c 0.385499,1.705036 0.852155,3.545577 0.942733,5.320176 0.02391,0.473904 0.05217,1.095629 -0.145648,1.499968 1.613732,1.07389 0.823894,3.305727 -0.120288,4.44121 -0.339848,0.407238 -1.112295,0.913023 -1.284756,1.418085 -0.255067,0.742738 -0.570278,1.471708 -1.020267,2.12894 -0.376079,0.547814 -0.295647,0.13333 -0.670277,0.973892 -0.253616,1.142005 -0.638392,3.728181 -0.0942,4.789752 0.714477,1.392 2.279662,2.27314 3.575286,3.013705 1.717355,0.982586 3.636154,1.703587 5.470172,2.43618 1.688371,0.674623 3.449202,1.178235 5.073805,2.002855 0.509409,0.257965 1.023166,0.510133 1.505765,0.817374 0.389122,0.24782 1.042007,0.629697 1.134758,1.129685 v 3.930351 H 2.137661 l 0.02971,-3.930351 c 0.092752,-0.499265 0.7456362,-0.881865 1.1347583,-1.129685 0.4825983,-0.307241 0.9963555,-0.558683 1.5057649,-0.817374 1.6246029,-0.82462 3.3861595,-1.328232 5.0738045,-2.002855 1.8340193,-0.733318 3.7520943,-1.453594 5.4701723,-2.43618 1.2949,-0.740565 2.860085,-1.621705 3.574562,-3.013705 0.544915,-1.062295 0.240575,-3.659341 -0.01378,-4.799897 l 0,0 c -0.435498,-0.281878 -0.736217,-1.155047 -0.983312,-1.591995 -0.26014,-0.461584 -0.469556,-0.959399 -0.786941,-1.386925 -0.432599,-0.583322 -1.153599,-0.856505 -1.624603,-1.40287 -0.314486,-0.363759 -0.448541,-0.814476 -0.604334,-1.260842 -0.186228,-0.533321 -0.09492,-0.966646 -0.178258,-1.565908 -0.03695,-0.256518 0.0942,-0.554336 0.246372,-0.770999 0.186952,-0.26666 0.527525,-0.318834 0.613755,-0.656507 0.106519,-0.418107 -0.128258,-0.907952 -0.173185,-1.320987 -0.04783,-0.441294 -0.162315,-1.144903 -0.160141,-1.587647 0.0072,-1.606487 -0.28985,-3.055732 0.996356,-4.32527 0.452163,-0.444918 0.96592,-0.829692 1.45649,-1.231133 l 0,0 c 0.188401,-0.5999868 1.092006,-0.9695441 1.620255,-1.1709891 0.686218,-0.260864 1.407941,-0.4072376 2.111549,-0.6166535 2.123143,-0.6325951 4.562946,-0.5652052 6.4245,0.7456363 0.610857,0.4304255 1.452868,0.060868 2.096332,0.4304255 0.619552,0.3565141 1.358667,1.1804098 1.287654,1.9405378 z");
Ui.Icon.register("group","m 23.130121,8.752257 c -1.726597,0.098014 -3.104222,0.7517754 -2.666061,1.454215 -2.467192,-0.4542201 -1.908658,5.120049 -1.908658,5.120049 l 0.545331,1.454215 c -1.051264,0.676063 -0.308371,1.48013 -0.272665,2.423692 0.05151,1.391344 0.878588,1.120958 0.878588,1.120958 0.05326,2.296858 1.211846,2.575172 1.211846,2.575172 0.160674,1.081701 0.118381,1.213218 0.09089,1.211846 l -1.030069,0.121185 c 0.04507,0.364663 -0.09089,0.969476 -0.09089,0.969476 -1.195842,0.527974 -1.450459,0.848231 -2.635765,1.363327 -2.291004,0.997412 -4.768424,2.282745 -5.210937,4.029388 -0.442514,1.746642 -1.757177,8.664698 -1.757177,8.664698 l 26.812091,0 c 0,-1.816297 -2.060138,-9.51299 -2.060138,-9.51299 0,-1.122089 -1.45177,-2.403325 -4.362645,-3.1508 -1.510167,-0.387492 -2.787246,-1.242142 -2.787246,-1.242142 -0.186722,-0.105945 -0.151481,-1.090661 -0.151481,-1.090661 l -0.93918,-0.151481 c 0,-0.08019 -0.09089,-1.242142 -0.09089,-1.242142 1.121504,-0.37403 0.999773,-2.575173 0.999773,-2.575173 0.712354,0.392175 1.18155,-1.363326 1.18155,-1.363326 0.842299,-2.426218 -0.424146,-2.272211 -0.424146,-2.272211 0.400955,-1.815712 0,-4.48383 0,-4.48383 C 28.14682,9.4116558 25.350031,8.6262386 23.130121,8.752257 z M 8.8909315,11.32743 c -1.805176,1.126771 -1.5039686,2.802483 -1.4542151,3.787018 0.033365,0.66143 0.1211846,1.120958 0.1211846,1.120958 -0.7328405,0.31491 -0.3519884,0.740165 -0.3332576,1.817768 0.023414,1.490851 0.7574037,1.242143 0.7574037,1.242143 0.3459335,2.03053 1.4239189,3.271984 1.4239189,3.271984 0,0 -0.3082495,1.748578 -0.424146,1.969249 -0.3324708,0.07434 -1.0849274,0.601644 -2.6963572,1.272438 -2.3747079,0.988047 -1.6421662,0.397523 -3.5749455,1.363327 -3.0548682,1.527727 -2.45398793,7.907295 -2.45398793,7.907295 l 9.63417503,0 0.9694766,-4.48383 0,-0.06059 0.0303,-0.06059 c 0.655577,-2.830685 4.045795,-4.187589 5.907749,-4.998864 -1.130284,-0.516267 -1.72034,-0.875964 -1.999546,-0.939181 -0.11414,-0.228866 -0.363554,-1.969249 -0.363554,-1.969249 0,0 1.361329,-1.21574 1.666288,-3.514354 0,0 0.685549,0.368884 0.727108,-1.030069 0.03102,-1.077603 0.188095,-1.472562 -0.545331,-1.787472 0,0 0.06748,-0.761904 0.09089,-1.423919 0.03629,-0.981024 0.212963,-2.346306 -1.484511,-3.453761 C 14.648415,11.200275 13.413257,10.505926 13.405062,10.509439 12.961377,10.240184 12.405289,10.054996 12.405289,10.054996 10.429138,9.7931513 9.6513809,10.848764 8.8909315,11.32743 z M 37.005757,10.206465 c -1.345103,0.07492 -2.276268,0.636723 -2.908431,1.030069 -0.630991,0.393346 -0.999672,1.196869 -1.272438,1.787473 -0.272181,0.589436 -0.757404,4.15001 -0.757404,4.27176 0,0.120579 -0.152106,1.486407 -0.393849,2.332803 -0.241744,0.846982 -1.060366,2.302507 -1.060366,2.302507 1.136127,0.701936 2.381338,0.97755 3.69613,1.393623 l -0.0303,1.151254 c -0.211306,0.03102 -1.060385,0.57611 -1.18155,0.848292 -0.07902,0.177943 -0.254984,0.476725 -0.424146,0.696811 2.193254,0.884443 3.492555,2.186246 3.54465,3.635538 0.03571,0.258719 1.378122,5.020702 1.454215,6.089526 l 10.118913,0 c 0.0088,-0.0439 -0.300034,-6.194765 -0.302961,-6.241007 0,0 -0.592903,-1.48556 -1.514808,-1.635992 -0.922485,-0.151597 -2.11027,-0.474258 -2.605464,-0.848288 -0.289742,-0.220086 -1.229043,-0.598192 -1.666288,-0.757403 -0.204283,-0.07317 -0.545936,-0.666999 -0.666516,-0.939181 -0.120579,-0.272182 -0.939362,-0.817269 -1.151253,-0.848292 l -0.06059,-1.151254 c 1.282571,-0.333871 2.645628,-0.809405 3.726427,-1.393623 0,0 -0.819207,-1.516703 -1.060366,-2.363099 -0.242329,-0.846982 -0.39385,-2.151632 -0.39385,-2.272211 0,-0.12175 -0.515518,-3.682324 -0.787699,-4.271757 -0.272182,-0.590604 -0.640276,-1.394127 -1.272439,-1.787473 -0.632162,-0.393346 -1.562743,-0.955146 -2.90843,-1.030069 -0.0199,-0.0012 -0.04011,0.0017 -0.06059,0 -0.0199,0.0017 -0.03952,-0.0012 -0.0606,-7e-6 z");
Ui.Icon.register("play","m 8,4 35,20 -35,20 z");Ui.Icon.register("file","m 6,2 0,44 L 42,46 42,11 33,2 l -27,0 z M 10,6 l 19,0 L 29,15 l 9,0 0,27 -28,0 0,-36 z M 33,7 37,11 33,11 33,7 z");Ui.Icon.register("files","m 18,2 0,5 -7,0 L 11,12 l 2,0 0,-3 7,0 0,-5 17,0 0,7 7,0 0,23 -5,0 L 39,14 l -7,-7 0,3 4,4 -4,0 0,-7 -12,0 0,2 10,0 0,7 7,0 0,23 -6,0 L 31.144284,18.964863 24,12 24,15 28,19 24,19 l 0,-7 -11,0 0,2 9,0 0,7 7,0 0,23 -24,0 0,-30 L 13,14 l 0,-2 -10,0 0,34 L 31,46 l 0,-5 8,0 0,-5 7,0 L 46,9 39,2 l 0,3 4,4 -4,0 L 39,2 z");
Ui.Icon.register("bell","M 22.5 4 C 21.946 4 21.5 4.446 21.5 5 L 21.5 6.65625 C 14.197144 7.5123592 13.34375 12 13.34375 12 L 8.34375 32.28125 L 3 37.5 L 24 37.5 L 45 37.5 L 39.65625 32.28125 L 34.65625 12 C 34.65625 12 33.802856 7.5123592 26.5 6.65625 L 26.5 5 C 26.5 4.446 26.054 4 25.5 4 L 22.5 4 z M 24 10.5 C 30.61599 10.5 31 14.5 31 14.5 L 36 33.5 L 24 33.5 L 12 33.5 L 17 14.5 C 17 14.5 17.38401 10.5 24 10.5 z M 20 39 C 20 41.209139 21.790861 43 24 43 C 26.209139 43 28 41.209139 28 39 L 20 39 z");
Ui.Icon.register("uploadfile","M 8.0625 2.21875 C 8.0617248 2.21875 7.4694201 2.3434686 7.46875 2.34375 C 7.4680799 2.3440327 7.0317558 2.6244948 7.03125 2.625 C 7.0307442 2.6255052 6.7502825 3.0618298 6.75 3.0625 C 6.7497175 3.0631702 6.625 3.6242249 6.625 3.625 L 6.625 44.28125 C 6.625 44.282025 6.7497173 44.84308 6.75 44.84375 C 6.7502825 44.84442 7.0307442 45.280745 7.03125 45.28125 C 7.0317558 45.281755 7.4680799 45.562217 7.46875 45.5625 C 7.4694201 45.562783 8.0617248 45.65625 8.0625 45.65625 L 41.125 45.65625 C 41.125775 45.65625 41.68683 45.562781 41.6875 45.5625 C 41.68817 45.562217 42.124495 45.281755 42.125 45.28125 C 42.125505 45.280745 42.437217 44.84442 42.4375 44.84375 C 42.437783 44.84308 42.5625 44.282025 42.5625 44.28125 C 42.767515 33.395948 42.5625 22.367308 42.5625 11.09375 L 33.4375 2.3125 L 33.40625 6.625 L 38.15625 11.09375 L 33.375 11.09375 L 33.375 2.21875 C 24.475085 2.2568748 16.581521 2.22416 8.0625 2.21875 z M 30.25 5.5625 L 30.25 13.03125 C 30.25 13.032025 30.374719 13.59308 30.375 13.59375 C 30.375283 13.59442 30.655745 14.030745 30.65625 14.03125 C 30.656755 14.031755 31.09308 14.312217 31.09375 14.3125 C 31.09442 14.312783 31.655475 14.4375 31.65625 14.4375 L 39.4375 14.4375 L 39.4375 42.125 L 9.90625 42.1875 L 9.8125 5.71875 L 30.25 5.5625 z M 23.21875 17.75 L 23.21875 24.75 L 21.5 22.96875 L 19.78125 24.75 L 25 29.96875 L 30.21875 24.75 L 28.5 22.96875 L 26.75 24.75 L 26.75 17.75 L 23.21875 17.75 z M 14.21875 28.75 L 14.21875 34.84375 L 35.5 34.84375 L 35.5 28.75 L 32.46875 28.75 L 32.46875 31.8125 L 17.25 31.8125 L 17.25 28.75 L 14.21875 28.75 z");
Ui.Icon.register("sound","M 30 2 L 15 18 L 7 18 L 7 30 L 15 30 L 30 46 L 30 2 z M 32 17 L 32 31 C 36 31.03125 39 28 39 24 C 39 20 36 17 32 17 z");Ui.Icon.register("gear","M 23.5 1.9375 L 16.40625 3.03125 L 17.09375 6.53125 L 10.96875 10.4375 L 7.78125 8.59375 L 4.09375 14.96875 L 6.90625 16.59375 L 5.53125 23.78125 L 2.03125 24.5 L 3.59375 31.96875 L 6.90625 30.9375 L 10.9375 37 L 8.84375 40 L 15 44.0625 L 17.0625 41.125 L 24.34375 42.5625 L 24.8125 46.0625 L 32.3125 44.625 L 31.53125 41.1875 L 37.59375 37.15625 L 40.40625 39.375 L 44.65625 33.34375 L 41.53125 30.9375 L 43.03125 23.71875 L 45.96875 23.28125 L 44.96875 15.9375 L 41.71875 16.59375 L 37.59375 10.4375 L 39.5 7.375 L 33.75 3.46875 L 31.40625 6.40625 L 24.03125 4.9375 L 23.5 1.9375 z M 24.3125 13.8125 C 29.841857 13.8125 34.3125 18.283142 34.3125 23.8125 C 34.3125 29.341857 29.841857 33.84375 24.3125 33.84375 C 18.783143 33.84375 14.28125 29.341857 14.28125 23.8125 C 14.28125 18.283142 18.783143 13.8125 24.3125 13.8125 z");
Ui.Icon.register("folder","m 4,7 0,35 40,0 0,-25 -34,0 0,21 -2,0 0,-23 32,0 0,-4 -21,0 0,-4 z");Ui.Icon.register("share","M 35.15625 1.4375 C 31.014114 1.4375 27.65625 4.795364 27.65625 8.9375 C 27.65625 9.2720571 27.676295 9.5832816 27.71875 9.90625 L 14.15625 18.03125 C 12.898871 17.079306 11.354924 16.5 9.65625 16.5 C 5.5141144 16.5 2.15625 19.857864 2.15625 24 C 2.15625 28.142136 5.5141144 31.5 9.65625 31.5 C 11.354924 31.5 12.898871 30.920694 14.15625 29.96875 L 27.78125 38.15625 C 27.738909 38.478794 27.71875 38.82215 27.71875 39.15625 C 27.71875 43.298386 31.076614 46.65625 35.21875 46.65625 C 39.360886 46.65625 42.71875 43.298386 42.71875 39.15625 C 42.71875 35.014114 39.360886 31.65625 35.21875 31.65625 C 33.599996 31.65625 32.10059 32.159189 30.875 33.03125 L 17.09375 24.78125 C 17.119355 24.529122 17.15625 24.258883 17.15625 24 C 17.15625 23.741117 17.119355 23.470878 17.09375 23.21875 L 30.78125 15.03125 C 32.00986 15.910429 33.530263 16.4375 35.15625 16.4375 C 39.298386 16.4375 42.65625 13.079636 42.65625 8.9375 C 42.65625 4.795364 39.298386 1.4375 35.15625 1.4375 z");
Ui.Icon.register("tools","M 10.0625 1.84375 C 9.3364045 1.84375 8.6394735 1.947946 7.96875 2.125 L 11.375 5.53125 C 12.779786 6.9360357 12.666423 9.3335769 11.09375 10.90625 C 9.5210769 12.478923 7.1235357 12.623536 5.71875 11.21875 L 2.1875 7.6875 C 1.9600984 8.4402891 1.84375 9.2358617 1.84375 10.0625 C 1.84375 14.599125 5.5258752 18.28125 10.0625 18.28125 C 10.509115 18.28125 10.947724 18.256096 11.375 18.1875 L 38.15625 44.9375 C 39.561036 46.342286 42.204505 45.951745 44.09375 44.0625 C 45.982995 42.173255 46.373536 39.529786 44.96875 38.125 L 18.1875 11.3125 C 18.249824 10.904613 18.28125 10.487809 18.28125 10.0625 C 18.28125 5.5258752 14.599125 1.84375 10.0625 1.84375 z M 43.625 2.75 L 33.4375 9.8125 L 32.53125 13.5625 L 27.96875 17.90625 L 31.40625 21.21875 L 35.875 16.8125 L 39.40625 15.875 L 46.65625 5.78125 L 43.625 2.75 z M 15.03125 25.90625 C 7.8033753 33.086151 7.2145886 33.648419 2.03125 38.78125 C 0.72083335 40.091667 1.3282724 42.797022 3.375 44.84375 L 3.78125 45.28125 C 5.8279776 47.327978 8.5333334 47.904167 9.84375 46.59375 C 15.445521 41.004056 17.293476 39.184722 22.78125 33.75 L 21.375 32.375 L 9.4375 44.3125 C 8.9976541 44.752346 8.2764647 44.776465 7.84375 44.34375 L 7.8125 44.28125 C 7.3797853 43.848535 7.3726541 43.158596 7.8125 42.71875 L 19.75 30.78125 L 17.96875 28.96875 L 6.09375 40.8125 C 5.6539041 41.252346 4.963964 41.276464 4.53125 40.84375 L 4.5 40.78125 C 4.0672853 40.348535 4.0601541 39.658596 4.5 39.21875 L 16.46875 27.34375 L 15.03125 25.90625 z M 40.53125 36.84375 C 42.405073 36.84375 43.9375 38.376177 43.9375 40.25 C 43.9375 42.123823 42.405073 43.65625 40.53125 43.65625 C 38.657427 43.65625 37.15625 42.123823 37.15625 40.25 C 37.15625 38.376177 38.657427 36.84375 40.53125 36.84375 z");
Ui.Icon.override("close","M 7.9375,4.5625 4.5625,8.09375 20.46875,24 4.5625,39.90625 8.09375,43.4375 24,27.53125 39.90625,43.4375 43.4375,39.90625 27.53125,24 43.4375,8.09375 39.90625,4.5625 23.9375,20.4375 z");Ui.Icon.override("switch","M 28 6 L 33 11 L 5 11 L 5 17 L 33 17 L 28 22 L 34 22 L 42 14 L 34 6 L 28 6 z M 13 25 L 5 33 L 13 41 L 19 41 L 14 36 L 42 36 L 42 30 L 14 30 L 19 25 L 13 25 z");
new KJing.AdminApp({webApp:!0,style:{"Ui.Element":{color:"#444444",fontSize:16,interLine:1.4},"Ui.Popup":{background:"#ffffff","Ui.ButtonGraphic":{background:new Ui.Color({r:1,g:1,b:1,a:0.1})}},"Ui.SegmentBar":{color:"#ffffff"},"Ui.Dialog":{background:"#ffffff"},"Ui.Selectionable":{shadow:new Ui.Color({r:0,g:0.72,b:0.95,a:0.4})},"Ui.Separator":{color:"#999999"},"Ui.CheckBox":{color:"#444444",focusColor:new Ui.Color({r:0.13,g:0.83,b:1}),checkColor:new Ui.Color({r:0.03,g:0.63,b:0.9})},"Ui.ScrollingArea":{color:"#999999",
showScrollbar:!1,overScroll:!0,radius:0},"Ui.ButtonGraphic":{background:"#fefefe",iconSize:28,spacing:5,focusBackground:new Ui.Color({r:0.13,g:0.83,b:1,a:0.5})},"Ui.TextBgGraphic":{focusBackground:new Ui.Color({r:0.13,g:0.83,b:1})},"Ui.ActionButton":{"Ui.ButtonGraphic":{background:new Ui.Color({r:1,g:1,b:1,a:0}),foreground:"#ffffff"}},"Ui.Slider":{color:"#cccccc"},"Ui.Locator":{color:"#eeeeee",iconSize:30,spacing:6},"Ui.MenuToolBarButton":{"Ui.ButtonGraphic":{color:new Ui.Color({r:0.8,g:0.8,b:0.8,
a:0.2}),iconSize:28,spacing:0}},"Ui.ContextBar":{background:"#00b9f1","Ui.Element":{color:"#ffffff"}},"KJing.MenuToolBar":{background:"#6c19ab","Ui.ButtonGraphic":{background:new Ui.Color({r:200,g:200,b:200,a:0.2}),foreground:"#ffffff",focusBackground:new Ui.Color({r:0.43,g:1,b:1,a:0.6}),focusForeground:"#ffffff"}},"KJing.NewItem":{"Ui.ButtonGraphic":{background:new Ui.Color({r:1,g:1,b:1,a:0}),iconSize:48}}}});
