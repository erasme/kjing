Core.Object.extend("KJing.Device",{ready:!1,deleted:!1,id:void 0,data:void 0,request:void 0,socket:void 0,isSocketOpen:!1,isMonitored:!1,clientData:void 0,sendClientTask:void 0,retryTask:void 0,constructor:function(a){this.addEvents("ready","change","delete","error","clientmessage");this.clientData={};"data"in a?(this.id=a.data.id,this.updateData(a.data),delete a.data):"id"in a&&(this.id=a.id,delete a.id,this.data={id:this.id},this.update());this.monitor()},getIsDeleted:function(){return this.deleted},
getIsReady:function(){return this.ready},getId:function(){return this.id},changeData:function(a){(new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id,content:JSON.stringify(a)})).send()},getData:function(){return this.data},countControllers:function(){var a=0;if("clients"in this.data)for(var b=0;b<this.data.clients.length;b++)this.data.clients[b].user!==this.id&&a++;return a},getIsControlled:function(){return 0<this.countControllers()},getName:function(){return this.data.name},getRights:function(){return this.data.rights},
addRights:function(a){a=new Core.HttpRequest({method:"POST",url:"/cloud/resource/"+this.id+"/rights",content:JSON.stringify(a)});this.connect(a,"done",function(){this.update()});a.send()},suppress:function(){var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/resource/"+this.id});this.connect(a,"done",function(){this.deleted=!0;this.fireEvent("delete",this)});a.send()},update:function(){void 0===this.request&&(this.request=new Core.HttpRequest({url:"/cloud/resource/"+this.id+"?seenBy="+this.id}),
this.connect(this.request,"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},updateData:function(a){if(void 0===this.data||JSON.stringify(this.data)!==JSON.stringify(a))this.data=a,this.ready||(this.ready=!0,this.fireEvent("ready",this)),this.fireEvent("change",this)},sendClientMessage:function(a,b){void 0!==this.socket&&this.socket.send(JSON.stringify({type:"clientmessage",destination:a,message:b}))},getClientData:function(){return this.clientData},
sendClientData:function(a){void 0!==this.socket&&this.isSocketOpen&&this.socket.send(JSON.stringify({type:"clientdata",data:a}))},notifyClientData:function(){void 0===this.sendClientTask&&(this.sendClientTask=new Core.DelayedTask({scope:this,delay:0.25,callback:function(){this.sendClientTask=void 0;this.sendClientData(this.clientData)}}))},monitor:function(){this.retryTask=void 0;this.isMonitored=!0;void 0===this.socket&&(this.socket=new Core.Socket({service:"/cloud/resource/"+this.id+"?seenBy="+
this.id}),this.connect(this.socket,"open",this.onSocketOpen),this.connect(this.socket,"message",this.onMessageReceived),this.connect(this.socket,"error",this.onSocketError),this.connect(this.socket,"close",this.onSocketClose))},unmonitor:function(){void 0!==this.retryTask&&(this.retryTask.abort(),this.retryTask=void 0);this.isMonitored=!1;void 0!==this.socket&&(this.socket.close(),this.socket=void 0)},onGetDataError:function(a){404==a.getStatus()?this.fireEvent("delete",this):this.fireEvent("error",
this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0},onSocketOpen:function(){this.isSocketOpen=!0;void 0!==this.clientData&&this.sendClientData(this.clientData)},onMessageReceived:function(a,b){var c=JSON.parse(b);"type"in c&&("change"===c.type?this.update():"clientmessage"===c.type&&this.fireEvent("clientmessage",this,c.message))},onSocketError:function(){this.socket.close()},onSocketClose:function(){this.isSocketOpen=!1;this.socket=void 0;
this.isMonitored&&(this.retryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.monitor}))}},{},{create:function(a){if("string"===typeof a)return new KJing.Device({id:a});if("object"===typeof a){if(KJing.Device.hasInstance(a))return a;if("id"in a)return new KJing.Device({data:a})}}});Ui.CanvasElement.extend("KJing.ScaledImage",{image:void 0,constructor:function(a){this.image=new Ui.Image;this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onImageReady:function(){this.invalidateDraw()}},{updateCanvas:function(a){if(this.image.getIsReady()){var b=this.image.getNaturalWidth(),c=this.image.getNaturalHeight(),d=this.getLayoutWidth(),e=this.getLayoutHeight(),
f,g;b/c<d/e?(g=e,f=b*g/c,d=-(f-d)/2,e=0):(f=d,g=c*f/b,d=0,e=-(g-e)/2);a.drawImage(this.image.getDrawing(),0,0,b,c,d,e,f,g)}}});Ui.Fixed.extend("KJing.ScaledImage2",{image:void 0,src:void 0,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();
this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a/b<c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}});Ui.CanvasElement.extend("KJing.PosButton",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#444444";a.beginPath();a.arc(b/2,c/2,d,0,2*Math.PI,!1);a.closePath();a.fill();a.fillStyle="rgb(240,240,240)";a.beginPath();a.arc(b/2,c/2,0.66*d,0,2*Math.PI,!1);a.closePath();a.fill()},measureCore:function(a,b){return{width:30,height:30}}});
Ui.CanvasElement.extend("KJing.PosBar",{currentPos:0,loadPos:0,setCurrentPos:function(a){a!=this.currentPos&&(this.currentPos=a,this.invalidateDraw())},getCurrentPos:function(){return this.currentPos},setLoadPos:function(a){a!=this.loadPos&&(this.loadPos=a,this.invalidateDraw())},getLoadPos:function(){return this.loadPos},drawBar:function(a,b,c,d,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.fill();a.rect(b,c-e,d,2*e);a.fill();a.beginPath();a.arc(b+d,c,e,0,2*Math.PI,!1);a.closePath();
a.fill()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#aaaaaa";this.drawBar(a,d,c/2,b-2*d,0.5*d);a.fillStyle="#888888";0<this.loadPos&&this.drawBar(a,d,c/2,(b-2*d)*this.loadPos,0.5*d);a.fillStyle="#ffc30b";0<this.currentPos&&this.drawBar(a,d,c/2,(b-2*d)*this.currentPos,0.5*d)},measureCore:function(a,b){return{width:20,height:20}}});
Ui.Container.extend("KJing.MediaProgressBar",{posButton:void 0,posBar:void 0,pos:0,constructor:function(a){this.addEvents("up","down","move");this.posBar=new KJing.PosBar({verticalAlign:"center"});this.appendChild(this.posBar);a=new KJing.PosButton;this.posButton=new Ui.Movable({moveVertical:!1,horizontalAlign:"left",verticalAlign:"center"});this.connect(this.posButton,"move",this.onButtonMove);this.connect(this.posButton,"up",this.onButtonUp);this.connect(this.posButton,"down",this.onButtonDown);
this.posButton.setContent(a);this.appendChild(this.posButton)},getCurrentPos:function(){return this.posBar.getCurrentPos()},getLoadPos:function(){return this.posBar.getLoadPos()},setLoadPos:function(a){this.posBar.setLoadPos(a)},onButtonMove:function(a){this.pos=Math.min(1,Math.max(0,a.getPositionX()/(this.getLayoutWidth()-a.getLayoutWidth())));this.updatePos();this.fireEvent("move",this)},onButtonUp:function(a){this.fireEvent("up",this)},onButtonDown:function(a){this.fireEvent("down",this)},updatePos:function(){this.disconnect(this.posButton,
"move",this.onButtonMove);this.posButton.setPosition((this.getLayoutWidth()-this.posButton.getLayoutWidth())*this.pos,void 0);this.connect(this.posButton,"move",this.onButtonMove);this.posBar.setCurrentPos(this.pos)},setPos:function(a){this.pos!=a&&(this.pos=a,this.invalidateArrange())}},{measureCore:function(a,b){var c=this.posBar.measure(a,b),d=this.posButton.measure(a,b);return{width:Math.max(c.width,d.width),height:Math.max(c.height,d.height)}},arrangeCore:function(a,b){this.posBar.arrange(0,
0,a,b);this.posButton.arrange(0,0,a,b);this.updatePos()}});
Ui.CanvasElement.extend("KJing.PlayButton",{mode:"play",clock:void 0,backgroundVisible:!0,constructor:function(a){},setMode:function(a){a!=this.mode&&(this.mode=a,this.invalidateDraw(),"load"==a?(this.clock=new Anim.Clock({duration:"forever",scope:this,onTimeupdate:function(a,c){this.invalidateDraw()}}),this.getIsVisible()&&this.clock.begin()):void 0!=this.clock&&(this.clock.stop(),this.clock=void 0))},setBackgroundVisible:function(a){this.backgroundVisible!=a&&(this.backgroundVisible=a,this.invalidateDraw())}},
{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);this.backgroundVisible&&(a.fillStyle="rgba(221,221,221,0.6)",a.beginPath(),a.arc(b/2,c/2,d,0,2*Math.PI,!1),a.closePath(),a.fill());a.fillStyle="#444444";if("play"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2+0.6*d,c/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill();else if("pause"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2-0.3*d+d/5,c/2-d/2),a.lineTo(b/
2-0.3*d+d/5,c/2+d/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill(),a.beginPath(),a.moveTo(b/2+0.1*d,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2+d/2),a.lineTo(b/2+0.1*d,c/2+d/2),a.closePath(),a.fill();else for(a.translate(b/2,c/2),b=this.clock.getTime()%1,c=0;8>c;c++)a.save(),a.rotate(2*Math.PI*c/8+1*Math.PI*b),a.beginPath(),a.arc(0,d/2,5,0,2*Math.PI,!1),a.closePath(),a.fill(),a.restore()},measureCore:function(a,b){return{width:20,height:20}},onVisible:function(){void 0!=
this.clock&&this.clock.begin()},onHidden:function(){void 0!=this.clock&&this.clock.stop()}});
Ui.LBox.extend("KJing.MediaPlayBar",{media:void 0,progressBar:void 0,playButton:void 0,posLabel:void 0,totalLabel:void 0,seeking:!1,constructor:function(a){this.media=a.media;delete a.media;this.connect(this.media,"ready",this.onMediaReady);this.connect(this.media,"timeupdate",this.onMediaTimeUpdate);this.connect(this.media,"bufferingupdate",this.onMediaBufferingUpdate);this.connect(this.media,"statechange",this.onMediaStateChange);this.append(new Ui.Shadow({shadowWidth:2,radius:3,inner:!1,opacity:0.5,
color:"#555555"}));this.append(new Ui.Rectangle({fill:"rgb(240,240,240)",margin:2,radius:3}));a=new Ui.HBox({margin:5});this.append(a);var b=new Ui.Pressable;this.connect(b,"press",this.onPlayPress);this.playButton=new KJing.PlayButton({mode:"play",backgroundVisible:!1,width:60,height:60});b.setContent(this.playButton);"playing"!=this.media.getState()&&"buffering"!=this.media.getState()||this.playButton.setMode("pause");a.append(b);b=new Ui.LBox;a.append(b,!0);this.progressBar=new KJing.MediaProgressBar({height:30,
verticalAlign:"center"});this.connect(this.progressBar,"down",this.onProgressBarDown);this.connect(this.progressBar,"up",this.onProgressBarUp);b.append(this.progressBar,!0);this.media.getIsReady()||this.progressBar.disable();a=new Ui.HBox({marginLeft:10,marginRight:10,verticalAlign:"bottom"});b.append(a);this.posLabel=new Ui.Label({text:"",color:"#444444"});this.totalLabel=new Ui.Label({text:"",color:"#444444"});a.append(this.posLabel);a.append(new Ui.Element,!0);a.append(this.totalLabel)},updateLabels:function(){var a=
this.media.getDuration();if(void 0==a)this.totalLabel.setText("");else{var b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":";this.totalLabel.setText(10>b?a+("0"+b):a+b)}a=this.media.getCurrentTime();void 0==a?this.posLabel.setText(""):(b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":",a=10>b?a+("0"+b):a+b,this.posLabel.setText(a))},updatePos:function(){if(void 0!=this.media.getDuration()){var a=this.media.getCurrentTime();void 0==a&&(a=0);this.seeking||this.progressBar.setPos(a/
this.media.getDuration())}else this.progressBar.setPos(0)},onPlayPress:function(){var a=this.media.getState();"initial"==a?this.media.play():"paused"==a?this.media.play():"playing"==a?this.media.pause():"buffering"==a&&this.media.pause()},onProgressBarDown:function(){this.seeking=!0},onProgressBarMove:function(){this.media.setCurrentTime(this.progressBar.getCurrentPos()*this.media.getDuration())},onProgressBarUp:function(){this.seeking=!1;this.media.setCurrentTime(this.progressBar.getCurrentPos()*
this.media.getDuration())},onMediaStateChange:function(a,b){"playing"==b||"buffering"==b?this.playButton.setMode("pause"):"initial"!=b&&"paused"!=b||this.playButton.setMode("play")},onMediaReady:function(){this.progressBar.enable();this.updatePos();this.updateLabels()},onMediaTimeUpdate:function(){this.updatePos();this.updateLabels()},onMediaBufferingUpdate:function(){this.progressBar.setLoadPos((this.media.getCurrentTime()+this.media.getCurrentBufferSize())/this.media.getDuration())}});
Ui.LBox.extend("KJing.AudioPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,label:void 0,constructor:function(a){this.addEvents("end");this.media=new Ui.Audio;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnded);a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.append(a);var b=new Ui.Shape({horizontalAlign:"center",width:150,height:150,scale:1.5,path:"M 93.161,0.071 C 59.66,-1.043 32.22,11.314 32.22,11.314 L 32.2,74.023 c -3.411,-1.354 -7.559,-1.675 -11.772,-0.651 -9.083,2.207 -15.031,9.82 -13.285,17.007 1.746,7.187 10.524,11.225 19.606,9.019 8.564,-2.081 14.338,-8.969 13.507,-15.772 l 0,0 0,-46.855 c 0,0 19.404,-6.784 44.573,-8.485 l 0,34.849 0,0 C 81.455,61.843 77.386,61.55 73.25,62.555 64.167,64.761 58.219,72.374 59.965,79.562 61.71,86.749 70.488,90.786 79.571,88.58 87.502,86.653 93.042,80.603 93.158,74.316 l 0.003,0.004 c 0,-0.002 0,-61.521 0,-74.249 z"});
a.append(b);this.label=new Ui.Text({textAlign:"center",fontSize:20,width:300});a.append(this.label);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);this.playButton=new KJing.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.append(a);this.mediaBar=new KJing.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},
setText:function(a){this.label.setText(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},onMediaEnded:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?this.playButton.setMode("pause"):"paused"==b||"initial"==b?this.playButton.setMode("play"):"buffering"==b&&this.playButton.setMode("load")},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():
"initial"==a&&this.media.play()}});Ui.LBox.extend("KJing.VideoPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,controlBox:void 0,controlsVisible:!0,constructor:function(a){this.addEvents("statechange","end");this.media=new Ui.Video;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnd);this.controlBox=new Ui.LBox;this.append(this.controlBox);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);
this.playButton=new KJing.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.controlBox.append(a);this.mediaBar=new KJing.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.controlBox.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},setPoster:function(a){this.media.setPoster(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},getState:function(){return this.media.getState()},
getIsControlsVisible:function(){return this.controlsVisible},showControls:function(){this.controlsVisible=!0;this.controlBox.show()},hideControls:function(){this.controlsVisible=!1;this.controlBox.hide()},onMediaEnd:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?(this.hideControls(),this.playButton.setMode("pause")):"paused"==b||"initial"==b?(this.showControls(),this.playButton.setMode("play")):"buffering"==b&&(this.showControls(),this.playButton.setMode("load"));
this.fireEvent("statechange",this,b)},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():"initial"==a&&this.media.play()}});Ui.HBox.extend("Storage.FileViewer",{uploader:void 0,file:void 0,storage:void 0,updateNeeded:!1,viewer:void 0,tools:void 0,contentBox:void 0,playing:!1,contentViewer:void 0,controller:void 0,playTimer:void 0,constructor:function(a){this.addEvents("toolschange","end");this.storage=a.storage;delete a.storage;this.tools=[];this.contentBox=new Ui.LBox;this.append(this.contentBox,!0);"uploader"in a?(this.uploader=a.uploader,delete a.uploader):"file"in a&&(this.update(a.file),delete a.file);"controller"in
a&&(this.controller=a.controller,delete a.controller);this.connect(this,"load",this.onFileViewerLoad);this.connect(this,"unload",this.onFileViewerUnload)},setPosition:function(a){void 0!==this.contentViewer&&"setPosition"in this.contentViewer&&this.contentViewer.setPosition(a)},setContentTransform:function(a){void 0!==this.contentViewer&&"setContentTransform"in this.contentViewer&&this.contentViewer.setContentTransform(a)},getDownloadUrl:function(){return void 0!==this.uploader?void 0:"/cloud/storage/"+
this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev},update:function(a){if(void 0===this.file||this.updateNeeded||this.file.rev!=a.rev)this.file=a,this.updateNeeded=!1,this.getIsLoaded()&&this.buildContent()},removeContent:function(){this.contentBox.setContent()},buildContent:function(){void 0!==this.uploader?this.contentBox.setContent(new Storage.UploaderViewer({storage:this.storage,uploader:this.uploader,fileViewer:this})):(this.tools=[],this.supportProperties=!0,"image/gif"==
this.file.mimetype?this.contentViewer=new Storage.GifImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("image/")?this.contentViewer=new Storage.ImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"text/uri-list"==this.file.mimetype?this.contentViewer=new Storage.SiteFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"application/x-webnapperon2-rss-item"==this.file.mimetype?this.contentViewer=new Storage.RssItemFileViewer({storage:this.storage,
file:this.file,fileViewer:this}):navigator.isIE7||navigator.isIE8||0!=this.file.mimetype.indexOf("video/")?navigator.isIE7||navigator.isIE8||0!=this.file.mimetype.indexOf("audio/")?0==this.file.mimetype.indexOf("text/plain")&&5E4>this.file.size?this.contentViewer=new Storage.TextFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("application/pdf")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.text")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.presentation")||
0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.graphics")||0==this.file.mimetype.indexOf("application/vnd.sun.xml.writer")||0==this.file.mimetype.indexOf("application/vnd.ms-powerpoint")||0==this.file.mimetype.indexOf("application/msword")||0==this.file.mimetype.indexOf("application/vnd.openxmlformats-officedocument.wordprocessingml.document")||0==this.file.mimetype.indexOf("text/richtext")?this.contentViewer=new Storage.PdfFileViewer({storage:this.storage,file:this.file,fileViewer:this}):
0==this.file.mimetype.indexOf("application/x-directory")&&5E4>this.file.size?this.contentViewer=new Storage.DirectoryFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.GenericFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.AudioFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.VideoFileViewer({storage:this.storage,file:this.file,fileViewer:this}),this.contentBox.setContent(this.contentViewer),
this.playing&&this.play())},getFile:function(){return this.file},getUploader:function(){return this.uploader},getTools:function(){return this.tools},appendTool:function(a){this.tools.push(a);this.fireEvent("toolschange",this,this.tools)},play:function(){if(void 0===this.contentViewer)this.playing=!0;else if("play"in this.contentViewer)this.connect(this.contentViewer,"end",this.onPlayEnd),this.contentViewer.play();else{var a=5;"duration"in this.file.meta&&(a=parseFloat(this.file.meta.duration));this.timerPlay=
new Core.DelayedTask({scope:this,delay:a,callback:this.onPlayEnd})}},pause:function(){},current:function(){0<this.contentBox.getChildren().length&&"current"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].current()},uncurrent:function(){0<this.contentBox.getChildren().length&&"uncurrent"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].uncurrent()},onPlayEnd:function(){this.playing=!1;this.fireEvent("end",this)},deleteFile:function(){void 0!=this.file?(new Core.HttpRequest({method:"DELETE",
url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send():void 0!=this.uploader&&this.uploader.abort()},onFileViewerLoad:function(){this.buildContent()},onFileViewerUnload:function(){this.removeContent()}});
Ui.LBox.extend("Storage.UploaderViewer",{storage:void 0,uploader:void 0,progressbar:void 0,label:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.uploader=a.uploader;delete a.uploader;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center"});this.setContent(a);a.append(new Ui.Icon({icon:"uploadfile",fill:"#3f3f3f",width:256,height:256,horizontalAlign:"center"}));this.progressbar=new Ui.ProgressBar({width:120,
height:10});a.append(this.progressbar);void 0!=this.uploader.getFile().getFileName()&&a.append(new Ui.CompactLabel({width:256,maxLine:3,textAlign:"center",text:this.uploader.getFile().getFileName()}));this.connect(this.uploader,"progress",this.onUploaderProgress)},onUploaderProgress:function(a,b,c){this.progressbar.setValue(b/c)}});
Ui.LBox.extend("Storage.DirectoryFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,transBox:void 0,playing:!1,directoryChildren:void 0,position:void 0,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);var b=new Core.HttpRequest({url:"/cloud/storage/"+this.storage+"/"+this.file.id+
"?depth=1"});this.connect(b,"done",function(){var a=b.getResponseJSON();this.directoryChildren=a.children;0===this.directoryChildren.length?this.playing&&this.fireEvent("end",this):(this.position=0,a=new Storage.FileViewer({storage:this.storage,file:a.children[this.position]}),this.connect(a,"end",this.onFileEnd),this.transBox.replaceContent(a),this.playing&&a.play())});b.send()},play:function(){this.playing=!0;void 0!==this.directoryChildren&&0===this.directoryChildren.length?this.fireEvent("end",
this):void 0!==this.transBox.getCurrent()&&this.transBox.getCurrent().play()},onFileEnd:function(){this.disconnect(this.transBox.getCurrent(),"end",this.onFileEnd);this.position++;if(this.position>=this.directoryChildren.length)this.fireEvent("end",this);else{var a=new Storage.FileViewer({storage:this.storage,file:this.directoryChildren[this.position]});this.connect(a,"end",this.onFileEnd);this.transBox.replaceContent(a);a.play()}}});
Ui.LBox.extend("Storage.ImageFileViewer",{storage:void 0,file:void 0,transformable:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,userInteraction:!0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.transformable=new Ui.Transformable({inertia:!1,clipToBounds:!0});this.setContent(this.transformable);this.image=new KJing.ScaledImage2;this.image.setSrc("/cloud/storage/"+this.storage+"/"+
this.file.id+"/content?rev="+this.file.rev);this.transformable.setContent(this.image);this.connect(this.transformable,"transform",this.onTransform)},setContentTransform:function(a){this.transformable.getIsDown()||(this.userInteraction=!1,this.transformable.setContentTransform(a.x,a.y,a.scale,a.angle),this.userInteraction=!0)},onTransform:function(){var a=this.getLayoutWidth(),b=this.getLayoutHeight();this.disconnect(this.transformable,"transform",this.onTransform);var c=this.transformable.getScale(),
d=this.transformable.getTranslateX(),e=this.transformable.getTranslateY(),c=Math.min(4,Math.max(1,c)),a=(a*c-a)/2,b=(b*c-b)/2,d=Math.min(d,a),d=Math.max(d,-a),e=Math.min(e,b),e=Math.max(e,-b);this.transformable.setContentTransform(d,e,c,0);this.connect(this.transformable,"transform",this.onTransform);this.userInteraction&&(c=Ui.App.current.getDevice(),c.getClientData().state.transform={angle:this.transformable.getAngle(),scale:this.transformable.getScale(),x:this.transformable.getTranslateX(),y:this.transformable.getTranslateY()},
c.notifyClientData())}});Ui.LBox.extend("Storage.GifImageFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.image=new KJing.ScaledImage2;this.image.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev);this.setContent(this.image)}});
Ui.LBox.extend("Storage.SiteFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,linkButton:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onContentLoaded);a.send();a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});
this.setContent(a);var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});a.append(b);b.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,b:0.7,g:0.7}),radius:2}));b.append(new Ui.Rectangle({fill:"white",margin:1,radius:2}));var c=new Ui.Image({src:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,width:128,margin:3});b.append(c);this.connect(c,"error",function(){b.setContent(new Ui.Image({src:"/cloud/mimeicon?mimetype="+encodeURIComponent(this.file.mimetype),
verticalAlign:"bottom",horizontalAlign:"center",width:128}))});this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);this.linkButton=new Ui.LinkButton({text:"Ouvrir le site",horizontalAlign:"center"});this.linkButton.disable();a.append(this.linkButton)},onContentLoaded:function(a){void 0!==this.file.meta&&(new Boolean(this.file.meta.iframe)).valueOf()?(a=new Ui.IFrame({src:a.getResponseText()}),this.setContent(a)):(this.linkButton.setSrc(a.getResponseText()),
this.linkButton.enable())}});
Ui.LBox.extend("Storage.AudioFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));
this.setContent(a)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/audio/"+this.storage+"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new KJing.AudioPlayer({src:"/cloud/audio/"+
this.storage+"/"+this.file.id,text:this.file.name}),this.setContent(this.player),this.connect(this.player,"end",this.onMediaEnd),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son",verticalAlign:"center"}));this.request=
void 0},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()},onMediaEnd:function(){this.fireEvent("end",this)}},{onVisible:function(){void 0===this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.LBox.extend("Storage.VideoFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,transformable:void 0,pressable:void 0,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.transformable=new Ui.Transformable({inertia:!1,clipToBounds:!0});this.setContent(this.transformable);this.pressable=new Ui.Pressable;this.pressable.setLock(!0);
this.connect(this.pressable,"press",this.onVideoPress);this.transformable.setContent(this.pressable);a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.pressable.setContent(a)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",
url:"/cloud/video/"+this.storage+"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new KJing.VideoPlayer({src:"/cloud/video/"+this.storage+"/"+this.file.id,poster:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev}),this.connect(this.player,"statechange",this.onVideoStateChange),
this.connect(this.player,"end",this.onVideoEnd),this.pressable.setContent(this.player),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.pressable.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center",textAlign:"center"}));this.request=void 0},onCheckError:function(){this.pressable.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center",
textAlign:"center"}));this.request=void 0},onVideoEnd:function(a){this.playing=!1;this.fireEvent("end",this)},onVideoStateChange:function(a){this.pressable.setLock(this.player.getIsControlsVisible())},onVideoPress:function(){void 0!==this.player&&"playing"==this.player.getState()&&this.player.pause()},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()}},{onVisible:function(){void 0===
this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.LBox.extend("Storage.TextFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,text:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(a);var b=new Ui.LBox;b.append(new Storage.PageBackgroundGraphic({margin:7}));a.setContent(b);this.text=new Wn.ImproveText({margin:30,style:{"Wn.ImproveText":{fontSize:20}}});
b.append(this.text);a=new Ui.LinkButton({icon:"edit",src:"/app/texteditor/?storage="+this.storage+"&file="+this.file.id});this.fileViewer.appendTool(a);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){this.text.setText(a.getResponseText())}});
Ui.CanvasElement.extend("Storage.PageBackgroundGraphic",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();this.roundRectFilledShadow(5,5,b-10,c-10,2,2,2,2,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.5}));a.fillStyle="#ffffff";a.fillRect(7,7,b-14,c-14)}});
Ui.LBox.extend("Storage.RssItemFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,title:void 0,content:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;var b=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(b);a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);b.setContent(a);b=new Ui.VBox({margin:20,spacing:10});a.append(b);this.title=
new Ui.Text({text:this.file.name,fontWeight:"bold",fontSize:24,marginTop:20});b.append(this.title);this.content=new Ui.Html;this.connect(this.content,"link",this.onContentLink);b.append(this.content);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){var b='<div style="word-wrap: break-word; font-family: '+this.getStyleProperty("fontFamily")+";font-size: "+
this.getStyleProperty("fontSize")+"px;font-weight: "+this.getStyleProperty("fontWeight")+';">',b=b+((new Date(this.file.meta.pubDate)).toLocaleString()+"&nbsp;&nbsp;");void 0!=this.file.meta.link&&(b+='<a href="'+this.file.meta.link+'" style="cursor: pointer; text-decoration: underline; color: #4d4d4d">article complet</a><br>');b=b+"<br>"+a.getResponseText();b+="</div>";this.content.setHtml(b)},onContentLink:function(a,b){window.open(b,"_blank")}});
Ui.LBox.extend("Storage.PdfPage",{storage:void 0,file:void 0,page:void 0,graphic:void 0,transformable:void 0,userInteraction:!0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.page=a.page;delete a.page;this.transformable=new Ui.Transformable({inertia:!1,clipToBounds:!0});this.setContent(this.transformable);this.graphic=new KJing.ScaledImage2({src:"/cloud/pdf/"+this.storage+"/"+this.file.id+"/pages/"+this.page+"/image?rev="+this.file.rev});this.transformable.setContent(this.graphic);
this.connect(this.transformable,"transform",this.onTransform)},setContentTransform:function(a){this.transformable.getIsDown()||(this.userInteraction=!1,this.transformable.setContentTransform(a.x,a.y,a.scale,a.angle),this.userInteraction=!0)},onTransform:function(){var a=this.getLayoutWidth(),b=this.getLayoutHeight();this.disconnect(this.transformable,"transform",this.onTransform);var c=this.transformable.getScale(),d=this.transformable.getTranslateX(),e=this.transformable.getTranslateY(),c=Math.min(4,
Math.max(1,c)),a=(a*c-a)/2,b=(b*c-b)/2,d=Math.min(d,a),d=Math.max(d,-a),e=Math.min(e,b),e=Math.max(e,-b);this.transformable.setContentTransform(d,e,c,0);this.connect(this.transformable,"transform",this.onTransform);this.userInteraction&&(c=Ui.App.current.getDevice(),c.getClientData().state.transform={angle:this.transformable.getAngle(),scale:this.transformable.getScale(),x:this.transformable.getTranslateX(),y:this.transformable.getTranslateY()},c.notifyClientData())}});
Ui.LBox.extend("Storage.PdfFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,pages:void 0,data:void 0,checkTask:void 0,request:void 0,transBox:void 0,playing:!1,position:0,delayTask:void 0,duration:5,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",
textAlign:"center"}));this.setContent(a)},setPosition:function(a){void 0!==this.pages&&(this.position=Math.max(0,Math.min(this.pages.length-1,a)),this.transBox.replaceContent(new Storage.PdfPage({storage:this.storage,file:this.file,page:this.position})))},setContentTransform:function(a){void 0!==this.pages&&this.transBox.getCurrent().setContentTransform(a)},play:function(){this.playing=!0;void 0!==this.pages&&0===this.pages.length?(this.playing=!1,this.fireEvent("end",this)):void 0!==this.transBox&&
this.getIsVisible()&&(this.duration=5,"duration"in this.file.meta&&(this.duration=parseFloat(this.file.meta.duration)),this.delayTask=new Core.DelayedTask({scope:this,delay:this.duration,callback:this.onPageEnd}))},onPageEnd:function(){this.delayTask=void 0;this.position++;this.position>=this.pages.length?(this.playing=!1,this.fireEvent("end",this)):(this.transBox.replaceContent(new Storage.PdfPage({storage:this.storage,file:this.file,page:this.position})),this.getIsVisible()&&(this.delayTask=new Core.DelayedTask({scope:this,
delay:this.duration,callback:this.onPageEnd})))},checkReady:function(){void 0!=this.checkTask&&(this.checkTask=void 0);void 0==this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/pdf/"+this.storage+"/"+this.file.id}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status?(this.data=a,this.pages=this.data.pages,this.transBox=new Ui.TransitionBox,
this.setContent(this.transBox),this.onDataDone()):"building"==a.status?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier PDF",verticalAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier PDF",verticalAlign:"center"}));this.request=void 0},onDataDone:function(a){this.transBox.replaceContent(new Storage.PdfPage({storage:this.storage,
file:this.file,page:this.position}));this.playing&&this.play()}},{onVisible:function(){void 0===this.transBox?this.checkReady():this.playing&&this.play()},onHidden:function(){void 0!=this.request&&(this.request.abort(),this.request=void 0);void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.delayTask&&(this.delayTask.abort(),this.delayTask=void 0)}});
Ui.LBox.extend("Storage.GenericFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.setContent(a);a.append(new Ui.Image({src:"/cloud/mimeicon?mimetype="+encodeURIComponent(this.file.mimetype),width:128,height:128,horizontalAlign:"center"}));this.text=new Ui.Text({textAlign:"center",
text:this.file.name,fontSize:20});a.append(this.text);var b=new Ui.DownloadButton({text:"T\u00e9l\u00e9charger",horizontalAlign:"center"});b.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev);a.append(b)}});
Ui.Container.extend("Storage.ScaledImage",{image:void 0,src:void 0,ratio:1,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.appendChild(this.image);"ratio"in a&&(this.ratio=a.ratio,delete a.ratio);this.connect(this.image,"ready",this.onReady);this.addEvents("ready")},setSrc:function(a){this.removeChild(this.image);this.src=a;this.image=void 0==this.src?new Ui.Image:new Ui.Image({src:this.src});
this.appendChild(this.image)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.invalidateMeasure();this.fireEvent("ready",this)}},{measureCore:function(a,b){if(this.getIsReady()){var c=this.image.getNaturalWidth(),d=this.image.getNaturalHeight();return{width:a,height:d*a/c}}return{width:a,height:a/this.ratio}},arrangeCore:function(a,b){this.image.arrange(0,0,a,b)}});Ui.App.extend("KJing.ClientApp",{sessionId:void 0,deviceId:void 0,device:void 0,transBox:void 0,path:void 0,viewer:void 0,clientData:void 0,state:void 0,capabilities:void 0,constructor:function(a){this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.capabilities={sound:!0,width:this.getLayoutWidth(),height:this.getLayoutHeight()};this.state={};a={};void 0!==this.getArguments().parent&&(a.parent=this.getArguments().parent);void 0!==this.getArguments().name&&(a.name=this.getArguments().name);
void 0!==this.getArguments().device?a.id=this.getArguments().device:"localStorage"in window&&null!==localStorage.getItem("device")&&(a.id=localStorage.getItem("device"));void 0!==this.getArguments().hwid&&(a.hwid=this.getArguments().hwid);var b=new Core.HttpRequest({method:"POST",url:"/cloud/device/login",content:JSON.stringify(a)});this.connect(b,"done",function(){var a=b.getResponseJSON();this.sessionId=a.id;this.deviceId=a.user;"localStorage"in window&&localStorage.setItem("device",this.deviceId);
Core.HttpRequest.setRequestHeader("X-KJing-Authentication",this.sessionId);this.onLoginDone()});this.connect(b,"error",function(){this.transBox.setContent(new Ui.Text({text:"Erreur de connexion au serveur"}))});b.send();this.connect(this,"resize",this.onAppResize)},getDevice:function(){return this.device},setPath:function(a){this.path=a;if(null===this.path)this.transBox.replaceContent(new Ui.Element);else{var b=a.lastIndexOf(":"),c=a.substring(5,b);a=a.substring(b+1);var d=new Core.HttpRequest({method:"GET",
url:"/cloud/storage/"+c+"/"+a});this.connect(d,"done",function(){var a=d.getResponseJSON();this.viewer=new Storage.FileViewer({storage:c,file:a,controller:this});this.viewer.play();this.transBox.replaceContent(this.viewer)});d.send()}},setPosition:function(a){void 0!==this.viewer&&this.viewer.setPosition(a)},setContentTransform:function(a){void 0!==this.viewer&&this.viewer.setContentTransform(a)},onLoginDone:function(){this.device=KJing.Device.create(this.deviceId);this.clientData=this.device.getClientData();
this.clientData.capabilities=this.capabilities;this.clientData.state=this.state;this.device.notifyClientData();this.connect(this.device,"change",this.onDeviceChange);this.connect(this.device,"clientmessage",this.onDeviceClientMessage);if(this.device.getIsReady())this.onDeviceChange()},onDeviceChange:function(){this.device.getIsControlled()||void 0===this.state.path?void 0===this.state.path&&this.path!==this.device.getData().path&&this.setPath(this.device.getData().path):(this.state.path=void 0,this.device.notifyClientData(),
this.setPath(this.device.getData().path))},onDeviceClientMessage:function(a,b){var c=!1;"path"in b&&(this.state.path=b.path,this.setPath(this.state.path),c=!0);"position"in b&&(this.state.position=b.position,this.setPosition(b.position),c=!0);"transform"in b&&(this.state.transform=b.transform,this.setContentTransform(this.state.transform),c=!0);c&&this.device.notifyClientData()},onAppResize:function(){this.capabilities.width=this.getLayoutWidth();this.capabilities.height=this.getLayoutHeight();void 0!==
this.device&&this.device.notifyClientData()}});new KJing.ClientApp({webApp:!0});
